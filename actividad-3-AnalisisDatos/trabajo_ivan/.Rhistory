datos_escalados <- scale(datos_cluster_input)
clusterizacion <- kmeans(datos_escalados, centers = 4, nstart = 25)
datos_con_cluster <- datos %>%
mutate(Cluster = clusterizacion$cluster)
tabla_cruce <- table(datos_con_cluster$Cluster, datos_con_cluster$BikePurchase)
print("Porcentaje de compra por grupo:")
# margin = 1 calcula el % por filas (por Cluster)
prop.table(tabla_cruce, margin = 1)
resumen_perfiles <- datos_con_cluster %>%
group_by(Cluster) %>%
summarise(
Media_Edad = mean(Age, na.rm = TRUE),
Media_Ingresos = mean(YearlyIncome, na.rm = TRUE),
Media_Hijos = mean(TotalChildren, na.rm = TRUE),
Media_Coches = mean(NumberCarsOwned, na.rm = TRUE),
Prop_Casa = mean(ifelse(HomeOwnerFlag_f == "Si", 1, 0), na.rm = TRUE) # Ajusta "Si" a tu valor real
)
print(resumen_perfiles)
resumen_clusters <- datos_cluster_input %>%
mutate(Cluster = clusterizacion$cluster) %>%
group_by(Cluster) %>%
summarise(across(everything(), mean)) # 'everything' calcula la media de TODAS las columnas numéricas
print(resumen_clusters)
# Cruzamos el Cluster con los tramos de ingresos
tabla_ingresos <- table(datos_con_cluster$Cluster, datos_con_cluster$YearlyIncome)
# Vemos los porcentajes por fila (Cluster)
# Esto te dirá: "En el Cluster 1, el 80% tiene ingresos altos"
prop.table(tabla_ingresos, margin = 1)
clusterizacion
clusterizacion$cluster
datos_perfil <- datos %>%
mutate(Cluster = as.factor(modelo_kmeans$cluster))
# 1. Preparamos los datos para el árbol
# Usamos tus mismos 'datos_cluster_input' y le pegamos la etiqueta
datos_para_arbol <- datos_cluster_input %>%
mutate(Cluster = as.factor(clusterizacion$cluster)) # ¡OJO: as.factor es obligatorio!
# 2. Creamos el árbol
# La fórmula "Cluster ~ ." significa: "Explica el Cluster usando TODAS las demás variables"
arbol_explicativo <- rpart(Cluster ~ .,
data = datos_para_arbol,
method = "class")
# 3. Visualizamos las reglas
rpart.plot(arbol_explicativo,
type = 2,
extra = 101,
nn = TRUE,
box.palette = "BuGn", # Colores bonitos
main = "Reglas que definen cada Cluster")
# 1. Preparamos los datos para el árbol
# Usamos tus mismos 'datos_cluster_input' y le pegamos la etiqueta
datos_para_arbol <- datos_cluster_input %>%
mutate(Cluster = as.factor(clusterizacion$cluster)) # ¡OJO: as.factor es obligatorio!
# 2. Creamos el árbol
# La fórmula "Cluster ~ ." significa: "Explica el Cluster usando TODAS las demás variables"
arbol_explicativo <- rpart(Cluster ~ .,
data = datos_para_arbol,
method = "class")
# 3. Visualizamos las reglas
rpart.plot(arbol_explicativo,
type = 2,
extra = 101,
nn = TRUE,
box.palette = "BuGn", # Colores bonitos
main = "Reglas que definen cada Cluster")
# 1. Preparamos los datos (Usando 'clusterizacion', que es TU variable)
datos_para_arbol <- datos_cluster_input %>%
mutate(Cluster = as.factor(clusterizacion$cluster)) # <--- CORREGIDO AQUÍ
# 2. Creamos el árbol explicativo
# "Cluster ~ ." significa: Predice el Cluster usando TODAS las demás columnas
arbol_explicativo <- rpart(Cluster ~ .,
data = datos_para_arbol,
method = "class")
# 3. Lo visualizamos
rpart.plot(arbol_explicativo,
type = 2,
extra = 101,
nn = TRUE,
box.palette = "BuGn",
main = "Reglas que definen cada Cluster")
# 1. Preparamos los datos (Usando 'clusterizacion', que es TU variable)
datos_para_arbol <- datos_cluster_input %>%
mutate(Cluster = as.factor(clusterizacion$cluster)) # <--- CORREGIDO AQUÍ
# 2. Creamos el árbol explicativo
# "Cluster ~ ." significa: Predice el Cluster usando TODAS las demás columnas
arbol_explicativo <- rpart(Cluster ~ .,
data = datos_para_arbol,
method = "class")
# 3. Lo visualizamos
rpart.plot(arbol_explicativo,
type = 2,
extra = 101,
nn = TRUE,
box.palette = "BuGn",
main = "Reglas que definen cada Cluster")
# 1. Preparamos los datos (Usando 'clusterizacion', que es TU variable)
datos_para_arbol <- datos_cluster_input %>%
mutate(Cluster = as.factor(clusterizacion$cluster)) # <--- CORREGIDO AQUÍ
# 2. Creamos el árbol explicativo
# "Cluster ~ ." significa: Predice el Cluster usando TODAS las demás columnas
arbol_explicativo <- rpart(Cluster ~ .,
data = datos_para_arbol,
method = "class")
# 3. Lo visualizamos
rpart.plot(arbol_explicativo,
type = 2,
extra = 101,
nn = TRUE,
box.palette = "BuGn",
main = "Reglas que definen cada Cluster")
#| include: false
getwd()
setwd("/Users/alejandrocamposlamas/Proyectos/ACTIVIDADES_UNIR/actividad-3-AnalisisDatos")
library(readxl)
library(dplyr)
library(caret) # para matriz de confusión
library(rpart) #Para realizar el árbol
library(rpart.plot) #Para dibujar el árbol
library(factoextra) # para clusteres
library(NbClust)
library(forecast)
getwd()
#| include: false
# cargamos datos
datos <- read_excel("datos/DataSet SQL_Act3_ADMN.xlsx",
sheet = "Var Discreta Adq Bicicleta")
# vemos la estructura y convertimos los datos a su formato adecuado
# str(datos)
# colSums(is.na(datos)) # verificamos que no existe ningun null
# datos[is.na(datos)] <- 0 # valores nulos se reemplazarían por 0
# Quitamos la columna PersonType dado que todos su valores son IN
datos <- datos%>% select(!PersonType)
#quitamos aquellas paises que son agrupaciones
datos <- datos %>%
filter(!(Country %in% c("Northwest", "Southeast", "Central", "Southwest", "Northeast")))
# a factores datos que son categorías
datos$Education <- as.factor(datos$Education)
datos$PersonID <- as.factor(datos$PersonID)
datos$CustomerID <- as.factor(datos$CustomerID)
# Los booleanos le creamos una columna condicional
#BikePurchase
#HomeOwnerFlag
datos <- datos %>%
mutate(
BikePurchase_f = factor(BikePurchase, labels=c("FALSE", "TRUE")),
HomeOwnerFlag_f = factor(HomeOwnerFlag, labels=c("FALSE", "TRUE"))
)
#str(datos)
#| include: false
# describimos los estadísticos numéricos
datos %>% select(where(is.numeric)) %>% summary(use="complete.obs")
# observamos cómo se relacionan las variables
datos %>% select(where(is.numeric)) %>% cor(use="complete.obs")
#split: seleccionamos el monto de entrenamiento y lo guardamos en la variabble de train
indice <- sample(1:nrow(datos), size = 0.8 * nrow(datos))
# Train: entrenamos al modelo con el subset de testeo
train <- datos[indice, ]
# test: tomamos el monto a testar
test <- datos[-indice, ]
modelo_logit <- glm(BikePurchase ~   Country + MaritalStatus + HomeOwnerFlag_f + Education + YearlyIncome + Occupation, data = train, family = "binomial")
summary(modelo_logit)
# 1. Ajuste del modelo (Cambiamos 'family' por 'method')
modelo_arbol <- rpart(BikePurchase ~ Country + MaritalStatus + HomeOwnerFlag_f +
Education + YearlyIncome + Occupation,
data = train,
method = "class")
# 2. Visualización
rpart.plot(modelo_arbol,main = "Árbol de Decisión: Predicción de Bike Purchase",
type = 2,
extra = 104,
nn = TRUE)
pred_logit_prob <- predict(modelo_logit, newdata = test, type = "response")
# 1# 1. Convertimos tus probabilidades a clases (0 o 1) con el corte de 0.5
pred_clase <- ifelse(pred_logit_prob > 0.5, 1, 0)
# 2. Convertimos AMBOS a factor asegurando que tengan los mismos niveles
pred_factor <- factor(pred_clase, levels = c("0", "1"))
real_factor <- factor(test$BikePurchase, levels = c("0", "1"))
# 3. Magia: Generamos la matriz completa
confusionMatrix(data = pred_factor, reference = real_factor)
# 1. Pide la clase directamente (type = "class")
pred_clase_arbol <- predict(modelo_arbol, newdata = test, type = "class")
# 2. Aseguramos que sea factor y tenga los mismos niveles que la realidad
# Nota: predict con type="class" ya suele devolver factor, pero esto es doble seguridad
pred_factor_arbol <- factor(pred_clase_arbol, levels = c("0", "1"))
real_factor_arbol <- factor(test$BikePurchase, levels = c("0", "1"))
# 3. Matriz
confusionMatrix(data = pred_factor_arbol, reference = real_factor_arbol)
# Ver qué variables usó realmente el árbol y cuánto importaron
modelo_arbol$variable.importance
datos_cluster_input <- datos %>%
select(where(is.numeric)) %>%
select(-BikePurchase)
datos_escalados <- scale(datos_cluster_input)
clusterizacion <- kmeans(datos_escalados, centers = 4, nstart = 25)
resumen_clusters <- datos_cluster_input %>%
mutate(Cluster = clusterizacion$cluster) %>%
group_by(Cluster) %>%
summarise(across(everything(), mean))
print(resumen_clusters)
# 1. Preparamos los datos (Usando 'clusterizacion', que es TU variable)
datos_para_arbol <- datos_cluster_input %>%
mutate(Cluster = as.factor(clusterizacion$cluster)) # <--- CORREGIDO AQUÍ
# 2. Creamos el árbol explicativo
# "Cluster ~ ." significa: Predice el Cluster usando TODAS las demás columnas
arbol_explicativo <- rpart(Cluster ~ .,
data = datos_para_arbol,
method = "class")
# 3. Lo visualizamos
rpart.plot(arbol_explicativo,
type = 2,
extra = 101,
nn = TRUE,
box.palette = "BuGn",
main = "Reglas que definen cada Cluster")
# 1. Preparamos los datos (Usando 'clusterizacion', que es TU variable)
datos_para_arbol <- datos_cluster_input %>%
mutate(Cluster = as.factor(clusterizacion$cluster)) # <--- CORREGIDO AQUÍ
# 2. Creamos el árbol explicativo
# "Cluster ~ ." significa: Predice el Cluster usando TODAS las demás columnas
arbol_explicativo <- rpart(Cluster ~ .,
data = datos_para_arbol,
method = "class")
# 3. Lo visualizamos
rpart.plot(arbol_explicativo,
type = 2,
extra = 101,
nn = TRUE,
box.palette = "BuGn",
main = "Reglas que definen cada Cluster")
# 1. Preparamos los datos (Usando 'clusterizacion', que es TU variable)
datos_para_arbol <- datos_cluster_input %>%
mutate(Cluster = as.factor(clusterizacion$cluster)) # <--- CORREGIDO AQUÍ
# 2. Creamos el árbol explicativo
# "Cluster ~ ." significa: Predice el Cluster usando TODAS las demás columnas
arbol_explicativo <- rpart(Cluster ~ .,
data = datos_para_arbol,
method = "class")
# 3. Lo visualizamos
rpart.plot(arbol_explicativo,
type = 2,
extra = 101,
nn = TRUE,
box.palette = "BuGn",
main = "Reglas que definen cada Cluster")
datos_para_arbol <- datos_cluster_input %>%
mutate(Cluster = as.factor(clusterizacion$cluster)) # <--- CORREGIDO AQUÍ
# 2. Creamos el árbol explicativo
# "Cluster ~ ." significa: Predice el Cluster usando TODAS las demás columnas
arbol_explicativo <- rpart(Cluster ~ .,
data = datos_para_arbol,
method = "class")
# 3. Lo visualizamos
rpart.plot(arbol_explicativo,
type = 2,
extra = 101,
nn = TRUE,
box.palette = "BuGn",
main = "Reglas que definen cada Cluster")
datos_para_arbol <- datos_cluster_input %>%
mutate(Cluster = as.factor(clusterizacion$cluster)) # <--- CORREGIDO AQUÍ
# 2. Creamos el árbol explicativo
# "Cluster ~ ." significa: Predice el Cluster usando TODAS las demás columnas
arbol_explicativo <- rpart(Cluster ~ .,
data = datos_para_arbol,
method = "class")
# 3. Lo visualizamos
rpart.plot(arbol_explicativo,
type = 2,
extra = 101,
nn = TRUE,
box.palette = "BuGn",
main = "Reglas que definen cada Cluster")
datos_para_arbol <- datos_cluster_input %>%
mutate(Cluster = as.factor(clusterizacion$cluster)) # <--- CORREGIDO AQUÍ
# 2. Creamos el árbol explicativo
# "Cluster ~ ." significa: Predice el Cluster usando TODAS las demás columnas
arbol_explicativo <- rpart(Cluster ~ .,
data = datos_para_arbol,
method = "class")
# 3. Lo visualizamos
rpart.plot(arbol_explicativo,
type = 2,
extra = 101,
nn = TRUE,
box.palette = "BuGn",
main = "Reglas que definen cada Cluster")
#| include: false
getwd()
setwd("/Users/alejandrocamposlamas/Proyectos/ACTIVIDADES_UNIR/actividad-3-AnalisisDatos")
library(readxl)
library(dplyr)
library(caret) # para matriz de confusión
library(rpart) #Para realizar el árbol
library(rpart.plot) #Para dibujar el árbol
library(factoextra) # para clusteres
library(NbClust)
library(forecast)
getwd()
#| include: false
# cargamos datos
datos <- read_excel("datos/DataSet SQL_Act3_ADMN.xlsx",
sheet = "Var Discreta Adq Bicicleta")
# vemos la estructura y convertimos los datos a su formato adecuado
# str(datos)
# colSums(is.na(datos)) # verificamos que no existe ningun null
# datos[is.na(datos)] <- 0 # valores nulos se reemplazarían por 0
# Quitamos la columna PersonType dado que todos su valores son IN
datos <- datos%>% select(!PersonType)
#quitamos aquellas paises que son agrupaciones
datos <- datos %>%
filter(!(Country %in% c("Northwest", "Southeast", "Central", "Southwest", "Northeast")))
# a factores datos que son categorías
datos$Education <- as.factor(datos$Education)
datos$PersonID <- as.factor(datos$PersonID)
datos$CustomerID <- as.factor(datos$CustomerID)
# Los booleanos le creamos una columna condicional
#BikePurchase
#HomeOwnerFlag
datos <- datos %>%
mutate(
BikePurchase_f = factor(BikePurchase, labels=c("FALSE", "TRUE")),
HomeOwnerFlag_f = factor(HomeOwnerFlag, labels=c("FALSE", "TRUE"))
)
#str(datos)
#| include: false
getwd()
setwd("/Users/alejandrocamposlamas/Proyectos/ACTIVIDADES_UNIR/actividad-3-AnalisisDatos")
library(readxl)
library(dplyr)
library(caret) # para matriz de confusión
library(rpart) #Para realizar el árbol
library(rpart.plot) #Para dibujar el árbol
library(factoextra) # para clusteres
library(NbClust)
library(forecast)
getwd()
datos <- read_excel("datos/DataSet SQL_Act3_ADMN.xlsx",
sheet = "Var Discreta Adq Bicicleta")
datos <- read_excel("datos/DataSet SQL_Act3_ADMN.xlsx",
sheet = "Var Discreta Adq Bicicleta")
str(datos)
datos <- read_excel("datos/DataSet SQL_Act3_ADMN.xlsx",
sheet = "Var Discreta Adq Bicicleta")
str(datos)
unique(datos$Country)
datos <- read_excel("datos/DataSet SQL_Act3_ADMN.xlsx",
sheet = "Var Discreta Adq Bicicleta")
# str(datos)
unique(datos$Country)
#| include: false
# cargamos datos
datos <- read_excel("datos/DataSet SQL_Act3_ADMN.xlsx",
sheet = "Var Discreta Adq Bicicleta")
# vemos la estructura y convertimos los datos a su formato adecuado
# str(datos)
colSums(is.na(datos)) # verificamos que no existe ningun null
# datos[is.na(datos)] <- 0 # valores nulos se reemplazarían por 0
# Quitamos la columna PersonType dado que todos su valores son IN
datos <- datos%>% select(!PersonType)
#quitamos aquellas paises que son agrupaciones
datos <- datos %>%
filter(!(Country %in% c("Northwest", "Southeast", "Central", "Southwest", "Northeast")))
# a factores datos que son categorías
datos$Education <- as.factor(datos$Education)
datos$PersonID <- as.factor(datos$PersonID)
datos$CustomerID <- as.factor(datos$CustomerID)
# Los booleanos le creamos una columna condicional
#BikePurchase
#HomeOwnerFlag
datos <- datos %>%
mutate(
BikePurchase_f = factor(BikePurchase, labels=c("FALSE", "TRUE")),
HomeOwnerFlag_f = factor(HomeOwnerFlag, labels=c("FALSE", "TRUE"))
)
str(datos)
# cargamos datos
datos <- read_excel("datos/DataSet SQL_Act3_ADMN.xlsx",
sheet = "Var Discreta Adq Bicicleta")
# vemos la estructura y convertimos los datos a su formato adecuado
# str(datos)
colSums(is.na(datos)) # verificamos que no existe ningun null
# datos[is.na(datos)] <- 0 # valores nulos se reemplazarían por 0
# Quitamos la columna PersonType dado que todos su valores son IN
datos <- datos%>% select(!PersonType)
#quitamos aquellas paises que son agrupaciones
datos <- datos %>%
filter(!(Country %in% c("Northwest", "Southeast", "Central", "Southwest", "Northeast")))
# a factores datos que son categorías
datos$Education <- as.factor(datos$Education)
datos$PersonID <- as.factor(datos$PersonID)
datos$CustomerID <- as.factor(datos$CustomerID)
# Los booleanos le creamos una columna condicional
#BikePurchase
#HomeOwnerFlag
datos <- datos %>%
mutate(
BikePurchase_f = factor(BikePurchase, labels=c("FALSE", "TRUE")),
HomeOwnerFlag_f = factor(HomeOwnerFlag, labels=c("FALSE", "TRUE"))
)
str(datos)
# cargamos datos
datos <- read_excel("datos/DataSet SQL_Act3_ADMN.xlsx",
sheet = "Var Discreta Adq Bicicleta")
# vemos la estructura y convertimos los datos a su formato adecuado
# str(datos)
# colSums(is.na(datos)) # verificamos que no existe ningun null
# datos[is.na(datos)] <- 0 # valores nulos se reemplazarían por 0
# Quitamos la columna PersonType dado que todos su valores son IN
datos <- datos%>% select(!PersonType)
#quitamos aquellas paises que son agrupaciones
datos <- datos %>%
filter(!(Country %in% c("Northwest", "Southeast", "Central", "Southwest", "Northeast")))
# a factores datos que son categorías
datos$Education <- as.factor(datos$Education)
datos$PersonID <- as.factor(datos$PersonID)
datos$CustomerID <- as.factor(datos$CustomerID)
# Los booleanos le creamos una columna condicional
#BikePurchase
#HomeOwnerFlag
datos <- datos %>%
mutate(
BikePurchase_f = factor(BikePurchase, labels=c("FALSE", "TRUE")),
HomeOwnerFlag_f = factor(HomeOwnerFlag, labels=c("FALSE", "TRUE"))
)
str(datos)
colSums(is.na(datos))
#| include: false
# cargamos datos
datos <- read_excel("datos/DataSet SQL_Act3_ADMN.xlsx",
sheet = "Var Discreta Adq Bicicleta")
# vemos la estructura y convertimos los datos a su formato adecuado
# str(datos)
#colSums(is.na(datos)) # verificamos que no existe ningun null
# datos[is.na(datos)] <- 0 # valores nulos se reemplazarían por 0
# Quitamos la columna PersonType dado que todos su valores son IN
datos <- datos%>% select(!PersonType)
#quitamos aquellas paises que son agrupaciones
datos <- datos %>%
filter(!(Country %in% c("Northwest", "Southeast", "Central", "Southwest", "Northeast")))
# a factores datos que son categorías
datos$Education <- as.factor(datos$Education)
datos$PersonID <- as.factor(datos$PersonID)
datos$CustomerID <- as.factor(datos$CustomerID)
# Los booleanos le creamos una columna condicional
#BikePurchase
#HomeOwnerFlag
datos <- datos %>%
mutate(
BikePurchase_f = factor(BikePurchase, labels=c("FALSE", "TRUE")),
HomeOwnerFlag_f = factor(HomeOwnerFlag, labels=c("FALSE", "TRUE"))
)
datos
#| include: false
# cargamos datos
datos <- read_excel("datos/DataSet SQL_Act3_ADMN.xlsx",
sheet = "Var Discreta Adq Bicicleta")
# vemos la estructura y convertimos los datos a su formato adecuado
# str(datos)
#colSums(is.na(datos)) # verificamos que no existe ningun null
# datos[is.na(datos)] <- 0 # valores nulos se reemplazarían por 0
# Quitamos la columna PersonType dado que todos su valores son IN
datos <- datos%>% select(!PersonType)
#quitamos aquellas paises que son agrupaciones
datos <- datos %>%
filter(!(Country %in% c("Northwest", "Southeast", "Central", "Southwest", "Northeast")))
# a factores datos que son categorías
datos$Education <- as.factor(datos$Education)
datos$PersonID <- as.factor(datos$PersonID)
datos$CustomerID <- as.factor(datos$CustomerID)
# Los booleanos le creamos una columna condicional
#BikePurchase
#HomeOwnerFlag
datos <- datos %>%
mutate(
BikePurchase_f = factor(BikePurchase, labels=c("FALSE", "TRUE")),
HomeOwnerFlag_f = factor(HomeOwnerFlag, labels=c("FALSE", "TRUE"))
)
print(datos)
# cargamos datos
datos <- read_excel("datos/DataSet SQL_Act3_ADMN.xlsx",
sheet = "Var Discreta Adq Bicicleta")
# vemos la estructura y convertimos los datos a su formato adecuado
# str(datos)
#colSums(is.na(datos)) # verificamos que no existe ningun null
# datos[is.na(datos)] <- 0 # valores nulos se reemplazarían por 0
# Quitamos la columna PersonType dado que todos su valores son IN
datos <- datos%>% select(!PersonType)
#quitamos aquellas paises que son agrupaciones
datos <- datos %>%
filter(!(Country %in% c("Northwest", "Southeast", "Central", "Southwest", "Northeast")))
# a factores datos que son categorías
datos$Education <- as.factor(datos$Education)
datos$PersonID <- as.factor(datos$PersonID)
datos$CustomerID <- as.factor(datos$CustomerID)
# Los booleanos le creamos una columna condicional
#BikePurchase
#HomeOwnerFlag
datos <- datos %>%
mutate(
BikePurchase_f = factor(BikePurchase, labels=c("FALSE", "TRUE")),
HomeOwnerFlag_f = factor(HomeOwnerFlag, labels=c("FALSE", "TRUE"))
)
print(datos)
View(datos)
#| include: false
# describimos los estadísticos numéricos
datos %>% select(where(is.numeric)) %>% summary(use="complete.obs")
# observamos cómo se relacionan las variables
datos %>% select(where(is.numeric)) %>% cor(use="complete.obs")
# describimos los estadísticos numéricos
datos %>% select(where(is.numeric)) %>% summary(use="complete.obs")
# observamos cómo se relacionan las variables
datos %>% select(where(is.numeric)) %>% cor(use="complete.obs")
