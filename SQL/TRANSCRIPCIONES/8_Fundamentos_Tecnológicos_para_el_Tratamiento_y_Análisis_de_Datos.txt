Y empezamos. en consultas sql vale es decir yo os voy a pedir ciertas consultas y vosotros vais a tener que escribir el código de acuerdo si recordáis la base de datos y el word están en la sección de scripts vale y en esta carpeta vale que era consulta sql alumnos entonces aquí tenéis la base de datos tanto para SQL Server como para MySQL y el Word, ¿vale? Que es este de aquí, ¿de acuerdo? Que tiene un total de 8 consultas. Ahora, poco de repaso, ¿qué es lo que tenéis que hacer? Pues simplemente descargáis el archivo SQL, ¿vale? Ya sea de MySQL o de SQL Server, abrís la herramienta, cargáis el archivo, ¿vale? Yo de hecho lo tengo aquí, ¿vale? Lo tengo aquí descargado, pues simplemente lo abrís y lo ejecutáis una vez, ¿vale? Os recuerdo que si lo ejecutáis más de una vez, pues SQL se os va a quejar porque, bueno, estáis intentando volver a crear la tabla, lo cual pues no permite. una vez hecho esto y antes de empezar con la actividad como tal siempre os voy a pedir que reviséis cuál es el contenido de las tablas es decir, vais, abrís un archivo nuevo y revisáis todas las tablas por ejemplo, tabla de alumnos, que tenéis aquí de alumno y de expediente vale en esencia podríamos considerar casi que es la misma clave porque es una relación uno a uno pero la primaria es alumno profesores asignaturas expediente que aquí tenemos el líder de matrícula asignatura matrícula y expediente vale están relacionados con alumnos y tenemos examen vale Hemos seguido de examen, año de matrícula, convocatoria, si ha hecho o no el examen, asignatura, profesor, alumno y la calificación obtenida. Una vez que ya hemos visto la base de datos, que en este caso son cinco tablas y más o menos tenemos una idea de cómo está estructurada, ¿vale? Ya sí que podemos empezar con la actividad, ¿vale? Que en este caso hay simplemente ocho consultas que necesito que hagáis, ¿vale? Y básicamente, al igual que en las actividades opcionales y en la actividad que vais a entregar, yo lo que busco no es el resultado de la consulta, ¿vale? Quiero dejarlo claro, sino lo que necesito es el código, ¿vale? Es decir, cuando vayáis a entregar, quiero que entreguéis el código. Bien, por lo tanto, vamos a empezar, ¿vale? La primera consulta nos dice obtener el nombre, los alumnos, cuyo nombre empieza por la letra E y hayan nacido en una ciudad cuyo nombre tenga al menos 5 caracteres. ¿De acuerdo? Sí que es verdad que yo esta parte no la he explicado, que ya lo dije la semana pasada. ¿Por qué? Porque habrá veces que yo os empuje a que busquéis una función específica. ¿De acuerdo? Pero en esencia, el temario se lo he vendido sí que bien. Entonces, cuando empezamos con una consulta, lo primero es identificar la tabla, que en este caso, bastante sencillo, ¿verdad? ¿Qué tabla es? La tabla de alumnos. ¿Vale? Bien, el segundo paso es ver si hay que combinar alguna tabla más. En este caso, pues no aplica. ¿De acuerdo? Después vemos los filtros a nivel de fila, ¿vale? Es decir, el web. En este caso, ¿tenemos cuántos filtros a nivel de web? ¿Cuántos filtros tenemos? Dos. Dos, por una parte, que empieza por la letra E y por otro lado, que la ciudad tenga al menos cinco caracteres. Por lo tanto, este primero sí lo sabemos hacer. ¿Cuál es la función que nos permite filtrar aunque no conozcamos la totalidad del dato? Like. Eso es. Especificamos que like y después un porcentaje. ¿Por qué? Porque queremos darle, o indicar mejor dicho, SQL que empiece por la letra E. Y el porcentaje hace referencia de que, bueno, hay más caracteres, pero el que a mí me interesa es que empiece por la letra E. ¿De acuerdo? Y después hay uno segundo, ¿verdad? Que es que la ciudad contenga cinco caracteres. Aquí hay varias maneras de filtrar por los caracteres que es, primero, utilizando el propio light, ¿vale? Que sería, tiranacimiento light, y en vez de especificar nada, podemos especificar 5 caracteres. 1, 2, 3, 4 y 5 ¿Vale? Con ello Nos lo filtraría Y la versión más pro ¿Vale? Sería que Utilizar una función específica Para ello. ¿Alguien la ha buscado? Sí, profe, leen Eso es, leen ¿Vale? Que leen básicamente Lo que hacen los 7, ¿vale? Antes de ponerlo aquí Vamos simplemente a ponerlo aquí en alumnos con lo que nos pide, ¿vale? Que es len de ciudad de nacimiento. ¿De acuerdo? Len lo que hace es que nos cuenta el número de caracteres de las ciudades. Por ejemplo, Madrid tiene 6, Barcelona tiene 9. ¿Vale? Entonces, nosotros lo que buscamos es, básicamente, especificar que la ciudad de nacimiento, es decir, el len de ciudad de nacimiento, sea ¿qué? Mayor o igual que 5. ¿vale? entonces si ahora ejecuto esto efectivamente ¿cuántos alumnos tengo? uno Esteban ¿no? porque su nombre empieza por E y la ciudad de nacimiento tiene más de 5 caracteres porque es Barcelona ¿vale? y lo último que quedaría realmente es en el CEL ¿vale? que simplemente sería especificar el nombre del alumno ¿ok? dudas fácil, ¿no? ¿qué pena podrías mostrar nuevamente cómo cuentan los caracteres cuando pones len en select? por favor, sí, lo podemos poner aquí fijaros, vale, ahora sí que es verdad que ahora solo va a aparecer el de un registro, pero imaginad que no aplico el web, vale pongo aquí el len y me cuenta los caracteres y fijaros, podríamos confundirnos con que esto es una función de agregación ¿Qué creéis? ¿Es una función de agregación? ¿Sí o no? No ¿Por qué? Es una Porque no es una función de agregación Porque no está operando Eso es Diferentes columnas Diferentes Entonces es Es una función Es una función normal y corriente Como dice el compañero, ¿por qué? Lo único que hace es que por cada fila me cuenta el número de caracteres, ¿vale? Es decir, no me está haciendo recuento, ni sumando, es decir, no me está haciendo ninguna operación aritmética como tal, ¿vale? Y la otra forma de saber y de estar seguro que no lo es, es que fijaros, si fuese una función de agregación, y nosotros tenemos aquí el nombre del alumno, ¿qué pasaría? Nos pediría el groupby, ¿vale? Es decir, teníamos que agrupar. En este caso, como veis, no aplica. ¿De acuerdo? Y como ha dicho movida el compañero, efectivamente, lo único que hace es que por cada ciudad le dice, vale, cuántos caracteres hay y te devuelve el número. ¿Vale? Es decir, no te hace una operación aritmética en base a un campo específico en referencias matemáticas, porque se decir lo de hacer un recuento, hacer un sumatorio, un promedio, una mediana, nada de eso. Simplemente por cada fila cuenta los caracteres. Sin más. ¿Ok? ¿Sí? Bien. Seguimos. Seguimos. obtener el nombre de los alumnos que convierten por la letra A y hayan nacido en Madrid o Barcelona. Primer punto, la tabla. Una vez más, es la tabla de alumnos. ¿Vale? ¿Cuántos filtros? Bueno, tenemos que combinar con alguna otra tabla En este caso No, ¿verdad? Ahora, a nivel de filtro de web A nivel de fila, ¿tenemos algún filtro? ¿Cuántos tenemos? Dos Uno, que es Clavator que teníamos arriba Es decir, nombre del alumno Like, solo que en vez de empezar con la letra E empieza por la letra A, ¿vale? Y el segundo es que hayan nacido en Madrid o Barcelona. Y fijaros, aquí tenemos un conjunto de datos por el que queremos filtrar, ¿cierto? Entonces, ¿qué función utilizamos para un conjunto de datos? Es decir, si tenemos uno, utilizamos igual, distinto de, si es numérico mayor, menor o igual. Pero si son dos, como en este caso, Madrid o Barcelona, ¿qué opciones tenemos? Eso es, el IN, ¿vale? ¿Está la opción del OR? Sí, y acá lo veremos, ¿vale? Para saber que el OR es peligroso, ¿vale? Pero efectivamente, ciudad de nacimiento, especificamos IN y las dos ciudades, ¿vale? Madrid y Barcelona. ¿Vale? Y fijaros, si yo ejecuto esto, no me devuelve nada, ¿vale? Y ahora os pregunto, ¿por qué no me devuelve nada? Y vuelvo a mostrar toda la tabla. ¿por qué no me aparece ningún valor? porque fijaros no hay un estudiante, exacto no hay ningún estudiante que empiece por la letra A de esas dos ciudades eso es, pues la letra A solo hay uno que es Antonio de Barajón, entonces ¿qué pasa? no se cumple, entonces por eso no devuelve un resultado cero, ¿es esto normal? pues puede pasar perfectamente en la vida que nosotros busquemos algo que realmente no existe. ¿Vale? Bien, así que efectivamente no devuelve nada. ¿Esto puede pasar una actividad? Puede pasar. Profe, una consulta. Sí, dime. ¿El correo de eso salió toda la tabla? ¿El qué? Si yo ejecuto solo esto, el Selefron me devuelve todo. ¿Con la condición? Pero con la condición no me devuelve nada. ya, gracias, pensé que salió la tabla no, no, no, solo sale esto por eso normalmente suelo seleccionar y ejecutarlo y dejarlo seleccionado para que veáis un poco la diferencia, pero no, esto es toda la tabla y si yo haga filtro no va a aparecer nada y como os decía, esto puede pasar en una actividad, el examen rara vez pasa no creo que vaya a pasar pero que como decía, en la actividad sobre todo en las entregables vale lo que yo busco el código aunque no nos devuelva nada, revisad bien, lo mismo os habéis equivocado o lo mismo es que de verdad es así, es decir, que lo que se está pidiendo no devuelve ningún valor, ¿vale? Bien, partiendo de la base de que no nos devuelve nada, vamos a hacer este ejemplo pero con el OR, ¿vale? Entonces yo le digo al SQL, oye, ciudad de nacimiento sea igual a Madrid o ciudad de nacimiento sea igual a Barcelona, ¿vale? Y fijaros, yo ejecuto, pero ahora sí me devuelven datos. ¿Por qué? ¿Por qué? ¿Por qué se cumple una de las condiciones que es Madrid o Barcelona o que te inicie con la letra A? No. Bueno, sí, realmente sí. Pero la cuestión es que SQL no entiende de nombre de alumno que empiece por la letra A o esto. SQL entiende que empiece por la letra A y que sea de Madrid o que sea de Barcelona. Por esa razón ahora me aparecen aquí dos registros, porque ambos son de Barcelona, pero fijaros, ninguno de los dos empieza por la letra A. ¿De acuerdo? Por lo tanto, si quiero especificar que sea esta o esta, yo el OR lo tengo que especificar entre paréntesis. ¿Vale? Ahora sí está entendiendo lo que nosotros queremos transmitirle. ¿De acuerdo? Pero vuelvo a insistir, ahí la razón podemos decir de que yo os pida que utilicéis IN, ¿vale? Porque con el OR os podéis equivocar. Más adelante, si lo queréis utilizar, utilizadlo. O si yo específicamente os pido que lo utilicéis, que puede pasar el caso, os lo haré saber. ¿Vale? Pero en términos generales, por favor, utilizad el IN. ¿De acuerdo? Sí, profesor. Obviamente nos hace falta la tabla de alumnos, ¿verdad? Pero, ¿nos hace falta alguna otra tabla? Profesores. Profesores, ¿verdad? Eso es. Y ahora os pregunto, ¿yo puedo combinar estas dos tablas directamente? No. No puedo, como lo sabemos. No hay ninguna clave que nos lo permita hacer. entonces lo más probable es que tenga que utilizar cualquier otra. Y en este caso, de hecho, tenemos dos posibilidades. Podemos utilizar expediente. ¿Por qué? Porque aquí tenemos asignatura y expediente. Y recordad que alumnos tiene también una clave de expediente, no en la primaria, pero es una clave. Y tenemos exámenes. Que realmente aquí también vienen todos los registros. Entonces vamos a partir, vamos a utilizar en este caso la de exámenes. Pero vuelvo a insistir, también se puede hacer con expediente. ¿Vale? Entonces ya sabemos que nos hacen falta tres tablas. Alumnos, profesores y exámenes. Entonces vamos a proceder a combinarlas. ¿Vale? Como buena práctica, siempre que se hace una consulta, se suele empezar con la tabla que tiene mayor número de registros. ¿Vale? En este caso, entre alumnos, profesores y exámenes, la que más es la D. De acuerdo, por lo tanto será nuestra primera tabla. Especificamos también el alias, después el inner join y cuál de las dos combinamos ahora es un poco irrelevante. Vamos a poner, por ejemplo, alum. Segunda tabla, alias, y aquí especificamos id de alumno que sea igual a id de alumno. ¿vale? y con ello obtenemos el resultado ¿vale? ahora bien me preguntaréis oye ¿lo mismo hay que utilizar left join o right join? pues cuando vayáis a hacer esta actividad que algunos habréis empezado y otros no pues os animo que probéis a ver si os da un resultado diferente y que elijáis cuál es el correcto yo para resolver lo que es la parte del web y demás lo vamos a basar en el INE bien hemos hecho la primera combinación y ahora nos hace falta la segunda. ¿Vale? Profesores. Y especifico. Y de profesor, que sea igual a y de profesor. Hay que fijaros, me he dado error. ¿Por qué? ¿Dónde me he equivocado? Porque está tomando la tabla de alumnos. Eso es. Fijaros, estoy diciendo de profesor de la tabla de alumnos. Alumnos no tiene ningún profesor. Me he equivocado de alias. ¿Vale? Es PR, que es profesor, el ID profesor, que sea igual al ID profesor de exámenes. Bien. Bien. He hecho esto. ¿Qué me queda? Filtrar a nivel de web y filtrar en el cell. A nivel de web, ¿cuántos filtros tenemos? ¿Cuántos filtros tenemos en el web? Uno. ¿Uno? Bueno, técnicamente serían, ¿qué? Dos. ¿Por qué? Porque sería nombre de profesor que sea Manuel. y apellido sea Rui que en esencia es uno, porque es el mismo profesor claro que se divide en dos partes y finalmente tendríamos el select donde iríamos creamos el DNI y el nombre del alumno ¿vale? bien, ahora tenemos aquí los alumnos ¿Hay duplicaciones? Que las puede haber ¿Por qué? Porque un alumno se ha presentado Suspendido y se ha vuelto a presentar Sí ¿Hay verdad? ¿Os acordáis De qué manera podíamos quitar Las duplicaciones? Con this distinct Eso es, muy bien En el select especificamos distinct Y ahora fijaros, en vez de 11 registros registros tengo 8 es decir quito las duplicaciones vale imaginad que no especifica es el distinct por ejemplo en poner un ejemplo en la actividad entregable tampoco voy a quitar puntos por ello vale porque todo lo más estaría bien pero en la medida lo posible si veis que hay duplicaciones pues quitarla con el disting para que sea más presentable el resultado vale dudas al momento todo bien va seguimos qué pesadito era yo con los dni en aquella época vale obtener los dni el nombre los alumnos vamos a poner que se han matriculado en visualización avanzada de datos en el curso 2019 vale primero las tablas una parte tenemos la tabla nos hace falta la tabla de alumnos que da de ney en el nombre y después nos hace falta la tabla de matrículas vale en este caso la tabla d expediente En la tabla de expediente viene el ID de matrícula, asignatura, año matrícula y expediente. Ahora bien, ¿puedo combinar estas dos tablas? Sí, no a través de ID alumno, pero sí a través de ID expediente, porque tampoco se repite. No es la clave primaria, pero es única. Entonces, lo primero sería que combinar ambas tablas. expediente inerjo alumnos y especifico x y d expediente que sea igual a alumno pero fijaros no me devuelve nada ¿por qué? ¿Por qué? Voy a poner la tabla de alumnos, ¿vale? Porque se está poniendo ID alumno, es ID expediente. Claro, esto conviene con dos claves que no tienen nada que ver, ¿vale? También es ID expediente, eso es. Tened cuidado con esto, ¿vale? Porque es muy probable que nos equivoquemos con las prisas con las claves. Bien. Ya tenemos las tablas y ahora vamos con el filtro a nivel de registro, a nivel de fila. El web. ¿Cuántos filtros tenemos aquí? ¿Cuántos filtros a nivel de fila tenemos? Uno. ¿Uno? Dos. Dos, ¿verdad? Es decir, por una parte tenemos el año de matrícula, ¿verdad? Que es 2019. ¿Y qué ocurre? Y tenemos otro más que es que la asignatura ¿No? ¿Pero qué ocurre? Aquí no tenemos el nombre de asignatura Ergo Cuando estamos combinando nos ha faltado Combinar la tabla de qué La asignatura ¿Vale? Pues volvemos al Join Asignaturas donde idea asignatura sea igual a idea asignatura de expedientes y aquí que filtraríamos el nombre de la asignatura que sea igual a visualización avanzada de datos y fijaros, yo ejecuto esto y no me devuelve nada y aquí puede haber varias razones Lo primero es que me haya equivocado en algún web, perdón, en algún join, porque ya hemos visto que, no, en principio está todo bien. ¿Dónde creéis que no hemos podido equivocar? Año 2019 está. No es visualización avanzada, sino visualización de datos. eso es, fijaros aquí en el requerimiento pongo visualización avanzada de datos cuando realmente es visualización de datos ¿vale? esto puede pasar en la vida real que os diga que algo se llama de una manera pero realmente es parecida pero no es igual ¿vale? obviamente en la actividad y en el examen no voy a poner cosas de este tipo ¿vale? pero que igualmente imaginad que vosotros me entregáis esto ¿vale? y que después sea visualización de datos yo os lo daré por val vale es decir si os equivocáis en la string entrando no pasa nada vale lo que me importa que sepáis cómo filtrar si dime algo lucía pero una consulta es que esto también pasó en el ejercicio anterior uno debe de unir las cosas por ejemplo yo puedo hacer la consulta del id de asignatura y directamente poner ese id para no digamos unir tantas tablas o el ejecutivo no está pidiendo el nombre. Hacer esto, ¿no? ¿Esto? Sí. Correcto. Esto estaría mal. ¿Vale? ¿Por qué? Porque sería un poco trampa. Es decir, yo entiendo que has ido a buscar la asignatura y después la has filtrado aquí. Si me lo pones así, no. Te diría, oye, yo lo que estoy pidiendo es que me filtres por el nombre. ¿Vale? Ahora, imagínate. Tú, en vez de hacerlo así, me haces una subconsulta y me dices, oye, select id asignatura from asignaturas donde la asignatura es igual a visualización de datos. Si me haces esto, sé que te lo daría por válido. ¿vale? pero si me vais a utilizar los códigos no ¿vale? vale, profe, gracias perfecto entonces, como decía cuidado, es decir fijaros bien, pero que en el caso de la asignatura, yo soy flexible en esto, ¿vale? pero sí que verás que en la vida real, cuidado que puede haber este tipo de malentendidos vale y finalmente nos quedaría el dni y él nombre del alumno vale y efectivamente serían estos 4 de acuerdo dudas claro, ¿no? va, bien, ahora viene que yo creo que es la más complicada de todas de esta actividad ¿vale? y aquí es donde de hecho vais a ver de una forma clara el uso una buena manera de entender el uso de las subconsultas, ¿vale? porque habrá veces que la única manera de que podamos hacer algo es mediante el uso de subconsultas, si no sería imposible. Aquí nos pide obtener el listado de los alumnos que hayan obtenido una nota más alta en septiembre, es decir, la nota de septiembre tiene que ser más alta que la nota media general de junio. En ambos casos en el año 2018. Es decir, primero tengo que saber la nota media de junio en el año 2018 y después ver de la convocatoria de septiembre quién ha sacado en su nota una nota media más alta, perdón, una calificación más alta que la nota media de junio, ¿vale? De hecho es muy rebuscado esto, pero nos podríamos encontrar con esto en la vida real, ¿vale? Entonces, lo primero que tenemos que hacer, tenemos que saber cuál es efectivamente la nota media en la convocatoria de junio del año 2018. Para ello recurro a mi tabla de exámenes. Ahora, primero tengo que filtrar. ¿Cuántos filtros tengo que aplicar aquí? Por una parte, el año, ¿no? Que el año de matrícula sea 2018. Y por otra parte, que la convocatoria sea, ¿qué? Junio, ¿cierto? Sí, profesor. Ahora bien, ¿cómo calculo la media? ¿Mediante qué? Mediante La función de agregación average Eso es, función de agregación average Y Si yo ejecuto esto Obtengo que la nota media es 5,78 ¿Vale? Es decir Su consulta la tengo hecha Ahora que tengo que hacer la consulta principal Que es una vez más Exámenes ¿Vale? Empiezo con exámenes ¿Y qué más tablas me hacen falta? ¿Me hacen falta alguna tabla más? Alumnos Eso es, alumnos Por lo tanto, innerjoin Alumnos Y aquí Las claves Idea alumno que sea igual A idea alumno ¿Vale? Ahora, filtros a nivel de web. ¿Tenemos cuántos? Dos también, ¿no? Por una parte, el año de matrícula es el mismo, es decir, tiene que ser 2018. Pero eso sí, la convocatoria... Por cierto, los alias se me escapan. Convocatoria tiene que ser qué? septiembre. ¿Vale? Y finalmente, ¿qué le tengo a especificar? Que la calificación que se obtiene es mayor que la media. Es decir, calificación tiene que ser mayor o igual que 5,78. Porque es lo que obtenemos aquí. ¿Vale? Pero ¿qué ocurre? Yo no tengo que poner aquí el 5,78. si no, lo voy a hacer que voy a incluir aquí la propia subconsulta. ¿Vale? Ok. Y pues finalmente aquí en el select, el nombre del alumno. De hecho, fijaros, vamos a poner también la calificación. ¿Vale? Para que lo tengamos claro. Y fijaros, efectivamente, sabemos que la nota media de junio de 2018 era 5,78, y ahora tenemos Antonio, Javier y Manuel que han obtenido 6, 8 y 10. ¿En qué asignaturas? Pues en estas de aquí. Si quiero saber cuál es el nombre de estas asignaturas, ¿qué puedo hacer? Pues combinar con asignatura. Y así veríamos el nombre. ¿De acuerdo? Pero como veis, esta consulta, la única forma de resolverla es mediante subconsultas. ¿Vale? ¿Por qué? Os advierto de cara a entrar en la actividad o al examen. Yo siempre os pido una consulta. Si lo que me traigáis es primero esto y saco aquí un 578 y lo pongo aquí, os daré la consulta válida, pero solo por la mitad de los puntos. Habéis llegado al mismo destino, pero lo habéis dividido en dos consultas en vez de una. Así que tener eso en cuenta. ¿Sí? Eso último no lo entendí, perdón. Que si pides una consulta no se puedan hacer dos subconsultas. Lo repito, no os preocupéis. Pero básicamente, es decir, lo correcto sería que hay una consulta dentro de otra. Lo que no sería correcto es que me entreguéis esto. decir, vale, es un 5,78 y me lo pongáis aquí que lo que me estáis entregando realmente son dos consultas diferentes o sea, dos consultas que están relacionadas pero no dejan de ser dos consultas, ¿vale? lo que tenéis que entregar es esto una consulta dentro de otra ¿vale? vale precisamente Alejandro, fijaros hace estas preguntas, ¿vale? las voy a poner aquí porque va a ser más fácil de leerlo ¿vale? sobre los joists ¿no tiene más sentido sacar las tablas sin joists y luego modelar en Power BI? bueno, esto sale un poco del tema, pero, de lo que estamos haciendo, pero ok tú te refieres, Alejandro, de directamente, ¿no? imagínate, ¿no? cojo todas estas tablas, las pongo en Power BI y las conecto, ¿no? claro, o sea que al final son tablas algunas de dimensiones que le faltan dimensiones pues busco las dimensiones en otras tablas de dimensiones, pues si me hago un modelo tipo copo de nieve pues no tengo que estar haciendo joins. Lo que dices que tiene sentido, pero ¿tú crees que estos son tablas de hechos y tablas de dimensiones? Son todas algunas son de dimensiones y otras ninguna de ellas no son ni dimensiones ni tablas de hechos a ver, realmente tablas de hechos de dimensiones se alimentan de las tablas transaccionales ¿vale? esto es algo que de hecho veremos en el tema 4 pero en esencia por ejemplo tú me dices no es mejor simplemente cargar esas tablas las puedes cargar y las puedes conectar simulando como si fuesen dimensiones y hechos ¿vale? no habría ningún problema pero, ¿qué ocurre si tú no puedes conectar Power BI a las tablas? y tienes que obtener la información de aquí, puedes darse el caso entonces, depende, depende de la empresa ahora bien, ¿es más fácil ponerlo en Power BI y empezar a trabajar de ahí? puedes hacerlo no habría problema, obtendrías los mismos resultados pero que la finalidad realmente de mi asignatura no es modelar en Power BI, que podríamos hacerlo, ¿vale? Es aprender el lenguaje de SQL como tal, ¿vale? Es decir, en comparación con otras asignaturas, hay maneras de hacerlo más fácil, seguramente, ¿vale? Pero que vuelvo a insistir, la prioridad de esta asignatura no es simplemente el análisis o el modelado de datos, es SQL, ¿vale? la aplicación práctica esta si te digo mi opinión, por ejemplo, para que yo uso el SQL, es que precisamente por lo que me has preguntado antes imagínate que yo no tengo una tabla de dimensiones o no tengo una tabla de hechos, ingeniería de datos no me ayuda, yo aquí en este caso son 5 tablas, es algo sencillo pero en un proceso productivo de una empresa que se yo, pedidos, tú tendrías que cargar el header el detail, el product o sea, product a lo mejor sería más dimensión pero bueno, lo que es la parte de detalles, habría muchas tablas las conectarías unas con otras cuanta más tablas tengas y más relaciones tengas más lento te va a ir el verctipar, que es lo que ocurre detrás de Power BI, entonces no estaría optimizado pero si tú sabes que tienes por ejemplo tres tablas que tienen lo que tendría que tener la tabla de hechos, tú la limpias la transformas todo aquí, lo guardas como una vista y lo cargas en Power BI tu tabla de hechos, para mí eso es más sencillo que cargar 25 tablas transaccionales para simular una tabla de hechos y varias dimensiones, que es lo que pasaría realmente ¿vale? entonces, no es que no te puedo decir que no tiene más sentido utilizar como Power BI para modelar, seguramente lo tenga pero no este tipo de tablas, estas son tablas de transacciones no se deberían de meter de incluir en pavo vial vale porque no están preparadas para consumir información si incluyes tablas transaccionales de un millón tres millones cuatro millones registros empiezas a conectar simplemente por claves te diga lento no estaría optimizado vale y modelar dinámicamente en pavo que vi hay no sé qué te refieres es decir que sea más como de botón, te refieres a decir por ejemplo, tengo las tablas ¿no? decir, arrastrar para conectar claves y demás eso es lo que te refieres, ¿no? que yo, o sea, seguramente lo haya seguramente lo haya, yo de hecho sé que en idea de datos, muchos de los jobs que hacen lo hacen incluso de esa manera, pero yo realmente no lo he utilizado nunca lo que suelo hacer básicamente es el código que tengo que escribir, lo escribo en Power BI y después a través del SQL Server lo guardo como una vista, lo cargo en Power BI y hago las conexiones ahí después ¿vale? no sé si te queda alguna duda Alejandro, a ver, realmente me gusta hablar de estas cosas, me gusta que me preguntéis también de la parte real de la vida, pero que igualmente cuando estemos al final, llegando al final, cuando veremos el Data Warehouse y demás, os diré que va a haber un taller como DTL, que básicamente lo que hacemos es con AdWords works eso será el cuatrimestre que viene con atwin short works hacemos nuestras propias queries para crear nuestras tablas de hechos y dimensiones y después conectarlo todo un pavo el día vale alejandro entonces lo mismo ya el cuatrimestre que viene que llegará el aviso pues allí lo que hay lo que hacemos básicamente es un poco hacer una mini simulación de lo que hago en el trabajo en el día a día pero haciéndolo aquí perfecto es normal que te surjan dudas porque es que tampoco sé me da un poco de cosa preguntar no tanto el sector sino a qué nivel trabajas con los datos porque realmente en la empresa cuando nosotros normalmente vemos datos todo viene de aquí todo viene de SQL al final o por lo menos la mayor parte ten en cuenta que cualquier ERP cualquier CRM por detrás es una base de datos relacional es decir, cuando nosotros vemos los datos a lo mejor un informe de Dynamics o de Salesforce por detrás no deja de hacer esto ¿vale? se hace por ejemplo con conexiones como más básicas o como digo yo de botones, pero no deja de ser esto ¿vale? bien, otra pregunta ¿se podría utilizar el INEX JOIN en la subconsulta en el web del web? En este caso no aplicaría realmente, Olga, pero imagínate si fuese otro tipo de filtro que no sea numérico y yo os pido que hagáis una subconsulta, podéis utilizar tanto subconsulta en el JOIN como en el web, lo que prefiráis, ¿vale? En este caso sí que verá que no se podría, porque es un número. como tal, es decir, aquí te tienen que devolverte una clave o algún filtro a nivel de clave para que tú lo puedas combinar con un join ¿vale? vale, yo lo hice con el join y me dio el resultado ¿tienes la consulta ahí? ¿la tienes ahí a mano? dame un segundito, ya lo pongo porque lo tengo en otro en otro equipo No, pues bueno, no te preocupes Es decir, aquí en vez de esto Dime más o menos Qué es lo que hiciste, es decir Tú Lo que pasa es que No sabía el orden Lo que tú acabas de decir, que se priorizan las tablas Con mayor número de atributos Eso no pasa nada, es una buena práctica No pasa nada que hayas empezado por alumnos Y demás, no pasa nada Pues yo lo primero que hice fue En select, nombre de alumno de la tabla alumnos, hice un inner join con exámenes, el on va ligado al ID de alumno, e hice otro inner join haciendo la subconsulta. La subconsulta es con el ID de alumno, el average, que es la media, de calificación, from exámenes, where, y ahí entonces hice un filtro, where convocatoria igual a junio y matrícula igual a 2018, y lo agrupe por ID de alumno. Cerré paréntesis, on por ID de alumno, y por último hice el filtro de web con convocatoria de septiembre, matrícula 2018 y la calificación mayor a la media de junio o sea tú sacaste la media de cada alumno, que sería esto, básicamente eso vale, la media de cada alumno ¿cierto? Yo pensaría que sí Bueno, no te preocupes, Olga Voy a continuar mientras Si puedes, búscalo, o si no, ponlo en el foro Ponlo en el foro y lo pongo en el foro Y lo detallo en la aplicación Ya mismo lo pongo, profe, gracias Perfecto, sin problema Bien Bueno, seguimos, ¿alguien tiene alguna duda más? al igual que Alejandro, que pueden ser dudas genéricas que tengáis, es decir, no tiene que ser tampoco 100% de la consulta que estemos viendo que puede ser cualquier duda Yo te quería hacer una pregunta más general y quizás es un poco pronto, pero para saber más o menos cómo se va a evaluar en el examen así muy parecido a estas actividades. Sí, el examen De todas maneras vamos a tener una sesión, ¿vale? En la que yo os voy a mostrar un prototipo de examen, ¿vale? De los antiguos, de la base de datos antigua, porque lo mostraré. Pero básicamente van a ser 7 consultas, ¿vale? 5 de ellas, dificultad baja media, ¿vale? Con un punto cada uno y después va a haber 2, dificultad media alta, tirando alta, que valdrán 2,5 cada una, ¿vale? Pero en esencia serán 7 consultas. Yo os daré una base de datos con una semana de antelación, es decir, vayáis con ventaja porque vais a tener la base de datos lo vais a poder instalar y ver cómo es vale y después se ganan esas siete consultas vale a ver olga ha subido aquí el archivo vale veamos o sea básicamente la compañía está haciendo lo mismo pero ella que está haciendo aquí es decir es lo que estamos haciendo antes la media pero por cada alumno es decir la media por cada alumno no es la media general es decir que no es que tiene que ser que el alumno en cuestión su nota media de junio tiene que ser más alta que la de septiembre es decir es la nota media general pero que igualmente te puede dar el mismo resultado vale final pero no quiere decir que el planteamiento de por medio sea que sea exactamente igual vale igualmente también os digo esta consulta es muy liante vale está hecho un poco adrede para la subconsulta pero también lo que ha hecho la compañera vale también estaría de comillas bien si nos ponemos a amigas y en terminado sql olga estaba genial porque ha hecho las combinado y has hecho aquí por ejemplo poner la lógica de la calificación sea más alta que la media sin tener que es decir, sacándolo por la parte de fuera, o sea, estaría la consulta como si, estaría genial o sea, el término de manejamiento de SQL, perfecto ¿vale? que sería un poco diferente a lo que hemos hecho aquí, sí, pero vamos que igualmente, si imagínate, tú me entregas algo así, aunque no sea exactamente lo que pida, ya con el esfuerzo de haberlo hecho seguramente lo puntúe como bien ¿vale? Bien, perfecto. Seguimos entonces. Bueno, y como me preguntó María Delfina, que igualmente vamos a tener la sesión de examen, ¿vale? No os preocupéis que ahí os explicaré todo y va a ser práctico. Gracias, perfecto. Sin problema. sí, puede tener varias igual que en las actividades, Mónica puede haber varias varias maneras de llegar al mismo destino, ¿vale? lo que suele decir, efectivamente ¿vale? es decir, no sólo hay una respuesta o un script correcto, se puede llegar de varias maneras, y tiene todo el sentido del mundo, ¿vale? y se puntuará igual de bien o sea, me refiero, con la misma puntuación Bien, ok, seguimos entonces. Obtener el nombre de los profesores que imparten clases a alumnos que tengan aprobada, es decir, que tengan más de un 5, la asignatura de introducción de la base de datos en junio de 2019. Pues aquí, una vez más, nosotros empezamos con la tabla de exámenes. ¿Vale? ¿Qué más tablas nos hacen falta? Profesores. Profesores, es decir, y en el join, profesores, porque ya sabemos que se puede combinar, ya lo hemos hecho, y de profesor, ¿alguna más? Y asignaturas. Eso es, también hace falta asignatura, ¿por qué? Por introducción a la base de datos. Entonces tenemos asignaturas. y de asignatura que sea igual a, ojo, y de asignatura pero la tabla de examen. Bien, ahora, a nivel de filtro de web. ¿Cuántos tenemos? ¿Cuántos filtros tenemos aquí para aplicar? Tenemos el año de matrícula, ¿no? que es 2019. Después tenemos el nombre de la asignatura, ¿verdad? Que sea introducción a la base de datos. De hecho, no estoy seguro cómo se llama. Aquí lo mismo también es diferente. Ah, no. Esta sí se llama igual. ¿Vale? ¿Hay alguno más? ¿Algún filtro más? ¿el nombre de los profesores? ¿ah no? el nombre va en el select el mes eso es, la convocatoria tenemos que la convocatoria tiene que ser junio bien ¿listo? ¿o me faltaría alguno más? que esto se puede Que tenga... Que tenga aprobado con más de 5. Eso es. Que tenga aprobado con más de 5. Nos faltaría, muy bien, habéis dicho todos, es decir, tiene que ser mayor o igual que 5. ¿Vale? Y ahora sí, realmente lo único que nos quedaría es el nombre y el apellido del profesor. ¿Vale? Fijaros, el mismo profesor aparece 3 veces. ¿Por qué? Aparece 3 veces. Pues puede ser porque haya más de un alumno que haya se haya presentado el examen o que el mismo alumno bueno, así, eso haya más de un alumno que se haya presentado el examen, que haya para la asignatura en junio y haya sacado más de un 5 en el año 2019, una vez más para hacer esto más presentable ¿qué hacemos? especificamos dist ¿vale? y con ello pues quitamos las duplicaciones Bien, seguimos. Esta es la penúltima. vale, para cada asignatura y año académico mostrar, en la query tiene que venir asignatura, año el número de alumnos que se han presentado ¿de acuerdo? y la nota media que se ha obtenido ¿vale? pero solo tenemos en cuenta la convocatoria de junio. Bien. Lo primer. Exámenes, obviamente, es la tabla de la que partimos. ¿Me hace falta alguna tabla más? Asignaturas. Gracias. Nos hace falta asignatura. ¿Vale? Porque tenemos que saber, mostrar el nombre de la asignatura. Entonces tenemos asignaturas, ¿vale? La clave, id asignatura, es igual a id asignatura, ¿vale? Alumnos, ha dicho alguien. ¿Nos hace falta la tabla de alumnos? ¿Sí o no? ¿Qué pensáis? No. no realmente no hace falta nos hace falta el número de alumnos pero eso lo tenemos si lo podemos tener porque la clave ajena de idea alumnos y que está en examen así que en principio con esto nos valdría bien ahora a nivel de web vale el de web cuántos filtros tenemos solo tenemos uno mirad que es que la convocatoria de junio eso es convocatoria igual a junio ahora nos queda el que obtener esto es decir como podemos obtener la nota media y el número de alumnos haciendo uso de las funciones agrupadas exacto, las funciones de agregación recordáis, si quiero saber el número de alumnos ¿qué utilizo? count eso es, ¿por qué no puedo utilizar el sum? si yo por ejemplo hago el sum de idea alumno ¿qué voy a obtener? voy a sumar el 10, 11, 12, 13 y demás, tiene sentido quiero hacer un recuento efectivamente, idea alumno vamos a poner, que no sé, el número de alumnos ¿vale? y después la media ¿vale? la media que es la función es ¿os acordáis? average ¿vale? que es promedio ahora bien, si yo ejecuto esto me funciona ¿vale? porque me hace el número de alumnos y el promedio a nivel general ¿vale? ¿pero qué nos pide? Nos pide que sea para cada asignatura y para cada año académico. ¿De acuerdo? Es decir, tenemos que utilizar, o mejor dicho, agrupar. ¿Verdad? Para agrupar hay dos pasos que seguir. El primero es que tengo que especificar el group by. Y aquí, asignatura, es decir, agrupo por asignatura y por año académico, o el año de matrícula. ¿Qué ocurre? Yo ejecuto esto y funciona. ¿Verdad? Funcionar funciona, pero yo no sé identificar cada uno de estos registros. Entonces, recordad que si especificamos algo en el group by, también hacerlo en el select. ¿vale? para que tengáis pero fijaros, aquí hay una cosa un poco rara, siempre es el mismo número de alumnos, entonces parece que se han presentado todos, ¿no? y el promedio sigue va variando y fijaros, había algo que no nos hemos dado cuenta de un filtro en el web ¿crees que me falta algún filtro? mirad los datos ¿los que realizaron y no el examen? o sea, en junio sí, porque lo está diciendo, que se han presentado el examen, entonces claro esto es algo que aquí no se ha especificado como tal decir, oye realización de examen igual así sino que se ha camuflado en la frase ¿vale? entonces lo ideal, para que sea lo más correcto Os voy a especificar este filtro, porque si no, la calificación es cero. Entonces la media ya no la vas a sesgar. Entonces lo ideal es la realización de examen que sea igual a sí. Ejecuto y ahora como veis, sí que ya cambia la cuestión. Imaginad que en la actividad o en el examen se os pasa. obviamente no os voy a poner que toda la consulta está mal estar en una pequeña parte que corresponda pero que igualmente también nos avisó de que soy bastante flexible el tema de corregir vale menos que sea una burrada pero por la palabra la consulta suele tirar hacia arriba ok Profe Tengo una consulta ¿Me puedes por favor explicar Lo del group buy? O sea ¿Qué pasa si yo no le coloco Eso en el select? ¿En ese caso estaría mal? Porque fíjate ¿No? No lo ponemos en el select Y ahora te digo, vale Pero ¿Esto para qué asignatura Y qué año es? ¿Me lo sabrías decir? ¿no verdad? ¿por qué? porque no tenemos el año ni la asignatura es decir, puede que SQL lo sabe, pero nosotros no, ¿vale? entonces claro si lo especifico ahora sí, base de datos relacionales 2018, se presentaron 4 y esta es la media, ¿vale? etcétera, etcétera, ¿qué ocurre si lo hacemos al revés? no ponemos el group by, que directamente te fallará, ¿vale? Y te diga, oye, SQL se enfadará y te diga, oye, a mí me hace falta aquí el groupby, ¿vale? Te lo estás saltando. Es decir, el groupby solo tenemos que utilizarlo si tenemos funciones de agregación y después atributos que no forman parte de una función de agregación, que son los que después ponemos en el groupby, ¿vale? porque lo mismo si yo no tengo solo especificó más dicho la función es de agregación esto si lo puedo ejecutar porque me hace el cálculo general no me lo agrupa porque ningún campo en el cel se pone el asterisco para que muestre todo nos mostraría puesto pues te diría qué falta en el group by y que ocurre te pedirá que incluyas aquí todos y cada uno de los atributos es decir no tendría sentido ok y de hecho pensar si especificamos un asterisco vale también devolverán todas las calificaciones es decir agruparía por todas las calificaciones entonces el average de calificación será la propia calificación vale porque habrá un registro por cada fila 6 listo dudas preguntas bien pues vamos con la última vale el dni de los alumnos o el nombre vale que hayan sacado más de un 9 de nota media en septiembre de 2019 es decir aquí tenemos Nos hace falta exámenes, ¿vale? ¿Y alguna tabla más? Los alumnos, ¿vale? Bien, la combinación es la misma, id alumno que sea igual a id alumno, ¿vale? Ahora, filtros a nivel de web Tenemos ¿Cuántos filtros hay? Uno, dos, tres Hay tres Uno que sería 2019 El otro que sería septiembre Y el tercero que sería mayor de nueve Vale, vamos por partes Matrícula 2019 Convocatorio Sería septiembre y dice el compañero que la calificación sea mayor que 9. Pero, ¿es esto lo que estoy pidiendo? ¿Es esto lo mismo que esto? No, no, no es, no es. Porque la nota promedio, la nota media. Eso es. Aquí, si lo ponemos en el web, se le va a filtrar la calificación de cada examen. Pero dice que sea mayor que 9, pero el promedio, entonces esto no sería válido, pero lo que sí sería válido es tener en cuenta que se ha presentado el examen, ¿vale? Igualmente, si no se pone, tampoco pasaría nada. Bien, ahora, yo para saber la media, ¿vale? Diría, ¿no? El nombre del alumno y voy a calcular la media, ¿vale? El promedio como tal, para saber primero la media de todos los alumnos, ¿vale? Claro, si yo ejecuto esto, me da un error. ¿Cuál es el error? Que lo hemos visto hace un momento. ¿Qué me falta aquí? El group by. El group by, eso es, eso. Ahora sí. Tenemos el group by. Bien, y ahora tenemos Esteban, Jesús, Perro y Vicente, pues han sacado estos promedios, ¿vale? ¿Qué nos dice? Oye, que la nota media sea superior a 9, que sería que solo Jesús, ¿no? ¿Cómo filtro? Por la función de agregación. ¿De qué manera puedo filtrar? Having. Eso es, tener en cuenta que si nosotros queremos filtrar por una función de agregación que estamos calculando ahora mismo, tenemos que utilizar having. Y ahora sí, decirle que sea superior a 9. Ejecutaría y ahora sí. ¿de acuerdo? esto será también un poco al nivel de la actividad 2 ¿vale? voy a hablar ahora de ella, perdonad que ahora sí que me he colado un poco de tiempo, manzanas que entran por las que salen la semana pasada terminamos antes ¿vale? pero tardo 5 minutos más ¿vale? porque en esencia esto va a ser un poco la actividad que vais a tener que entregar ¿vale? de la cual os vuelvo a recordar que la fecha es el 5 de enero pero obviamente me parece injusto, entonces la fecha de entrega será el 12 de enero, ¿vale? Una semana más tarde. No va a cambiar la plataforma, pero que no pasa nada, ¿vale? Es el día 12 y listo, porque me parece injusto que en Navidad tenga que estar con esto, ¿vale? Ahora, la base de datos, es decir, la actividad, ¿en qué consiste la actividad? es lo que hemos hecho hoy vale yo os pido una serie de consultas vale que vosotros tenéis que resolver si os vais a la carpeta de scripts veis que ya os he subido a la base de datos script actividad 2 consultas sql vale en la de ecommerce tamaño sql sql server entonces en teoría si queréis podéis empezar ya vale son nueve consultas que tenéis que resolver y después proponer vosotros un enunciado y cuatro consultas en dificultad baja media mediante y alta la dificultad va siempre en las actividades de lo más fácil a lo más difícil por lo tanto si queréis ya tener la base de datos podéis empezar y si queréis con la actividad 2 pero vuelve a asistir tenéis un mes vale hasta el día 12 tenéis para entregarla adicionalmente para seguir practicando también os he subido otra actividad opcional vale una tienda de zapatos que tenéis los scripts para crear las tablas y también el enunciado donde están las las consultas vale tenéis que resolver y esta actividad pues de hecho la vemos la semana que viene vale decir la corregiremos la semana que viene de acuerdo dudas preguntas excelente, claro gracias a vosotros, a vosotros como siempre, ¿vale? perfecto, pues nada, perdón por robaros 10 minutos de más, ¿vale? pero lo que digo habrá veces que pase esto que alguna vez terminemos antes y otras terminaré más tarde, pero pero básicamente es eso ¿de acuerdo? pues nada, fantástico, pues que tengáis una muy buena semana ¿vale? y nos vemos la semana que viene pues antes del parando de video, ¿de acuerdo? un saludo a todos, gracias, hasta la próxima semana, chao Gracias profesor Gracias profesor, feliz tarde Gracias profesor, gracias
