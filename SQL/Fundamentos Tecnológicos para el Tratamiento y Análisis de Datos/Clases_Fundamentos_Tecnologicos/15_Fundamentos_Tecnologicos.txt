Bien, buenas tardes a todos. Bienvenidos a la última sesión de Fundamentos Tecnológicos para el Tratamiento de Datos. Y bueno, en la sesión de hoy, que será de una hora, incluso un poquito menos, básicamente vamos a ver dos cosas. Lo primero, uno de vuestros temas favoritos, la base de datos del examen, y después corregiremos la actividad 3, que fue la que entregasteis la semana perdón, en que entregasteis ayer ¿vale? Antes de que se me olvide también recordaros que si vuestra nota de la actividad 2 sigue sin aparecer porque yo he estado revisando foros, había algunos alumnos que no les aparecía, ya tiene que estar resuelto, si aún así alguno sigue sin apareceros, por favor comentadmelo en el foro, ¿vale? para que yo lo he hecho con coordinación, pero yo antes me iré y hoy antes de empezar la otra clase creo que se publicaron los compañeros que lo preguntar. Bien, perfecto. Entonces, la primera parte, que es la base de datos del examen. Si os vais a Scripts, vais a ver aquí reluciente el principio de todo, base de datos examen. Y tenéis la versión de MySQL y de SQL Server. El procedimiento, el mismo que hacemos con la actividad 2, que hemos hecho con las voluntarias como con la entregable. Os lo descargáis en función de la herramienta. ¿vale? y simplemente ejecutáis ¿vale? bueno en este caso ya estaban aquí abrís, ejecutáis y listo ¿vale? estas son las tablas, obviamente en el examen ¿vale? no va a aparecer esta primera parte de tienda-bajo ¿vale? simplemente aparecerán los nombres de las tablas ¿vale? para que lo tengáis en cuenta en MySQL lo mismo ¿vale? en la misma exactamente la misma base de datos igual ¿vale? y básicamente aquí pues creáis las tablas y listo, ¿vale? Después si queréis las elimináis por si acaso y la volvéis a crear si quisierais y listo ¿vale? Pero en principio pues os debería de funcionar ¿vale? Eso sí, si os sale algún tipo de error ¿vale? Pues me lo comentáis, es decir, pueden salir errores pero sí que al fin y al cabo pues venís aquí y hacéis un select from os aparece, ¿vale? Es decir que puede haber errores, pero lo importante es que reviséis que todas las tablas pues os devuelven resultados, ¿vale? Paulina, que en el examen, en el enunciado, no vendrá lo de principio de tienda, es decir, oye, quiero dar la tabla de clientes XXX o la aplicación de la tabla de clientes, ¿vale? Que en el examen, en el enunciado, no vendrá eso delante de tienda y un bajo, ¿vale? Es decir, solo me indican los nombres normales de las tablas. ¿Vale? Esto básicamente lo hago yo para saber, tener yo controlado cuáles son las bases de datos de qué examen. ¿Vale? Por lo tanto, yo que os sugiero hacerlo ya. ¿Vale? Por dos razones. Una, si tenéis algún error, ¿vale? Que os dé tiempo a investigarlo o incluso preguntarme a mí. ¿Vale? Eso por una parte. Y dos, no seáis tontos, ya que tenéis esta base de datos nueva, pues echarle un vistazo, mirad las tablas, mirad cómo se conecta. ¿Vale? Para el examen, pues, bastante más preparado, ¿vale? Después, si alguno utilizáis alguna herramienta que no sea SQL Server o MySQL, que creo que algunos lo hacíais, ¿vale? De hecho, creo que Alejandro creo que lo hacía, el Divi Reader, exacto. Alejandro, yo no sabría migrarte esto ahí, ¿vale? Pero yo que tú lo que haría sería lo siguiente, ¿vale? Vete literalmente a echar GPT, le pegas esto y dice, oye, házmelo como si fuese para Divi Reader. y y divide y vencerás ¿vale? yo que todo lo haría de lo haría de esa manera en MySQL sí que es verdad que a lo mejor pueden dar errores también os lo digo porque puede pasar a algunos por el tema de las fechas ¿vale? si veis que hay un problema quitar los guiones y debería desaparecer ¿ok? por lo tanto no lo dejéis para el último momento ¿vale? por ejemplo entre la semana que viene dedicar 10 minutillos en descargar la base de datos ejecutarla comprobar que todas las tablas tengan datos y listo Pero también no seáis tontos, aprovechad que tenéis una base de datos. Aunque no sepáis qué es lo que voy a pedir, pues por lo menos podéis verla y ir practicando cosas. ¿Vale? Claro. Límea y dificultad de la actividad 2. Así que tened en cuenta que partís con mucha ventaja. Que tenéis todavía 9 días antes de empezar los exámenes. O sea, casi nada. ¿Sí? ¿Bien? vale bien, pues vamos con la segunda parte que básicamente es la actividad 3 vale, la actividad 3 la que habéis enterado ayer básicamente consiste en tres partes, vale en tres códigos que tenéis que hacer una de series temporales, una de clientes y la tercera que es una ampliación de la segunda vale bien, por lo tanto como ya os he dicho simplemente tenemos que hacer en base a lo que nos están diciendo aquí ¿vale? está diciendo aquí, pues obtener el resultado que os pasé en el Excel, ¿vale? por lo tanto la solución, si la habéis hecho bien, os tiene que dar exactamente igual y sabéis que tenéis la actividad bien, sí, dime Décanica, dime que has levantado la mano, sí, sí, justo yo no sé por qué, si a lo mejor yo estoy haciéndolo en MySQL a mí me salió la tabla exactamente igual, en esta por ejemplo en la primera parte solo que en la fecha en vez de decir 31 de mayo decía 30 de mayo y todos los días se me corría en un día yo no sé por qué si volvía a bajar la base me pareció súper raro pero la hicimos con el dataset de una compañera del grupo que ella lo tenía en SQL y ahí sí salió perfecto entonces no sé si había a ver si yo realmente veo que aquí imagínate que tú has entregado, habéis entregado aquí pone 30 de mayo o hay una extracorrelación, pero veo que los dos están bien, en principio no voy a no vamos a quitar puntos ni mucho menos, ¿vale? pero es raro, es raro lo que pasa Sí, sí, me pareció súper raro, es más, incluso luego con el código de ella, dije a lo mejor está algo mal en mi código, porque cada uno lo va haciendo y luego lo compartimos entonces dije a lo mejor algo mal hice en mi código, que por eso me salió algo en la fecha, que no entendía por qué, pero me salía mal, pero luego corrí la lógica de ella, la transformé, como tú dijiste le pedí a ChatGPT que me transforme de SQL a MySQL y ya funcionaba pero no, no funcionó o sea igual me salía 31 de mayo era mi dataset no entendí por qué sí me pareció raro, o sea sale exacto idéntico idéntico menos por la fecha es del 30 me salía 30 y se corrieron un día todos pero de ahí el resto de resultados era idéntico puede ser por la configuración regional o algo así, también es que realmente esas cosas suelen pasar, pero vamos que no te preocupes, porque yo lo que suelo corregir es mirar por encima el código y mirar campo suelto, ¿vale? Porque imagínate que yo veo que realmente empieza porque el cliente me da cuenta ¿sabéis? Tampoco pasa nada. Profe, y de cara al examen, me imagino que también la calificación va a ser en función de eso, en que nosotros pongamos un código de hecho y todo, a pesar de que alguna cosa se nos pase por ahí. Exacto, que no es un 0 o un 10, ¿vale? Es decir, Yo soy flexible, realmente. Yo voy restando, sumando, ¿vale? No es que... O sea, hay muchos grises, como digo yo. Ya. Y va a haber preguntas de tipo como, mira, esta es la respuesta, así como nos pasó en la actividad 3. Mira, esta es la pregunta, pero te tiene que dar esta respuesta. No, no, no, porque el nivel de dificultad del examen va a ser la actividad 2, en la cual yo no daba la respuesta realmente, ¿vale? ¿Por qué? Porque obviamente la actividad, como muy bien dice Olga, esto es para entrar en la NASA. o sea, esto es bastante complejo esto es un poco la vida real tirando ya algo complicado pero tened en cuenta que va a ser como la actividad 2 ¿vale? lo que es simplemente escribir el código, yo no voy a dar un resultado ahí porque realmente son 7 consultas y no son tan complejas como esta ya, ok, gracias ya tenía otro comentario pero es de los otros puntos así que, vale, de los otros háganlo pronto, sin problema, genial y sí, efectivamente, como dice Olga, que me ha gustado mucho el comentario ingreso a la NASA, sí, pero tened en cuenta que esto es perfectamente la vida real así que es verdad que a lo mejor un desarrollo de esto es dos días no uno, pero sí vale para la respuesta le ponemos en cada casillero, ¿verdad? después tenemos acceso a cada escritor no sé qué me está preguntando Estefanía, la verdad es que me he perdido un poco si no recuerdo mal vosotros vais a tener una hoja en blanco o lo que sea, que vais a tener que simplemente consulta uno la respuesta, consulta dos la respuesta no va a haber, creo que como un casillero tampoco estoy seguro, como la universidad nos ha dado un golpe de abajo a todos ¿Por eso ha cambiado la plataforma? Claro, claro, es que la plataforma como ha cambiado yo no sé qué os han dicho porque los exámenes son iguales para todos, es decir, me refiero a la parte operativa de ellos, si no recuerdo mal habéis tenido una sesión en la que os explica un poco lo que tenéis que hacer durante el proceso del examen que aplica a todas las asignaturas yo ahí no tengo conocimiento Sí, sí, es que algunas veces, perdona era por esa duda solo de que en alguna asignatura pues como es necesario cargar el archivo como tal, como por ejemplo en Power BI para que se vea la visualización del dashboard aquí realmente si te ponemos la consulta en el casillero ya estaría, digo, pero no sé si habría la oferta Perfecto, no, no, no, ya está resultado no hace falta, simplemente la consulta Venga, pues estupendo, estupendo Perfecto, María de Cisna dime Hola, profe, una pregunta de la actividad 2 también había una parte que teníamos que crear nosotros consultas según dificultad, eso también nosotros vamos a tener que hacer eso es lo que expliqué, el examen simplemente son 7 consultas, ni más ni menos me resolví las 7 consultas y listo perfecto, gracias eh profe, podría ser que en la segunda parte no podría ser que hubieras olvidado incluir no es olvidar, Olga, lo hice a drede ahora vamos con ello Está hecho a día de hoy así, ¿vale? Para que pensase. Ah, vale, Jorge dice, ¿no? Que vais a tener esa sesión informativa del examen esta semana, ¿no? El viernes. Pues ahí os explicarán, ¿vale? Sí, dime, dice, dime. Sí, bueno, digamos que ya sé que hice siete consultas, pero solo por confirmar ¿No va a salir alguna pregunta que diga, no sé, qué significa el Group By o qué significa el Select? No, es más como hacer las siete consultas y no y ya Y ya está, por eso os digo, el examen, que sean dos horas si sabéis SQL, aunque sea, habéis practicado algo, al principio vais a hacer el examen rápido. Y además tener en cuenta que ya tenéis la base de datos. O sea, sois unos subertudos porque hace dos años... O sea, podemos hacer la actividad parecida con la talla. Claro, claro. Es que esto está feo que yo lo diga, ¿no? Porque si yo estuviese en esta situación, imagina que me dan la base de datos y digo, yo la base de datos la voy a mirar por todos lados para después llegar al examen y hacerlo bien porque ya tengo la estructura y el contexto, está feo si es que yo lo sé que está feo pero claro, no puedo hacer nada, es lo que nos pide la universidad ahora, para que no tengáis problemas con ello ¿adrede el qué? lo del customer, lo de la tabla de customer es adrede pero 100%, vamos, os lo digo lo hice a posta, de hecho lo quité y es que quería que pensaseis al fin y al cabo, y eso en cuanto al examen, no seáis tontos, vale parece feco lo diga yo, pero echarle un vistazo a las tablas, mirad que es lo que contiene, practicad los joints practicad, pensad si, os echáis de gp y decís, mira, toma la base de datos hazme, no sé, pregúntame cosas yo que vosotros te quedaría un poco por ahí, de cara a practicar ¿vale? no, en el examen no, en el examen no soy tan malo, ¿vale? en el examen sí que a ver, tenéis la base de datos y os voy a preguntar las cosas normales, ¿vale? eso sí que es verdad, que a lo mejor el día de mañana pues cambia un poco las cosas, porque si hay dos semanas para la base de datos, subiría el nivel pero bueno, vosotros os salváis en este caso, ¿vale? tenéis todas las ventajas del mundo exacto innerjoin a menos que yo os deje bastante claramente que sea lo contrario bueno, esa es otra, ahora le estoy diciendo a Alejandro odio los select estrella, ¿vale? si yo os pido tres campos, no me pongáis el select estrella, que quito puntos ¿vale? igual lo que también os dije no abuséis del like, ¿vale? si no os pido que sea, que contenga algo me ponéis un like, me enfada mucho os lo dije ya unas pocas veces, lo detesto me enfada muchísimo tened eso en cuenta y que no se os olvide los groupbyes o al revés, que pongáis los groupbyes y no pongáis cosas en serio ¿vale? difícilmente difícilmente estoy yo relajado en mi día a día de vacaciones, como para que estéis en la época de exámenes pero que no os asustéis, ya lo he visto con las actividades yo apunto muy bien, es verdad que no tengo influencia sobre los otros compañeros pero creo que yo realmente soy benevolente, no suelo ser malo, realmente eso sí, también lo que os dije en el examen una persona que no ha practicado SQL yo lo voy a ver rápido, lo voy a ver rapidísimo que también los hay, o sea, no lo digo por nadie en particular, pero que hay casos en los que se aprovechan de los compañeros para hacer las actividades, llega el examen y y listo pues mirad no me parece mal Jorge no me parece mal vale bien por lo tanto lo que os decía aprovechad aprovechad mucho el el tema que tiene la base de datos vale jugad con ella haced vuestra propia consulta pedid incluso el chat GPT que os pregunte cosas vale y así vais practicando bien de vuelta a la actividad 3 vale la primera parte vale tenemos que preparar un dataset de series temporales básicamente por cada día las ventas generales y las ventas por región vale que aquí por ejemplo con región que os digo no que región realmente el campo no se llama región aquí también como dice olga juego con nuestras mentes vale porque es otro campo que acá lo veremos pero en esencia es bastante sencillo esta primera parte porque porque es un poco copiar y pegar lo que hayamos hecho ¿Vale? Es decir, nosotros sabemos que las tablas principales, que aquí no hay ninguna trampa ni mucho menos, son Sales Order Header y Sales Order Detail. ¿Vale? Combinación que ya hemos hecho infinitas veces. Sales Order A y B que sea igual a Sales Order A. ¿Vale? bien, aparte lo que nos piden es que filtremos entre 2011 y 2014, pero realmente si nos fijamos los datos son entre 2011 y 2014 es decir, especificar el web de fecha es opcional vale, si no lo habéis puesto tampoco pasa nada, bien, ahora si nosotros nos fijamos tenemos que crear esta serie temporal vale, es decir, tenemos que hacer el sumatorio de las ventas ordenado por fecha Por lo tanto, tenemos el order date y aquí tenemos el sumatorio. ¿Qué ocurre? Hay varios campos. Está el total due, está el subtotal, hay varios. Y obviamente está el line total. Así que, ojo, realmente si nosotros tenemos el header y el detail, nosotros no podemos utilizar el header. ¿Por qué? Porque pasará lo siguiente. pongo el group by y lo vemos ¿vale? al combinar con detalles si nosotros hacemos el sumatorio el subtotal de header se nos duplican las cosas ¿vale? tiene que ser de detalles del detail y de hecho si veis si ejecutamos esto ¿vale? lo cual vamos a llamar sales ¿vale? Como veis, en principio, casa con lo que nosotros tenemos aquí. Es decir, cuadrar, cuadro. ¿Vale? Ya tenemos la primera parte. ¿Qué ocurre? Que ahora tenemos que crear otras tres para regiones. Dime, Alejandro. Perdón, te voy a levantar. No, yo es que no entendí muy bien esto porque dices que se repite. Si utilizamos el subtotal, dices que se repite. Claro. pero o sea yo en un día puedo tener cinco pedidos entonces pero fíjate lo voy a lo voy a hacer sin el groupby ¿vale? una cosa es que nosotros tengamos el pedido otra cosa es el detalle del pedido es decir nosotros tenemos aquí que se yo el sales vale y el el subtotal por ejemplo y el line total si yo combino header con detail pasa lo siguiente. El subtotal es el sumatorio de toda la factura. Porque si combinamos el detalle, todo esto se desgrana por productos y por líneas. Entonces, este sumatorio es 20.565. Es decir, si sumo esto, está bien. Pero si sumo todo esto, estaría mal. Correcto. Eso es lo que me refería, básicamente. Pero el ejercicio te pide que lo hagas por fecha y por tanto no te hace falta meter el 6 sobre el ID, entonces ya no tienes que hacer eso. Sí, esa es otra cuestión. Alejandro aquí ha sido lindo. Yo me volví loco con esto porque no entendía por qué pedías el... El detail. Yo no lo entendía, o sea, yo decía pues vale, pues si lo quieres lo pongo, pero no... Claro, claro, pero efectivamente, esto es lo que antes ha dicho Olga, es comer con la cabeza. Es decir, esto pasa en las otras consultas también, no todas las tablas hacen falta o faltan tablas. perdón es decir que si tú puedes hacer esto sin el order header es decir si tú haces esto sin el detail esto estaría bien sabes lo que te digo bueno perdón eso es claro esto estaría bien pero estaría bien siempre y cuando no combines detail ¿vale? pero como yo aquí pido que combinéis header y detail lo que buscaba es esa trampa que os dieseis cuenta que si combináis no podéis utilizar el subtotal, tenéis que utilizar el line total vale a mí me suena que daba igual pero igual es un sueño porque no me acuerdo es que realmente, si tú miras esto ¿vale? lo voy a hacer de manera ascendente ¿vale? si tú miras esto, mira los tres primeros resultados son exactamente lo mismo que si tú sumas el line total, que es lo que tiene que ser realmente, porque el subtotal realmente por detrás lo que hace es el line total por la cantidad de producto por el descuento ¿vale? entonces si tú has hecho así, está bien también de hecho esto sería como decir, vale, realmente me hace falta pues lo quito, es como si fuera la vida real porque el otro no hace falta, lo que te lo has pedido porque querías, por marear efectivamente, vale, vale, ok, vale y de hecho eso ocurre Aquí y sobre todo ocurre aquí también, en la tercera, que ahora lo veremos. ¿Vale? Pero, por eso también es la razón por la que os decía. Comprobad, porque hay muchas formas de llegar al mismo resultado. Muchas. ¿Vale? Dime, Verónica. Ah, vale, que habías abierto el micro. Vale, bien. Teniendo esto, ¿vale? Con detail, es decir, ya tenemos las ventas. ¿Vale? Tenemos esto de aquí. Ahora nos hace falta, pues, la región. ¿Qué ocurre? región como tal la tabla como os dais cuenta aquí no menciono si no recuerdo mal no os digo que tabla es pero obviamente nosotros ya hemos practicado y la tabla cual es la tabla de sales territory algo que yo presuntamente había puesto cosa que no he hecho precisamente por eso, para que penséis un poco, porque al fin y al cabo todos trabajáis. Normalmente cuando nos piden algo, siempre hay información que se escapa o información que no defiende del todo y muchas veces tenemos que investigar o preguntar. Entonces, claro, aquí en territorio tampoco hay una región, pero lo que más se parece a USA, a Europa y Pacífico es este campo de aquí. Entonces, ¿qué tengo que hacer? Pues tengo que hacer subconsultas de Europa, usa y pacifico ¿vale? ¿y qué hago? yo voy a reutilizar lo que ya he hecho ¿vale? para usa ¿qué es lo que hago? reutilizo la consulta con la única diferencia de combinar 6 territory ¿vale? donde el territory id sea igual al territory id de head ¿vale? y incluyo aquí en el que el group ¿vale? que recordemos al ser una palabra reservada tiene que ir entre estos corchetes, en este caso sea North America ¿vale? y aquí pues pondríamos sales usa ahora ¿qué hacemos para los demás? igual copiar y pegar porque solo hay que cambiar dos cosas euro EU y Pacific P ¿Vale? Ya está. En un momento tenemos las cuatro consultas. ¿Qué ocurre? Tenemos que presentarlo todo junto. Y aquí, pues, donde viene una de las dificultades del del ejercicio. Hay varias maneras de hacerlo. Podemos hacer con subconsulta, lo podemos hacer con CTE, que sería lo correcto. Bueno, lo correcto, las buenas prácticas, o incluso lo podemos hacer con Vista. Cualquiera de ellas es válida, siempre y cuando el final me dé el mismo resultado. Una pregunta que decía Alejandro. ¿Hay veces que algo se puede hacer con CTEs o con subconsultas del web? En el examen da igual cómo resolvamos, da igual. Igualmente os digo, en el examen no creo que haga falta subconsultas, a menos que os lo pida específicamente, pero no suele ser el caso, y mucho menos CPEs. ¿Vale? Si no lo hiciste, por eso digo, hola, efectivamente, es decir, yo lo que voy a mirar es el código, pero también voy a mirar el resultado. Si el resultado os da exactamente igual lo que hay en el Excel, lo doy por bueno, automáticamente. ¿Vale? Bien, pues como os decía, parto de mi consulta principal y aquí combino las otras tres subconsultas. ojo, aquí sí que es obligatorio el qué el left join ¿por qué? de hecho si vosotros seguramente os hayáis dado cuenta ¿no? si en vez del left join utilizáis inner join hay ventas pero no todos los días en ciertas regiones ¿vale? entonces hay que utilizar left hombre medio punto no, pero imagínate si la consulta bueno sí de las consultas fáciles, ¿vale? imagínate, ¿vale? Alejandro, que os pido dos condiciones ¿vale? una de ellas tiene que ser igual y no in, y imagínate que os pido algo complejo, yo que sé una función de agregación ¿vale? entonces ahí hay tres dificultades ese uno lo divide en tres partes ¿vale? imagínate que todo está bien pero en vez del igual me has puesto el in, no te voy a quitar un 0,3, pero un 0,2 sí que te lo quitaré eso en la consulta de un punto ¿vale? para que así más o menos hagáis una idea ¿vale? el i no me enfada tanto el que más me enfada es el like, el like sí que quito un 0,33 pero vamos es que ni me lo pienso ni me lo pienso nada, no pasa nada, no te preocupes ¿vale? bien bueno, no es que sea prohibido ¿Vale? Y si yo digo que contenga algo Pues ahí se tiene que ponerme like, ¿vale? Pero tiene que ser algo que específicamente os diga like Como pongáis like tal cual Quito. A ver, el or Si me lo hacéis bien, lo voy a puntuar bien Pero como me pongáis el or sin los paréntesis Y después un and Capaz de quitaros todo el punto, ¿eh? También os digo, ¿eh? Hombre, depende de lo que devuelva Bien Como os decía Venimos por aquí, left join Y no inner join Porque, de hecho, si os fijáis ahí va lo que es nulos, es decir, días en los que no hay venta en ciertas regiones, ¿vale? Por lo tanto, obligatoriamente tienen que ser leves. Y las claves para combinarlo a su consulta serían el qué. Al fin y al cabo serían las fechas, ¿no? Por lo tanto, vemos por aquí, update, update, update, y sales usa, al final lo traemos aquí, ¿vale? ¿Hace falta especificar un sumatorio para que sales usa? no, porque realmente aquí ya tengo el valor y al ser esto una subconsulta pues simplemente lo puedo poner aquí ¿vale? pero ojo, aquí hay un somatorio entonces lo ideal sería bueno, lo ideal no, lo obligatorio es meterlo en el goodbye y ahora, ¿qué es lo que hago? pues exactamente lo mismo para Europa ¿vale? y lo mismo para pacífico pacific pac aquí se me ha olvidado el ahí vale, y lo incluyo también aquí vale, y obviamente pues estos tres, como ya decíamos tenemos que incluirlo en el group by vale, y si yo ahora vengo aquí y ejecuto todo esto pues listo 1.124 filas y si vamos a alguna fila particular 4 si, es que es más fácil además Alejandro, tú eres el que no o sea, tú eres el que decía no le veo esto a los CTEs pero aquí es mucho más fácil hacerlo con CTEs que hacerlo con subconsultas, se ve más claro porque lo tienes todo más ordenadito lo haces todo poco a poco y al final lo combinas todo ah, tú decías que sí, bueno, a ver, no pasa nada es que no sé, yo creo que alguien que sí que me preguntó pero que al fin y al cabo, por eso los CTEs ¿vale? es grabar en los fuegos, eso es algo fundamental, vais haciendo poquito a poco todo y después los combináis yo lo he hecho aquí con subconsultas sí, pero bueno, que podría haberlo hecho con CTE así que es verdad que casi siempre lo hago de esta forma, ¿vale? pero igual con CTE se puede hacer incluso con vistas podría haber hecho cuatro vistas por separado y después unirlas al final ¿vale? lo que os decía, fundamental, ¿vale? el tema de la CTE en la vida real CTE vistas, grabar los juegos que es fundamental ¿Por qué se han quejado los de IT? ¿Porque utilice CTEs? No creo, ¿no? Porque se puede complicar mucho entonces como que pides que se vaga para producción pero tu código es como hay una locura Sí, hay que hablar Pero también porque a lo mejor bueno, también porque hay muchas tablas que a lo mejor están mal como que hay como que intenta hacer algo que faltan tablas y entonces lo hago de maneras muy rebuscadas y en realidad la solución está en cargar unas tablas pero que a lo que voy es que los CT es muy fácil la poquísima, brevísima experiencia que tengo que es a partir de las clases que hemos tenido al tratar de implementarlo en el trabajo con casos de forma de testar como casos específicos pues traté de hacer, en vez de pedir algo pues lo traté de hacer yo pero pues que era en mi caso bueno, se me fue la olla ese día y creo que dejé algo nada más en el foro porque estaba un poco problemado pero que se puede hacer muy largo, o sea, se puede, joder puedes meter ahí, empiezas a meter CTEs con cosas complejas y al final dices, va, esto lo saco y lo hago en Excel, o lo hago en Python, o lo hago en R y es más óptimo, o sea, hay un punto donde dices, no, esto es más óptimo calcularlo por fuera porque de repente tienes un código ahí y de repente pues hay una columna Sí, es muy largo o incluso tienes que normalizar cosas porque no estaban bien desde ingeniería tipo, pues es que en una tabla el ID uno era número y en otro era texto, entonces le tienes que empezar a meter un montón de cosas para normalizar todo y todo va en un CTE y al final tienes ahí un espagueti que funciona, pero no sabes si lo quieres desbloquear, dices no sabes por dónde empezar Sí, o sea, al cabo también es que depende, ¿no? por lo que se use, como tú dices, y después hay que normalizar y hay que limpiar bastante cosas SQL para limpiar, que se pueda hacer algo pero a lo mejor Python realmente sirve bastante más yo, por ejemplo, te digo, o sea, yo tengo código, alguno de Sí, me refería a limpiar no de limpiar datos sino de limpiar tu propia query eso es, de limpiarla de ordenarla, de entender qué está haciendo que se puede como súper es así, ¿no? o sea, me estás verificando que esto ocurre no, no, sí, sí, totalmente pero también es que depende muchas veces el tema de utilizar SQL utilizar Python, depende de de cómo están cargados los datos como tú dices, es decir, nosotros normalmente yo siempre que he trabajado a mí no me llega la tabla que han hecho por ejemplo el landing desde Salesforce, que es la tabla básica tal cual, sin limpiar, sin ajustar bien cómo son los campos, etc. A mí me llega una parte ya procesada porque es ingeniería. O sea, técnicamente eso está medianamente bien. Entonces, claro, yo ya cojo las partes limpias, le hago mi CTE, para hacer a lo mejor mi tabla de hechos más compleja. De hecho, te digo, o sea, yo tengo ciertos códigos que puede haber 20, 25, 30 CTEs. O sea, y al cabo que más todo es escalado hasta que lo devuelvo. ¿Qué es la parte positiva? Cuando yo, o sea, donde más uso le doy al CT es cuando tienes muchísimas tablas o muchísima información de tablas que incluso poco tienen que ver y tú poquito a poco tienes que ir ajustando y como si fuese un Tetris hacia el cabo, ir preparando todo y hacerlo por los pasos más que nada porque si después falla algo, no cuadra un número, puedes ir poco a poco por cada CT viendo dónde se comete el error, yo creo que por eso mismo es la manera que es lo que suelo trabajar con ellos, pero claro, en tu caso es un poco diferente porque al fin y al cabo tú si pillan las tablas y esas tablas pues no están normalizadas ni están bien hechas, entonces claro a ver, lo mismo el CTE, si tú ya con 3 y las tablas están regulares o no están bien definidas y no tienen incluso índices y demás, claro eso impacta, el CTE o sea, yo lo que os digo es la manera que escribe el código pero ya con tablas que estén un poco procesadas por ingeniería, es decir, que no sea lo primero que te carguen de Dynamics o SAP o lo que sea y tú lo utilices tal cual, ¿sabes? porque al fin y al cabo eso puede ser normal que los de ITD se quejen porque si no está procesada y tarda mucho incluso en hacer un select from, claro, eso, y le salta los alarmas de que el servidor lo está pillando alguien con una query vamos, te digo, que a mí también me han echado bronca por por consumir demasiado recursos, pero es normal, o sea, al fin y al cabo yo lo que te diría, a la próxima vez a lo mejor hacerlo en texto o algo, no te voy a hacer en producción pero bueno, realmente eso en cada empresa va variando un poco bien, perfecto, pues nada eso sería la consulta 1, lo que os decía no tiene que ser exactamente igual que esta, ni mucho menos hay varias maneras de hacerlo y hay varias formas de llegar al mismo punto, ¿vale? de ahí por ejemplo que yo os daba también la solución, primero porque es complicado y segundo, cada uno lo puede un poco mentalizar a su manera y hacerlo por los pasos que llega, pero que siempre y cuando que yo la manera de corregir, me digo vuestro código veo que todo esto más o menos bien, aunque no sea el mismo que el mío, ni mucho menos, lo ejecuto y veo si, por ejemplo, el número de filas es el mismo y mi compadre de filas, y si están bien, pues para adelante. ¿Vale? O sea, me refiero que lo doy por bueno. ¿Vale? Bien. Segundo punto. El dataset de clientes. ¿Vale? Aquí básicamente tenemos que obtener un dataset donde tenemos, pues, todos los clientes con su gasto, todo lo que han gastado, ¿vale? Y ciertos campos, pues, de ciertas tablas, entre las que están order header person, territory y person demographic, ¿vale? y efectivamente, como muchos habéis dicho, aquí yo ¿cómo es el concepto que decía Olga? que se me ha olvidado ya lo voy a buscar en el chat, que era el lo de la cabeza, lo que decía ¿qué es lo que era? ah, de jugar con la mente, ¿no? Jugar con la mentera. Pues aquí obviamente he jugado con esta mente y dije, cuando puse la tabla de Customer, digo, no, yo la voy a quitar. Y que piense. Y efectivamente aquí, para conectar Header y Person, nos hace falta la tabla de Customer, porque si no, no podemos. ¿Vale? Así que sí, pero los que habéis dado cuenta, pues oye, a la primera, pues muy bien. Bien, por lo tanto, empezamos con Sales Order Header. ¿Vale? seguimos con efectivamente con customer ¿vale? donde el customer id tiene que ser el igual a customer id, ahora combinamos person ¿vale? y person tiene que ser el business entity que sea igual a que al Person ID ¿Vale? Después tenemos TTT6 Territory Tabla que ya hemos visto Muchísimas veces Donde El Territory ID Es igual al Territory ID Y finalmente está Person Demographics recordad que yo os lo dije, ¿no? que cometí un pequeño error ¿vale? en el nombre de la tabla InMaiSQL es un pelín diferente, ¿vale? porque eso fue por tonto, vamos, literalmente me equivoqué en el nombre ¿vale? y aquí pues tenemos que el Business Entity ID sea igual, que aquí daría igual si combinamos con ojo con el Intel Person ID ¿Vale? O directamente Podemos hacerlo con el Business Entity ID ¿Vale? ¿Por qué daría igual? Pues precisamente por esto Porque hay que lo combinamos directamente Ah, vale Que es C, no Customer Ya decía yo El alias Vale Entonces yo aquí Yo ya tengo Toda la fuente principal De los datos Pero ¿Qué ocurre? Nos dicen claramente En cuanto al web Ojo Tiene que ser person type igual a IN Para que solo nos quedemos con clientes Que son individuos ¿Vale? Entonces nosotros venimos al web Y decimos, oye, person type igual a IN ¿Vale? Y como veis Hay un total de 27.000 27.659 27.659 yo aquí no tenía tanto no tenía mil 484 que lo que 18.000 no pero a ver bueno claro claro claro claro sí sí porque no estoy ocupando aquí todavía verdad verdad correcto vale y ahora ya lo único que tenemos que hacer es yo ahora me comió la cabeza yo mismo para que que veáis lo que tenemos que hacer es mostrar esta información el total a mal que es todo lo gastado por un cliente para ello que es lo que tenemos tenemos el sub total vale pero que vamos a hacer no queremos los pedidos vale queremos todos los pedidos que han hecho nunca decir sumatorios del subtotal vale que sería el total a mano después tenemos el customer a y después de territorio tenemos el name, al cual le vamos a llamar simplemente country, country region code, el group, el person id, el person type, para estar seguros de que realmente son individuos, y ahora pues todos los campos de Person Demograph, que sería Marital ¿Cómo lo he llamado esto? VPD, sí, esto está bien ¿Por qué se me queja ahí la IntelliSense cuando lo quiero? No, me lo hace bien Vale, tenemos el Marital Status los ingresos el género el número de niños ay no, pero esperad, esperad, es que me he equivocado aquí faltan muchos más, que lo tengo a la izquierda también y me estoy liando vpd la fecha de primera compra el birthdate la edad, vale, que la edad lo que decía, hay varias maneras de hacerlo vale, pero realmente para sql server podéis utilizar daydiv o timestampdiv para MySQL ¿vale? quería que investigase estas funciones básicamente calcula la diferencia de intervalo ¿vale? y hay tres atributos aquí el intervalo que yo quiero calcular, en este caso años, la primera fecha, que sería el birthdate y la fecha actual, que por ejemplo podemos hacerlo con la función getDate ¿vale? por eso la edad nunca cuadra cada año porque no lo ejecuto cada año el Excel, ¿vale? porque eso la edad varía, ¿vale? Tenemos el age, ahora sí, marital status, total children, la educación, ocupación, el homeowner flag, que te dice cómo hacer o si tienes casa o no, y el número de coches que tienes, ¿vale? El cliente. Bien, si yo ejecuto esto, pues obviamente, ¿qué ocurre? Pues me falla. ¿Por qué? Porque efectivamente yo lo que tengo que hacer es agrupar. ¿Por qué? Porque tengo, estoy sumando el total. ¿Vale? Entonces tengo que establecer aquí el groupBy. ¿Vale? Quito este alias. El backday ya lo tenemos aquí, por lo tanto, esto lo podemos quitar y listo. ¿Vale? Y de hecho si ahora, por ejemplo, comparamos alguno, por ejemplo, este de aquí, el valor cuadra, cuadra, cuadra, cuadra, como decía, lo único que no cuadra es la edad. ¿Vale? Pero un poquito de lo demás estaría listo. es verdad que esta en términos de consulta es un poquito más fácil ¿vale? pero sí que está de aquí la el tema de custom, que lo vié ¿vale? dudas preguntas ¿bien? claro ¿no? ¿sí? vale, bien, y ahora la parte 3 que la parte 3 es una ampliación de la parte 2, ¿vale? sí por ejemplo, lo que ha dicho María efectivamente, para no repetir yo podría decir, vale, como la voy a reusar, esto lo guardo en una vista y después, pues la parte 3 la aprovecho, sí, muy bien pensado yo la verdad que no lo he hecho, ¿vale? en la solución lo pongo tal cual pero bueno, en esta tercera parte Como decía, es la parte 2, como dice la compañera, solo que nosotros añadimos un campo de más. La diferencia es mínima, solo es este campo de aquí. Y básicamente consiste en identificar clientes que han comprado bicicleta o no. Es decir, clientes que han comprado una o al menos una bicicleta y los que no han comprado nunca. ¿vale? para ello yo aquí os doy la pista de decir ¿vale? en la tabla de product subcategories serían pues donde realmente encontramos esa esa segmentación ¿vale? y realmente lo que nos hace falta es las subcategorías 1, 2 y 3 ¿vale? hace falta 6 software header detail, customer product y subcategoría, pero ¿qué ocurre? aquí al igual que pasaba en las otras consultas, ¿me hacen falta todas las tablas? Nope. Sales Order Header, sí. ¿Por qué? Porque aquí es donde yo tengo mi Customer ID. Porque básicamente, yo en esta tercera parte, lo primero que tengo que hacer es identificar clientes que han comprado una o más bicicletas. ¿Vale? Para ello, tengo el Header, para que tenga el Customer ID. InnerJoin. Sales Order Detail. ¿Por qué? Porque aquí es donde vienen los detalles. Es decir, los productos, ergo las bicicletas que estamos buscando. Sensor de ID y Sensor de ID. Ahora, me dice que hay que combinar Customer. ¿Nos hace falta Customer para algo aquí? Aunque yo diga que sí. ¿Hace falta Customer? ¿Hay algún campo de la tabla de Customer que nos sea necesario? Customer es opcional porque nosotros queremos el Customer ID, pero ya viene en el header. Ergo, Customer, podemos obviarlo. ¿Vale? Bien, lo siguiente sería Product. Production Product, que en este caso sería el Product ID, que sea igual al Product ID. ¿Vale? Y ahora nos dice el subcategorio. ¿Vale? ¿Pero me hace falta el subcategorio? ¿Me hace falta esta tabla en esencia? No. ¿Por qué? ¿Por qué no hace falta? Porque en producto tenemos la clave de subcategoría. Y podemos decir, oye, para no combinar, que así ahorramos recursos, decimos, vale, de producto la subcategoría 1, 2 y 3 ¿vale? y listo, ¿qué ocurre? aparecen 40.000, 31 registros pero ¿qué está pasando aquí? porque hay tantos clientes, si realmente hay 18.000 clientes ¿cómo es posible que haya datos? fácil, porque aquí la parte principal son las facturas, es decir aquí ponemos cliente, un cliente puede tener varias facturas, es decir, yo lo que Llegos a tener valores únicos del cliente. Especifico un distinct y efectivamente hay un total de 9.719. Esos son los clientes que han adquirido al menos una bicicleta. Y ahora ya por último, ¿qué tengo que hacer? Mi consulta 2. La vuelvo a copiar y pegar. y incluyo mi subconsulta. ¿Qué ocurre? ¿Puedo utilizar un inner join aquí? No, porque si yo hago un inner join, ¿qué va a pasar? Si yo hago un inner join, simplemente me mostrará los datos de los clientes que han comprado una bicicleta, pero los que no van a desaparecer. ¿Vale? Por lo tanto tiene que ser left. ¿Vale? Y especifico que el customer ID sea igual al customer ID. ¿Vale? Vuelvo a insistir. Esta parte de aquí se puede hacer de muchísimas formas diferentes. ¿Vale? Yo por ejemplo he optado por esta. Y ahora yo me vengo aquí y le digo oye, de bicicleta de acá, llame el customer ID. ¿vale? y efectivamente también lo tengo que incluir aquí en el rootby bien si yo ejecuto esto ¿vale? 8484 y fijaros hay ciertos customers, ahí vi este nuevo como has añadido que es valor nulo y otro que tiene valor, es decir, el que tiene valor, el que tiene aquí un número, que quiere decir que ha comprado una o más bicicletas y el que es nulo, no ¿y qué nos pide el enunciado? una función condicional, la que queráis tenemos que indicar 1, 0 por ejemplo, vamos a utilizar if, si este custom ID no es nulo, por ejemplo este caso, le asignamos 1, porque efectivamente en algún momento ha comprado una bicicleta, y si no cero, ¿vale? Y termino especificando el campo bike pushes ¿Vale? Y si ahora ejecuto Sí, dime ¿Es doble if o es solamente if? Es doble if ¿Vale? Esto realmente va cambiando de cada gestor de base de datos. Hay algunos que son iff que depende, depende de la herramienta ¿vale? el SQL Server es IEF, en MySQL en MySQL no sé, no me acuerdo pero creo que sí también ¿vale? y efectivamente como veis ya asigno 0 y 1 ¿vale? que algunos compran bicicletas y los que no ¿sí? ¿dudas? ¿preguntas? ¿bien? ¿sí? vale, perfecto pues nada aquí terminamos ¿vale? para que os deis cuenta que habéis dicho que la actividad 3 es bastante complicada pero pensad el primer día en el que os enseñé las claves hasta ahora hemos avanzado bastante dime Lice, dime una duda propia esto es más o menos baleándolos por niveles SQL básico o intermedio? Esto es intermedio, creo. O sea, con las CTEs y con las vistas sería intermedio. Sí, sí, sí. Ok. ¿Y hacia el otro cuatrimestre vamos a tener alguna materia más de SQL avanzado o hasta aquí llegamos? No, no, hasta aquí llegamos. En el segundo cuatrimestre no tenéis nada más. Ok, ok. Gracias. Sí, sin problema. Andrea, la base de datos la cargamos igual que hemos hecho con la actividad 2 es decir, abres el script y lo ejecutas y listo o sea, lo hemos visto ya muchísimas veces hombre, lo he hecho rápido porque esta query, primero, la hice yo en su día cuando me planteé que ahí tardé más pero claro, esto todos los años de una manera u otra lo veo es normal que perdemos porque esto ya lo vomito, por así decirlo es un poco lo mismo y que al fin y al cabo con la experiencia después vosotros lo vayáis a hacer igual, no tengo duda ninguna yo este show tiene dos secuelas indirectas que sería taller de tele, que serán cuatro horas básicamente seguiremos con SQL básicamente y lo que haremos es pasar de OLTP a almacén de datos el segundo cuatrimestre seguramente para que penséis más o menos será mayo o junio no me acuerdo exactamente y otro de DAX que también será mayo o junio primero irá uno después el otro normalmente las clases serán los jueves ¿vale? os avisarán con tiempo no os preocupéis ¿vale? ¿y es contigo profe? sí, sí los dos talleres los imparto yo ¿vale? así que ahí podéis aprovechar también para preguntarme sobre todo de DAX ¿vale? porque es verdad que yo de cada día no os he dado nada pues por ahí pues podemos ver eh como Andrea pero es que es que yo lo he hecho a drede que la base de datos se te quede en la base de datos de AdWords es decir para que no tengas que crear otro es normal que esté ahí alojada es normal vamos a poder usar algún script de algún taller ¿en qué sentido, David? porque utilizar el script no o sea, el script no lo vais a poder aplicar directamente pero hay que adaptarlo a vuestra base de datos sí, el striker total, el Darth Vader de quemar computadores, totalmente es verdad, lo vi en el foro de que al fin y al cabo no te dejaba es que el problema, date cuenta Alejandro que para MySQL creo que apenas hay script.dunkerboard ¿qué ocurre? este script que yo subo para MySQL lo migré yo y me llevó bastante tiempo y aún así tiene fallos en el examen no podemos tener guía ni script ni nada David, le hablamos si abrís algo indebido, suspenso automático ¿vale? por favor, revisad los que no sepáis no tengáis muy claro el examen volved a revisar la sesión, porfa muy importante, ¿vale? porque es que si no, os digo, como habráis algo indebido, es un penso automático vais a extraordinaria, y os vuelvo a decir la base de datos del examen es la misma extraordinaria que extraordinaria ¿vale? Ah, que al final lo pudiste hacer, ¿no Alejandro? Ah, entonces perfecto bien, pues con todo el dolor de mi corazón pues terminamos aquí la asignatura ¿vale? espero que os haya ayudado, de verdad que espero que os haya resultado útil la asignatura, porque al fin y al cabo ya todos trabajáis, porque por lo menos el contacto con SQL pues muchas veces ya sabréis de dónde viene eso Excel que os mandan ¿vale? y nada, nos vemos en los talleres ¿vale? a lo mejor en el segundo cuatrimestre coincido con alguno con el trabajo de fin de máster que no lo sé ¿vale? pero que igualmente ha sido un placer, ha sido uno de los grupos más participativos que he tenido nunca lo cual os agradezco mucho porque las clases en las que voy hablando solo yo me parecen aburridísimas y nada, os deseo todo lo mejor ¿vale? que consigáis todo lo que os pongáis en la vida y espero que ese cuelero lo terminéis a la perfección ¿vale? y nada, cuidado muchísimo ¿vale? y nada, un abrazo fuerte a todos y nos vemos en los talleres ¿vale? bueno, y mucha suerte en el examen pero insisto no creo que os haga falta cuida con mucho todo vale un placer gracias
