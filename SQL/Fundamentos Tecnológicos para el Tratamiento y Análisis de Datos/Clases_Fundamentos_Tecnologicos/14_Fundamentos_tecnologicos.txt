Bien, buenas tardes a todos. Bienvenidos a la penúltima sesión de Fundamentos Tecnológicos para el Tratamiento de Datos. Y bueno, la sesión de hoy, que va a ser de hora y media, básicamente la semana pasada, si no recuerdo mal, se nos quedó el tema de hacer la conexión de SQL Server con Power BI R Python. Por lo tanto, vamos a hacerlo. Igualmente lo tenéis aquí en el tema 4, ¿vale? Porque esto realmente sería como una especie de... realmente demostrar un poco lo que sería la realidad, ¿no? Porque obviamente no se suele trabajar con Excel ni similar, ¿no? Sino que se suele conectar a base de datos que están en producción, ¿vale? Por lo tanto, vamos a abordar rápidamente esa cuestión y después lo que vamos a hacer es, a modo repaso, vamos a seguir con el tema de AdventureWorks con SQL, pero esta vez lo que vamos a hacer es consultar recursos humanos. Básicamente vamos a crear una vista utilizando CPEs para tener nuestra lista de empleados con toda su información y adicionalmente también veremos la parte de compra de AdventureWorks. porque aunque Adoption Works venda productos relacionados con el tema de las bicicletas y demás, hay ciertos productos que los compra. ¿De acuerdo? Pero bueno, por lo tanto, como decía, vamos a empezar con ello, pero si alguien tiene alguna pregunta o alguna duda que quiera preguntarme, ahora es un buen momento. Y como les aprovecho, tengo bastantes preguntas en el foro e intentaré responderlas entre hoy y mañana. De acuerdo, si alguno habéis preguntado algo y todavía no lo han contestado, pido disculpas, lo haré lo antes posible. Sí, dime María Delfina, claro. Hola profe, ¿cómo estás? Una pregunta, yo estaba queriendo empezar con la actividad 3 Para poder entrar antes del 9 Y estoy teniendo problemas, no sé si es algo como lo que vamos a ver ahora Pero estoy teniendo problemas con conectar la base con SQL directamente No sé si lo estoy haciendo bien, ese es el tema Pero es que la base de datos, ponme un poco en contexto ¿Estamos hablando de la actividad 3? Sí, sí, sí, del Excel que vos no subiste, de la base de datos con las que tenemos que trabajar, estoy teniendo problemas con conectarla, pero me parece que es un problema mío, no es que... María Delfina, no tienes que conectar el Excel para nada. Ah, ¿no lo tengo que conectar? No, es decir, las consultas, las tres consultas que yo os pido, este es el resultado, es decir... Es verdad que lo explicaste, tienes razón, profe, no dije nada. No, no te preocupes, no pasa nada. Pero ya aprovecho para recordarlo, ¿vale? Básicamente, las tres consultas os tienen que dar estos tres resultados, ¿vale? ¿Por qué os los doy? Es lo que os comentaba, realmente, porque las consultas se pueden hacer de varias maneras, ya es un poquito más complejo, entonces, claro, para que sepáis que lo habéis hecho bien, ¿vale? Tengáis este resultado. Y sobre todo, en el caso de que hagáis las consultas y que no, por ejemplo, yo que sé, os dé menos registros o los valores no os cuadren, que podáis revisarlo, porque esto también es un poco la vida real al fin y al cabo cuando muchas veces cuando preparáis código o similar y se lo mandáis a alguien o lo estáis analizando, por ejemplo alguien pilla un error entonces hay que volver atrás y ver si realmente se ha fallado alguna conexión o se ha filtrado algo que no se debía ¿vale? Gracias, profe, perdón Nada, nada, tranquilo Me acuerdo que lo habías dicho y me olvidé por completo, entonces lo hacemos con Adventure Works Exacto, con Adventure Works normal, ¿vale? con el que venimos trabajando todo este tiempo, ¿vale? No con el Data Warehouse, sino con el normal, ¿vale? Es decir, con este. Todas las tablas, ¿vale? Que intervienen en la actividad 3 la hemos visto, ¿vale? Por lo tanto, pues ahí en principio, a ver, o va a llevar tiempo, o va a llevar esfuerzo, pero que al fin y al cabo todo lo hemos visto y tienen la solución. Por lo tanto, es un poco desafío, pero considerarlo como si fuese un desafío realmente en la vida real. ¿Ok? y bueno, ya que estábamos hablando de la actividad como os comentaba aunque especifique que es el día 5 ¿vale? os lo puse en los foros si no recuerdo mal, tenéis hasta el día 9 9 ¿vale? a las 12 de la noche lo podéis entregar perfectamente y ya de hecho la semana que viene que será la última sesión, pues ya corregiremos la actividad ¿vale? por lo tanto es fundamental que le entreguéis el día 9, cualquier persona que me lo entregue el día 10 ¿vale? a tener que dar las consecuencias por así decirlo, porque claro si me la entregáis después de corregirla pues no es lo mismo vale ¿alguien tiene alguna duda más? ¿alguna pregunta? ¿no? ¿bien? vale perfecto, pues como os decía nosotros estamos acostumbrados, o mejor dicho nos hemos acostumbrado a hacer ya consultas y preparar diferentes datasets, entonces claro, cuando trabajamos con SQL realmente SQL en un proyecto de BI como que puede ser, desde el punto de vista del analista, el primer paso ¿vale? ¿por qué? porque aquí es donde diseñamos la fuente de nuestros datos, ya sea haciendo el Data Warehouse, que nos lo hace Ingeniería y nosotros hacemos consulta al respecto o directamente nosotros hagamos una consulta que después importemos en otra herramienta, ¿vale? Como, por ejemplo, puede ser Power BI, Python o R. En Power BI realmente hay muchísimos conectores, ¿vale? A la hora de conectar aquí podemos conectar tanto MySQL como SQL Server, ¿vale? De hecho, hay muchísimos de ellos. Entonces, claro, a modo un poco de prueba, ¿vale? Vamos a conectar con SQL Server normal, que es el que nosotros realmente tenemos instalado, ¿vale? ¿Cuáles son los programas de conexión? Pues los mismos técnicamente que tenemos aquí. Cuando nosotros aquí nos conectamos, ¿no? Tenemos que especificar un servidor. Pues en Power BI ocurre lo mismo. Aquí, por ejemplo, podemos poner el localhost, que es nuestro ordenador, en este caso, y después la base de datos, ¿vale? Y en este caso, pues vamos a utilizar la de AdventureWorks, pero el Data Warehouse, ¿vale? para crear un modelo estrella, cuestión que ya vimos la semana pasada. Ahora, hay dos maneras de importar, ¿vale? Yo no sé si esto lo he visto en visualización, pero lo explico rápidamente, ¿vale? El import quiere decir que cuando nosotros, por ejemplo, en SQL, ejecutamos una consulta y nos devuelve un resultado, ¿vale? Eso no quiere decir que estemos constantemente ejecutando la consulta, sino que la ejecutamos una vez y obtenemos el resultado. Y así es como funciona import, ¿vale? y pues básicamente lanzó una query a SQL Server en este caso e importa el resultado, ¿ok? Y entonces hasta que nosotros no volvamos a refrescar los datos, los datos se quedan quietos, la conexión está establecida, pero no se refresca nada. Y después está DirectQuery, ¿vale? DirectQuery es bastante particular y yo digo por mi experiencia profesional pocas veces lo he utilizado, muy pocas veces. ¿Por qué? Porque es una conexión directa, es decir, cada 2x3 se está ejecutando la consulta para que traiga datos en tiempo real, ¿vale? Tiene muchísimas limitaciones, sobre todo cuando operamos en Power BI, cuando hacemos diferentes tipos de cálculos en DAX, ya sean médicas o columnas calculadas, limita mucho, ¿ok? Y finalmente está, bueno, y para haceros una idea, que en el 99% de los casos se trabaja con Intel, ¿vale? Y finalmente está la opción de Advanced Options, que aquí básicamente, si no seleccionamos nada y le damos a OK, nos va a aparecer el listado de las tablas o de los objetos que podemos importar de la base de datos. Pero también tenemos la opción de escribir aquí el código, ¿vale? Por ejemplo, si nosotros quisiésemos poner Select From Ventas aquí, pues podríamos hacerlo perfectamente, ¿vale? entonces por definición vale nosotros simplemente vamos a dar, ay direct query no import ya la iba a liar yo, fíjate ya lo que me faltaba romper el ordenador no probéis lo del lo del direct query vale, en vuestro ordenador no lo recomiendo vale, addonchubox data warehouse 2017 si le damos a ok como decía veis aquí aparecen todas las tablas que están presentes en la base de datos de hecho vamos a escoger una tabla de hechos, por ejemplo la de Internet Sales, ¿vale? y algunas de dimensiones como DIMM Product DIMM Date, DIMM Customer, ¿vale? y... sí, con esta 3 yo creo que va el día y ahora cargaríamos esas tablas pero lo que cargamos realmente, como digo es el resultado, ¿vale? es lo mismo si nosotros venimos a SQL Server y especificamos select from de la tabla de hechos, perdón, pues sería lo mismo. Como veis, se han importado aquí. Y aquí realmente nosotros lo que crearíamos, gracias, lo que crearíamos es el modelo estrella que ya hemos dicho. Aquí en este caso solo he cargado dos tablas, the production dates, y realmente utilizaríamos las conexiones de las claves para crear ese cubo o lab que ya hemos visto bueno, que habéis escuchado alguna vez, ¿verdad? Por lo tanto, se haría a través de las propias claves. Y esta, técnicamente, es la manera correcta de trabajar con datos, porque aquí en la tabla de hechos tendríamos todo y utilizaremos las dimensiones únicamente para filtrar. Es decir, en la vida real sé que hay muchas empresas, y yo he trabajado de esa manera también, que suele incluir hacer una query y dejar únicamente una tabla como tal, ¿vale? Como si fuese un modelo tabular o como si fuese un excel no es lo ideal vale de cara al consumo de información porque realmente se nota el rendimiento que va bastante más lento bien esto por la parte de power bi que ya obviamente visualización lo estáis viendo también entonces claro si nosotros quisiésemos hacer la conexión por ejemplo con r o con python que sería una otra herramienta posiblemente utilicemos en el tema de análisis de datos, ¿vale? Pues pasaría algo similar. Nosotros teníamos que crear una conexión con SQL Server y a partir de ahí importar la información en un data frame, ¿vale? R, obviamente, lo estáis viendo en análisis masivo de datos, ¿vale? Y como siempre sabréis, primero, antes que nada, habrá que instalar las librerías que nos hace falta y después importarlas, ¿vale? En este caso vamos a utilizar una básica, hay muchas, ¿vale? Para establecer conexiones con SQL, pero vamos a utilizar error de bc, ¿vale? Este concepto de dependents equal true, yo no sé si vosotros lo sabéis, pero básicamente es imaginar si hay alguna librería que hace falta para este paquete que no está instalada, se instalaría automáticamente, ¿vale? Por lo tanto, vamos a instalar el paquete y vamos a ejecutar la librería, que como veis, pues, está cargando y ¡boom! ya lo tenemos. Ahora, ¿qué es lo que tenemos que hacer? Al igual que en SQL Server nosotros entramos aquí y tenemos las especificaciones, haríamos exactamente lo mismo. Sí, Alejandro, hemos visto Power BI por encima, ¿vale? De cómo importar y demás. Igualmente te digo, yo creo que tú has trabajado con Power BI, no creo que realmente diga nada nuevo. pero, ah, bueno, Python R sí, ahora mismo estamos con R pero vais a ver que es muy similar ¿vale? porque no dejan de ser objetos perdón, el lenguaje de programación orienta objetos, entonces es bastante parecido entonces como decía, nosotros vamos a crear una conexión ¿vale? a través de la librería de RDBC donde en esa conexión tenemos que especificar ciertos parámetros, por ejemplo el driver en este caso SQL Server, si fuera Maya SQL sería diferente, el server que en este caso es nuestro ordenador vale en la vida real pues tendríamos en la ip o similar y la base de datos vale y el traste con estudiar siempre siempre lo especificamos entonces lo primero es que nosotros cargamos estos parámetros de conexión en una variable vale cn y después ya podemos hacer la consulta que realmente si por el query utilizamos nuestro parámetro de conexión cn y Y especificamos aquí la query. Por ejemplo, ¿cuál es la ventaja de las vistas? Imaginad que preparáis una consulta compleja con mucha información, que es muchísimo código, pues en vez de pegarlo aquí tal cual, lo guardáis como vista y lo utilizáis de esta manera. ¿Vale? Por lo tanto, si yo ahora mismo ejecuto esta parte, lo que estamos haciendo básicamente, a través de la interfaz de R, nos vamos a SQL Server y obtenemos la información. Es decir, lo mismo que si utilizásemos... management studio, pues sería un poco el equivalente como veis el data frame la tabla de header 28 variables, 31.000 observaciones, exactamente igual que ocurre siempre y después si queréis podemos hacer un print o para que sea más específico el summary, tenemos de cada campo de qué tipo es, su recuento, media mediana y demás sí, dime Alicia de Transgélica, dime, que has levantado la mano sí, gracias es más una duda y no sé si has presentado ese tema de pronto en lo que trabajas y saber cómo lo puedo yo resolver también tenemos la base de datos conectada de SQL a Power BI lo que hiciste ahorita, y ahí en Power BI se hace la parte de visualización gráfica fórmulas temas de calendario, etcétera para que funcione ahí en la visualización pero digamos que ventas o ejecutivos de ventas que puede que no tengan tanto conocimiento técnico en Power BI o filtrar o saber leer las gráficas desde ahí utilizan mucho la tabla para poder sacar sus propios cálculos o ver meses, sí, como detenidamente y a veces es difícil lo típico, ¿no? de que lo mismo se hace una tabla e incluye todos los campos, sino que a veces el Power BI como que no es tan detallado para encontrar muchas más cosas, entonces siempre se les dice pues ok, revisen Excel, entonces yo tengo Excel conectado al modelo de datos, al conjunto de datos de Power BI y de ahí pues cada ejecutivo tiene su permiso desde el rol que se les da y con eso en Excel pues ellos pueden tomar la tabla dinámica y armar sus propias cosas, ¿sí? Pero, bueno, la duda es, siempre deberíamos seguir como ese flujo desde Power BI porque igual en SQL pues yo no tengo fórmulas hechas ni como el programa más detallado o qué campos voy a jalar yo al final hacia el Excel conectado de Power BI? ¿O qué otra forma podría trabajarse para yo poderle entregar eso a los ejecutivos que no sea Excel? Aquí viene el problema o sea que no es técnicamente el problema, es el problema como digo yo, de la parte del dato como tal, de la gente de arriba decir, yo creo que de todos los que trabajan aquí, seguramente los de arriba siempre, siempre, siempre lo quieren, una de dos, lo quieren en Excel o lo quieren en impreso. Entonces, ahí la cuestión está en la empresa. Es decir, que la empresa empuje a los de arriba a que lo utilicen. No te puedo decir una solución mágica para ello porque sigo teniendo ese problema. Bueno, si lo metes en un pendrive, Alejandro, sabes que te pueden denunciar porque es... Total. Porque es judicial. O sea, ten mucho cuidado. El tema de gobernanza de datos no se puede decir. Pero que igualmente lo que comentas, es decir, es algo bastante normal que ellos pidan. Entonces, tiene que ser que se ponga de acuerdo con la empresa para utilizarlo ¿vale? y pues seguramente o sea por fax porque el fax yo creo que ya no lo usa nadie pero que igualmente es algo que es muy difícil ¿vale? o sea no se no se sienta frustrado con ello porque yo me he frustrado muchísimo y lo único que he conseguido es dolor de cabeza y poco más es decir tiene yo recomiendo lo que sí por ejemplo solemos hacer nosotros es que si es un muy alto nivel es decir nivel C por ejemplo es que le hagamos una especie de dentro de Power BI se lo demos todo muy mascadito es decir ellos normalmente van a pedir KPIs quieren 50 KPIs cosa que en el fondo si son 50 tan KPIs no son son indicadores normales como tal entonces lo que solemos hacer es un poco dividirlo por zonas y enviarle a lo mejor un email de cuando el informe sea refrescado con un PDF impreso, entonces claro para ello muchas veces en vez de clicar en el PDF ya directamente vale el enlace. Entonces hemos conseguido que utilicen un poquito más Power BI. Pero es una casuística realmente compleja y depende de quién esté arriba. Pero vamos, que ese problema lo tenemos, yo creo que lo tenemos todos. Ok, ok, no. O sea, sí, digamos que la solución no está tan mal planteada. Al final es un Excel conectado a Power BI y sí. No, o sea, realmente se lo procesa porque lo conecta a Power BI y se fijan un poco más de eso. A ver, con que consuman al final Power BI y ya después pues ir cambiándolo poquito a poco. Ok, perfecto. Gracias. Sin problema. Alejandro pregunta, oye, R para ETL no te lo recomiendo ¿vale? con el tema de ETL si lo tenéis en SQL ¿vale? imagínate Alejandro, si tenéis la mayor parte en SQL, lo mejor es hacerlo ahí, ¿vale? imagínate que tienes parte de SQL y parte, que se yo que viene a lo mejor de otro lado que tú te conectas con un lenguaje de programación, ahí te diría Python ¿vale? y de hecho Python a ver, yo no lo he utilizado mucho para ETL, en general no lo he utilizado mucho, pero sí que también la parte positiva de Python que tú puedes utilizar Python como tal y después utilizar el código de SQL es decir, si lo metes en variables como hacemos aquí, funciona bastante bien ¿vale? Y hablando del DirectQuery es, imagínate que nosotros, o sea, para haceros una idea imagínate, ¿no? tenemos el 6-order header cuando nosotros hacemos import simplemente ejecutamos, nos aparece este resultado y es lo que se carga dentro de Power BI, ¿vale? Si tú haces Data Query lo que está haciendo es esto está constantemente torpedeando la base de datos para actualizar la información o sea, el término de recursos es bastante peligroso y que limita mucho lo que puedas hacer en Power BI ¿vale? Por lo tanto esto de los datos en tiempo real, a ver mucha gente lo quiere pero después con que lo refresques una cada hora da el mismo resultado que si lo refrescas constantemente, ¿vale? No me acuerdo ahora mismo que... Ah, la librería, sí, la librería Verónica es la misma, ¿vale? Lo que cambia es el driver. No me acuerdo cómo se llama ahora mismo, no sé si se llama SQL o similar, ¿vale? Y, listo, ahora hablamos de Python, ¿vale? Que lo tengo yo también. Sí, como dice Alejandro, o sea, yo normalmente las veces que he trabajado con R en las empresas, es decir, yo me preparo el dataset ya limpio para hacer, que se yo normalmente yo lo que he hecho son revisiones lineales vale, o sea, transformando cosas aquí a lo mejor para transformar que sea distribución normal y a partir de ahí pues lanzar el tema el tema de la revisión lineal o el logit o revisión logística que es la clasificación con lo que más he trabajado, entonces claro en limpiar lo máximo posible en SQL cargarlo en una vista, ¿vale? y cargarlo después en él esa es la manera en la que he trabajado en Python, pues un poco igual dices aquí, ¿no, Paulina? para que veáis, no, es decir cualquier cosa que hagáis aquí con el resultado no va a afectar a la base de datos, ¿vale? es decir, para que veáis no puedes sobreescribir algo, no dejaría ¿vale? pues, igual o le digo, Lucía, mira, ves como aquí yo he puesto un select from que esto es una tabla, pero imagínate que yo preparo una consulta compleja ¿vale? la incluyo una vista y desde R pues llamo simplemente la vista ¿ok? mira, pregunta pregunta un poco tonta que análisis y masivos datos lo he visto fijaros aquí, lo de total due con lo del summary, el summary lo ha visto todo el mundo ¿no? fijaros ¿qué significa o qué pensáis qué significa que si la mediana en la moda perdón, la mediana en la media tiene tanta diferencia qué os da a entender siempre suelo preguntar esta tontería pero ¿se ha llegado? lo primero es que, a ver, esto no es una distribución normal, ¿vale? puede haber outliers, sí pero lo más importante es, si es esto analizarlo muy bien con si después vais a hacer algo estilo revisión lineal por ejemplo para esto regresión lineal no podrías aplicarlo tenías que transformarlo, pero bueno esto es simplemente una pregunta tonta porque esa sincronización no es mía vale, y como decía, lo ha dicho también una compañera, bueno, decidme Alejandro, bueno, Liz, tú creo que levantaste la mano, no sé si es otra pregunta o es la misma, si no pues Alejandro. Ah, no, se me quedó ahí pegado ya. Ah, vale Nada, Alejandro Hola, sí, hola Dime, dime, si se te escucha Sí, que es que claro porque has dicho bueno me traigo aquí tal la vista AR y entonces pues me hago aquí mi modelo Logit o lo que sea y tal, que pasa que muchas veces claro la clasificación que tú a lo mejor puedes hacer por ejemplo lo que hemos aprendido de clustering ¿vale? oye pues yo me saco esto para hacer un clúster vale pues muchas veces ese clúster a lo mejor te interesa tenerlo luego en tu SQL ¿sabes? para que luego otra persona de negocio lo coja, entonces por eso preguntaba lo de la ETL, pero claro me has dicho luego, no, pero para ETL no te lo recomiendo R, mejor Python ¿sabes? que también se puede hacer un cluster en Python, pero entiendo que un flujo típico sería ese, pues me llevo a R la movida, me hago un ABC por ejemplo el típico ABC o me hago eso es algo que no me haría en SQL, sino que me haría con R, me lo subo. No te había entendido, porque para mí el concepto de TL es de ingeniería, es decir, sería básicamente, qué sé yo, pasar de LTP a almacén de datos o similar, es decir, no sería como transformar, o sea, TL para mí es más transformar los datos. La parte esta de análisis, es decir, yo qué sé, por ejemplo, una dirección lineal o la logística, tú tienes los betas, tienes los coeficientes, es decir, vale, los hago, y a lo mejor los quiero volver a cargar dentro de SQL, seguramente se pueda ¿Vale? Es decir, yo sí que es verdad Que no es algo que he hecho, pero Se puede seguramente, es decir, si tú al final Acabas con un data frame que es el resultado Que tiene los coeficientes con el cluster El mapeo, tú lo puedes mandar De vuelta a SQL y a lo mejor Analizarlo ahí, ¿vale? O para cargarlo En un Power BI En ese aspecto, como tú dices Lo que sería como análisis como tal Realmente da igual utilizar ErrorPython Es decir, con lo que más cómodo te sientas Sí que es verdad que Python, si es con muchos datos te va a ir un poquito mejor, pero es que realmente es como cuando la gente pregunta ¿qué es mejor, Error o Python? es que ambos son buenos o sea, Python está más enfocado en estadística es más user friendly eso en realidad me preguntaba pues si se puede hacer, o sea, sería un flujo típico también de R es decir, oye, me hago un clúster y luego lo cargo de vuelta a mi base de datos para que otra persona, otro equipo yo que sé, pues yo soy de marketing, te digo, mira, te he clústerizado a ti de ventas las cosas de esta manera y entonces va a estar siempre aquí clasterizado, o yo qué sé, he hecho un forecast, he calculado mis meses de stock y eso no lo he hecho en SQL porque me era muy complejo, aunque se podría claro, sería mucho más jaleoso pero sería más jaleoso que me lo saco a Python o a Excel o a Excel, lo que pasa es que Excel luego no tendría no tendría conector, entonces sería un archivo muerto. Yo en ese caso sí que es verdad que yo no lo he hecho nunca, yo si fuese yo el que tenía que hacerlo, yo seguramente hablaría con Egeidia para que me diesen algún usuario o lo que sea para que yo pueda volver a cargar el resultado, el output que tengo ya sea de la predicción o del clúster o similar y volvería a cargarlo a SQL en una tabla y tal cual, yo seguramente lo haría de esa manera, sería lo más lógico porque también como tú dices si yo después a lo mejor lo quiero combinar un poco con otra tabla o con un modelo de datos que realmente tiene impacto en ese análisis, pues lo cargo en una tabla, pues lo meto en Power BI junto con el almacén de datos de ventas en este caso y otra tabla para el tema de los clústeres y listo, sobre todo para que todo esté en la misma en el mismo source, yo creo que lo haría seguramente así, o sea, tendría en todo el sentido el mundo ¿vale? y... ah, vale, ya lo tenía aquí abierto, perdón y básicamente en Python, como digo, sería muy similar, ¿vale? y es como decía como estaba comentando hace un momento, es decir Python y R es un poquito más user-friendly enfocado a estadística y hay muchas cosas que se puede hacer a botones y Python es puro código ¿vale? obviamente hay solamente hay ideas más específicas que ya tienen cosas precargadas pero que igualmente es muy similar, solo que el código pues cambia un poco ¿no? por ejemplo aquí vamos con pandas y utilizamos la librería de py o dbc daos cuenta que la otra que haga R o dbc y esta es py de Python o dbc Y aquí es lo mismo. Primero, la conexión, ¿vale? Que como si lo veis, realmente es clavada, ¿vale? Como tal, lo que hemos visto en R, porque bueno, la conexión al final. Y después se haría de una manera similar. El PDE de Pandas, PDSQL, la consulta como tal y el parámetro de conexión, ¿vale? Lo ejecutaríamos y aquí igual, si queremos el print del data frame, en este caso le hacemos un summary con el describe, ¿no? Y aparecería un poco lo mismo. Es decir, como veis, es bastante sencillo. El tema de las conexiones entre una herramienta y otra, lo normal, tampoco suele ser lo más complejo, pero sí que es verdad que muchas veces es útil simplemente ver qué se puede hacer. ¿Dudas? ¿Preguntas? No. Vale. Pues como decía, vamos a seguir practicando SQL sobre todo de cara a repasar todas las cláusulas que hemos visto, la manera de trabajar. Y lo vamos a hacer en este caso con recursos humanos. Imaginad que a nosotros nos piden, oye, necesito que me crees una lista actualizada que tenga la información de todos los empleados. Entonces nosotros lo primero que vamos a hacer es decir, vamos a tirar por la tabla de employee, que es la tabla principal. ¿vale? y ahora pues haremos diferentes filtros al final para practicar un poco y sobre todo vamos a repasar porque lo hablamos la semana pasada de ver también otra vez un poco la utilidad de los CTE ¿no? y de las vistas y esto es un ejemplo que realmente siempre hago que es bastante útil ¿vale? Pero bueno, la parte principal que nosotros tenemos que hacer es crear una vista con la información relevante de los empleados activos. Por lo tanto, vamos a empezar con la tabla principal que sería la de employee, la de empleado. Y aquí como veréis, una vez más está el Business Entity, ¿vale? Que ya hemos visto que es la clave para cualquier entidad dentro de AdWords que tenga algún tipo de relación, ¿vale? No vamos a utilizar todos los que tenemos aquí, sino solo algunos de ellos, como por ejemplo el Business Entity, ¿vale? el organizational level, el job title, la fecha de nacimiento, tenemos el marital status, el género, la fecha de contratación. mirad, el salario de flag si os entran dudas siempre podemos ir, como siempre digo al diccionario de datos y lo revisamos de hecho voy a buscar no podáis, no hay más resources employee vale, salario de flag 0 si es a la hora y 1 si es asalariado pues normal vale, realmente no es algo que nos haga falta pero bueno, vamos a a mantenerlo y después tenemos las horas de vacaciones y las horas de baja que tiene ¿vale? con esto realmente nosotros ya tenemos una gran parte de la información de los empleados pero nos faltan muchas cosas importantes como por ejemplo el nombre, no sabemos cuáles son los nombres de los empleados, si nos vamos al diagrama ¿vale? veréis que obviamente employee se conecta con person, recordemos que person es la tabla donde tenemos a los diferentes individuos dentro de AdWords. Está EM, creo que son empleados, está IN, que son clientes individuos, etc. Por lo tanto, vamos a practicar y recordar un poco el combinar tablas. Recordar que tenemos el inner join, left join y right join. Por defecto, como ya os he dicho, tanto en la actividad, a menos que yo especifique lo contrario, como en el examen, utiliza el inner join. A menos que yo os diga lo contrario. Entonces aquí tenemos el Business Entity ID de Person que sea igual al Business Entity ID de Employee. Y aquí, pues obviamente, lo único que nos interesa realmente de esta tabla es que sabéis los nombres. Tenemos el First Name y tenemos el Last Name. ¿Vale? Listo. Ya por lo menos aquí tenemos los nombres. Hay un total de 290 empleados, cuestión que no he dicho, pero bueno, es interesante. Ahora, imaginad otro concepto importante. Oye, ¿cuánto cobra el empleado? Entonces, claro, si nosotros miramos aquí el diagrama, veremos que hay una tabla que es el Employee Pay History. Entonces, pues vamos a ver qué es lo que contiene esa tabla. vale, fijaros, aquí básicamente está el rate, que sería el salario a la hora, ¿vale? y está el business entity y cuándo se ha cambiado, ¿no? entonces, claro, yo la primera pregunta que os hago, porque esto es algo que solamente os contigo esta empresa siempre que tenga la palabra history, cuidado os pregunto, primero, algo que vimos el primer día de clase ¿cuál es la clave primaria aquí? ¿os acordáis lo que es la clave primaria? me imagino la fecha yo creo que fecha va a haber varias iguales el business entity ID ¿el del empleado igual o no? ¿sí? ¿seguro? ¿qué pasa aquí? por ejemplo el business entity ID aquí se duplica ah, sí, claro porque imagino que se le ha modificado el salario en varias ocasiones Exacto, a ver, sí, concatenando si se podía hacer la clave primaria, Alejandro pero bueno, la historia, por ejemplo el empleado 4, ¿vale? tiene un total de 3 registros en el histórico del salario, viendo los datos que se nos viene a la cabeza por ejemplo el primer registro que hace referencia que desde el 5 de diciembre de 2007, este ya su salario a la hora. Pero ¿qué ocurre? El 31 de mayo de 2010 se lo subieron. Y el 15 de diciembre de 2011 se lo han vuelto a subir. Entonces, ¿qué ocurre? Aquí hay duplicaciones, pero hay unas duplicaciones con sentido. Lo ideal sería, pues, efectivamente decir, vale, porque fijaos, hay 317 filas cuando hay 290 empleados. Si yo quisiese saber la última fecha, es decir, el último salario, lo ideal sería, pues obviamente, coger por fecha. Vamos a hacerlo un poco a lo trocho para repasar las funciones de agregación. Supongamos que nosotros lo que queremos es el rate más alto, que en principio también tenía sentido, rara vez alguien le manda más al sueldo, que puede pasar. pero supongamos, en vez de que sea la última fecha lo que nos dicen, oye, yo lo que necesito es para cada empleado el máximo rate, que sería como el que cobre ahora mismo ¿qué haríais? yo lo que necesito es saber el salario más alto por cada empleado suponiendo que ese salario alto, el más alto, es el actual ¿qué es lo que haríais en esta consulta? si quiero el salario más alto ¿qué hago? ¿nadie? una función agregada, muy bien, max ¿pero qué haría? max rate, ¿no? pero, tú simplemente me dices el salario máximo, ¿qué más? agrupar, muy bien, agrupar ¿en base a qué? a la fecha el salario ¿a la fecha? ah no porque es el más alto el salario más alto sería por la persona ¿no? el business entity que sería el empleado exacto, pero ¿qué ocurre? si lo especifico aquí y no lo pongo en el select no me sale, entonces simplemente me salen los salarios y ya está recordad, esto también un poco repaso que si nosotros tenemos una función de agregación y nos piden que agrupemos por algo intentar siempre que en el group by y en el select vaya exactamente los mismos atributos bien, ahora hay 290 es decir, nos hemos quitado en esencia las duplicaciones, por supuesto que es el último salario verdad que es una suposición que no sería real del todo, pero bueno, para agilizar un poco las cosas consideramos que el máximo salario es el último bien, ahora yo tengo mi consulta anterior ¿no? y tenemos esto de aquí ¿vale? que sería el el es que si aquí, ¿qué decís? ¿de poner aquí la fecha? Alejandro, si ponemos aquí la fecha vamos a poner, escoger la máxima fecha pero en la máxima fecha no te va a dar el max rate, es decir, esto se podría hacer con una subconsulta es decir, cuál es la última fecha y después lo hacemos, ¿queréis hacerlo bien? no me importa, esto simplemente que lo suelo hacer, vale venga, digamos, vamos a hacerlo bien ¿vale? es decir, supongamos como Dios manda venga, lo hacemos, el problema, yo normalmente que no lo suelo hacer así para ir más rápido, pero lo que estamos diciendo, efectivamente nosotros técnicamente lo primero tenemos que hacer el que? la última fecha ¿vale? porque es la última actualización ¿qué es lo que hago? pues el business entity id ¿no? y el que? el max rate change date vamos a llamarlo pues max date ¿vale? y agrupo ¿ok? bien Ahora, sé que de cada empleado está la última fecha. ¿Cómo consigo traer aquí ahora el RAID? ¿Qué haríais? Que de hecho esto es un buen ejemplo para la CT. ¿El join? ¿Join con qué? Concatenando las dos. No, porque ya sacaste el nuevo más de ahí. No. es decir, aquí hay varias maneras ¿vale? podríamos hacerlo con una subconsulta o podríamos que volver a combinar la tabla es decir, tenemos el histórico original ¿vale? H1 y yo aquí voy a combinar H2 ¿vale? pero en el on, en vez de utilizar una única clave, tendría que hacer qué? Dos business y la fecha. Eso es. Diría aquí business entity ID que sea igual business entity ID dos y este que sería igual a este. ¿Vale? Y del H2 el rate, ¿vale? Que lo vamos a llamar salary. y ojo reit aquí no es una función de agregación ergo viene aquí si yo ejecuto esto es ambiguo perdón pero qué ocurre no me deja si, dime algo Lucía esto sería lo primero que plantearíamos dime lo que pasa es que me perdí porque vuelves a combinar la misma tabla porque fíjate, si yo simplemente dejo esto vale aquí yo tengo la máxima fecha ¿vale? si yo aquí hago el máximo de rate daría igual la fecha, es decir, haría lo que hemos hecho al principio Jorge, esto en el examen no se va a poner ni mucho menos no os preocupéis, entonces yo lo que quiero es yo tengo el empleado la última vez que se revisó su sueldo ¿vale? esos son dos conceptos fundamentales y yo acá tengo que volver a combinar con la tabla ¿vale? dándole la clave de el empleado pero también si ha tenido varios cambios la última fecha vuelve a conectarlo pero como veis no podemos utilizar una función de agregación aquí como tal entonces aquí hay varias maneras de hacerlo ¿vale? esta no serviría pero lo que sí podemos hacer es primero utilizar esto cargarlo en un CTE y después reutilizarlo ¿vale? que de hecho es lo que vamos a hacer y así repasamos los CTE ¿os acordáis? ¿no? el CTE que básicamente es como escribir subconsultas por partes las tenemos separaditas y después en el SELECT la combinamos ¿vale? vamos a poner esto como H1 para que dejarlo ¿vale? que sería pues básicamente voy a quitar las claves las alias porque lo único que va a hacer es confundirnos ¿vale? esto sería el h1 ¿vale? y ahora de h1 yo le voy a volver a combinar en Play History inner join como h2 donde h2 business entity id es igual a h1 business entity id y h2 perdón h1 max date tiene que ser igual al rate change date 2 vale entonces h1 es esto de aquí devuelvo y aquí devuelvo del H2 el R ¿vale? y ahora sí obtendría el último, por ejemplo si yo ahora miro el 4, creo que va a coincidir ¿vale? porque eso siempre suelo hacerlo de esa manera ¿veis? 29 dime Elisa si si es que solo una duda porque no sé si igual se pueda o es que estoy pensando mal sobre la tabla donde está el salario que pues como el business entity el más de ahí igual no se podría generar desde ahí la columna concatenada o no recomiendas trabajar así de las tablas o sea te refieres de concatenar el rate change date con el business entity. Ajá. Lo ideal es que si la tenéis separadas podéis poner en las conexiones todas las claves que queráis. Que sea una opción concatenarlo. En principio también. ¿Vale? Pero no te sabría decir si es una ventaja o desventaja. Yo creo que siendo así es más rápido. Pero claro, depende. ¿Vale? Yo si tuviese que optar, optaría por esta manera. Porque si yo concateno y después concateno en la otra tabla que ya hay gasto de recursos y después lo vuelvas a combinar simplemente haciéndolo así pues valdría sí, ok, perfecto pues como decía aquí tenemos ya nuestra tabla con el, bueno vamos a llamarlo salary ¿vale? y ahora ¿qué pasa? que queremos combinar esto con lo que tenemos aquí arriba entonces claro, ¿qué sería lo ideal? pues ya que he empezado aquí con el CTE ¿Qué voy a hacer? Voy a incluir esto también como un CTE, ¿vale? Y lo voy a llamar como Salary T, ¿vale? Table. Y aquí, quito los Deque Byte, hago mi segundo CTE, ¿vale? Primero echo este, que lo incluyo en este segundo. ORDER BY 1 es simplemente para ordenar resultados, Paulina. Sin más. Hay que pasar a ver el RAID del empleado 4. Sin más. ¿Vale? ORDER BY 1 es lo mismo que si yo pongo, es decir, 1 o 2 o 3, es el orden de los atributos que nos devuelve la web. ¿Vale? Para no escribir el nombre entero, ¿vale? Lo podemos utilizar mediante números, que sería el orden de los campos. ¿Me he explicado? Mira, por ejemplo, ¿sí? Vale. Bien, pues entonces tenemos el H1, que sería el histórico, ¿vale? La fecha y después ya tenemos la segunda CTE, donde ya tenemos el salario. Entonces, ¿ahora qué hago? Pues me vengo ya a mi consulta final, ¿no? y aquí index.join saler.it ¿vale? donde tenemos el business entity ID que sea igual a que al business entity ID employee ¿vale? y aquí pues traigo el salario y fijaros si queréis traer la última fecha de cuando se revisó también podemos y fijaros lo ejecuto y funciona, es decir un cte, dos cte y select final. ¿Vale? Y aquí, pues, tenemos el salario. Que, por cierto, aquí una desigualdad entre los jefes y empleados. Échale un vistazo, que vaya flipando. Vale. Entonces, tenemos esto. ¿Qué ocurre? Si nosotros nos vamos aquí a empleados, ¿qué otra información nos hace falta que es fundamental? El departamento en el que trabaja. El empleado. ¿No? Que aquí está. Campo de department. Fijaros. vamos a migrar que es lo que contiene department ¿vale? bien, como veis la tabla de department tiene la clave primaria el nombre, el grupo y ya está, entonces yo os pregunto ¿puedo combinar directamente estas dos tablas? es decir, ¿puedo añadir department a mi consulta anterior? ¿Tengo las claves necesarias? ¿Sí o no? En otras palabras, ¿aquí arriba tengo el department en algún lado? No. Entonces, y efectivamente, si nos vamos al diagrama, como veréis, efectivamente... Se ha conectado al histórico. Hay que pasar por otra tabla histórica. Vuelvo a deciros, y esto en la vida real, cuidado también, ¿vale? Cada vez que veáis una tabla que tenga History de por medio, miradla bien. En el nombre que prefiero. Bien, tenemos Human Resources, Department, History. ¿Vale? Y fijaros. ¿Cuál es la clave primaria aquí? ¿Cuál es la clave primaria aquí? ¿Es Business Entity? es que llevo todo el día con los cascos la oreja esta la tengo destrozada ¿por qué no es Business Entity? ya tenemos aquí otra vez tenemos a nuestro señor 4 que es un pesado en la base de datos vale, como veis señor 4 aparece dos veces ¿por qué? yo no tengo ninguna explicación, simplemente mirad los datos porque en un departamento entró y luego salió y ahora está en otro departamento muy bien el de Parmenaiti es el ¿en qué departamento está ahora mismo? en el 2 en el 2, ¿todo el mundo lo ve? ¿el por qué? fijaros el señor 4 trabajó en el departamento 1, en el shift 1 desde el 5 de diciembre de 2007 hasta el 30 de mayo de 2010, es decir, tiene una fecha en la que dejó de trabajar en ese departamento y después tenemos que este señor trabaja en el departamento 2, empezó el 31 pero la fecha es nula, ¿qué quiere decir esto? que efectivamente sigue trabajando en ese departamento ¿sí? bien, entonces si yo, aquí hay 296 registros si yo quiero saber en qué departamento trabaja ahora mismo cada uno de los empleados qué modificaríais aquí es decir, qué haríais para limpiar esta tabla filtrar todos los que en el end date sean nulos escríbemelo en el chat recordad que los nulos son especiales donde trae la fecha o sea que tenga un business entity que traiga la fecha y los que llegan nulos y quitarlos. Eso es. Porque si vas a quitar solo los nulos y si tienen fechas, toca tener cuidado igual, ¿no? No, pero si yo quiero, si los nulos son, es decir, si el end date es nulo, quiere decir que es el departamento actual, ¿no? Ah, porque no se ha ido en end date, correcto. Entonces, para saber en qué departamento trabaja cada uno empleados a fecha de hoy, por así decirlo, que tenía que poner el date que... Igual a nulo. Eso es, cuidado. Is nul, no igual a nulo. ¿Vale? Recordad eso. Los nulos son específicos, ¿vale? No hay dato, es is o is not. Pero sí, efectivamente con ello, además fijaros, 290 que son los empleados que hay, pues listo. Tendría lo que viene siendo el departamento actual, ¿vale? pero ¿qué ocurre? tengo el código no tengo el nombre del departamento, entonces ¿qué vamos a hacer? combinar, ¿vale? pero antes aquí DH vamos a quedarnos con el business entity ID ¿vale? y en principio, poco más, lo que haríamos es el que combinar ahora department, ¿vale? inner join department donde de department id sea igual a department id y ahora pues de aquí, del department quiero el name ¿vale? que sería el departamento como tal y el group name, que sería department group ¿vale? si ejecuto esto efectivamente tengo el departamento y el grupo de cada empleado. ¿Qué otro dato interesante hay aquí? El shift, el turno. Podríamos también, ya que estamos, obtener la información de los shift. ¿Vale? ¿Qué haríamos? Pues igual, simplemente combinar. index join shift donde el shift id es igual a shift id y especifico aquí ese name ¿vale? que sería el shift bien con ello pues tengo el departamento el grupo del departamento que veis que se combinan y el shift ahora esta consulta tan bonita que he hecho yo la quiero incluir aquí arriba donde tengo lo principal que hago ya tengo dos ctes uno y dos que hago uno tercero vale que vamos a llamar de pacman dónde incluyo esto que tengo aquí y ahora que hago el tercer CTE me voy al select final y aquí igual in-join department donde business entity id sea igual a business entity id y de aquí me interesa el departamento el department group y el shift ejecuto y listo ¿no? fijaros tengo ya ahora todo lo que necesite, de hecho por ejemplo el salario es por hora, si suponemos que un empleado trabaja sus 8 horas a la semana que son 40 ¿vale? y que esas 40 porque 52 semanas sería el salario anual ¿queréis que lo calculemos? Profe, qué pena, tengo una pregunta dime, dime si es que ahí me perdí un poquito, ahí combinaste tres tablas ¿cierto? ¿ahí has combinado tres tablas? Department y Shift o sea, esos tres inner joints que pusiste en la parte de abajo es porque has combinado tres tablas diferentes. Claro, pero cuidado. O sea, ¿usted lo dice aquí o aquí arriba? Porque date cuenta que esto es el primero. Decimos para el máximo rate. Aquí es donde traíamos el salary. Pero son todas diferentes, no son consecutivas. No lo voy a seguir escribiendo. Esta sigue existiendo, esta sigue existiendo, y ahora también sigue existiendo. Y lo que hago es que aquí al final combinas de todo. Bueno, todo no. me hace falta la de SAD y la de Department ¿por qué? porque la H1 no me hace falta para nada ¿vale? solo me hace falta esta y esta es decir, también las CTE sirven para preprofesar, como por ejemplo hemos hecho en este caso ah, dale profe, gracias sin problema, entonces como decíamos podemos hacer esto que sería por 40 por 52 una área muy genérica que sería el annual salary. Recordad que nosotros podemos interactuar y crear en las consultas realmente interacciones entre los diferentes campos. Como por ejemplo es este. ¿Vale? Que aquí tendríamos pues el salario anual. ¿Sí? Todo el mundo me sigue, ¿no? Entonces, claro, imaginad que nosotros hemos hecho este pedazo de consulta el cual nos proporciona la información de todos los empleados activos a día de hoy. Entonces, claro, para dejar esta consulta o en recaudo, ¿qué es lo que hago? Creo una vista. De hecho, un momentito, porque voy a borrar la de la clase anterior. Especifico, create view, el nombre de la vista, as y el código, donde están los CTEs. Entonces, si yo ahora ejecuto esto, básicamente en esta tabla virtual, en esta vista, ¿qué he hecho? He almacenado el código, no he almacenado los datos. Es decir, si algo cambia en Employee, en Person, en Department History, en Department, en Page History, si algo cambia, se vea reflejado en la vista. ¿vale? y recordad que la vista una vez que la tenemos podemos operar con ella como si fuese el que una tabla ¿vale? he hecho lo que decía antes con R, imaginaos que hacéis este pedazo de consulta y ahora venís aquí a R o a Python y le decís, vale, pues yo quiero esto de aquí, ¿vale? de hecho, mira, lo voy a borrar todo y lo voy a volver a a ejecutar ¿vale? establezco la conexión y fijaros lo que acabo de hacer lo cargo en R ¿ok? claro es decir, si tú te vas aquí a la base de datos a views y buscas el nombre de la vista, como lo hemos llamado www.empleados.com www.empleados.com que está aquí. Si tú le das aquí, clic derecho y quieres ver el script que hay detrás aquí lo tienes. ¿Vale? Ahora, imagínate que... Perdón, sí, dime. Dime, Lucía, dime. Lo que pasa es que de pronto no fui clara en la pregunta. Es decir, tú en la vista está compuesta por no sé, tres CT, creo cuatro, bueno, la cantidad de CT Hay tres, uno dos, tres, sí Mi pregunta está orientada si yo guardo esos CT en una vista, después cuando haga una consulta ¿puedo acceder a cualquiera de esos CT individual, es decir, no necesariamente llamando toda la vista? No, no, no, vas a llamar lo que te va a aparecer es esto, que es la última parte Es la tabla final claro, te va a aparecer la tabla final es decir, en la vista te va a aparecer exactamente lo que tú incluyas en el código que en este caso es todo esto ¿vale? es decir, tú no puedes acceder a la CTE es decir, no son tablas, no están en ningún lado solo existen durante la ejecución de la consulta, ¿vale? vale, pero sin problema entonces, como decía sí, eso de hecho es lo que iba, fijaros, ¿no? Imaginad que aquí, en vez de salario anual, ¿vale? Nos dicen salario semanal, que lo queremos incluir, ¿vale? Pues sería el salary por las 40 horas, ¿no? Y sería weekly salary. Fijaros, si yo voy de primero de cambios, a primero de cambios e intento ejecutar esto, se va a quejar porque va a decir, oye, ya existe una vista que se llama W empleados. Entonces, aquí hay varias opciones. Una, elimino la vista, con el Drop View y la vuelvo a crear. O dos, Create or Alter View. Pero cuidado con esto porque si cometéis un error o imagínate, borráis esto sin querer y lo ejecutáis, se guardará. Hay que tener mucho cuidado. ¿vale? Profesor, lo ideal primero es creo la primera vista que necesito sin modificar porque voy a agregar de pronto más columnas o modificar algo entonces luego sí modifico el campo y sí o sí tengo que borrar la vista que creé primero o hacer el alterativo para que funcione No, funcionar va a funcionar pero imagínate que tú añades, cambias cosas aquí en esta consulta y no las guardas pues las pierdes al final y cabo, es decir, tienes que sobreescribir la vista si la quieres sobreescribir, obviamente ¿vale? imaginaos esto como cuando un archivo que modificáis algo, que queda a guardar, porque si lo cerráis sin guardar, pues no se queda ¿vale? y insisto, lo ideal a ver, esto lo podéis hacer, pero lo ideal es que hagáis siempre create view al principio, no vaya a ser que sobreescribáis algo, ¿vale? primero comprobáis que todo está bien, después Pues elimináis la vista y la volvéis a crear. Yo os recomiendo eso, para que no os lleveis ningún susto. ¿Vale? Bien. Pues como os decía, ¿no? Una vez que nosotros tenemos todo esto, pues ya está. Nosotros podemos trabajar con esta vista como si fuese una tabla. ¿Vale? Y os digo, esto es la manera normal de trabajar. ¿Ok? Bien. Vamos a hacer una rondita de repaso, sobre todo del web. Imaginad, tenemos nuestra vista de empleados aquí. Y entonces nos dicen, de esta vista quiero filtrar por aquellos cuyo estado civil sea soltero, single. ¿Qué pongo en el web? Escribidlo en el chat. Solo quiero aquellos que sean solteros. es un único dato. Cuando hablamos con un único dato, ¿qué hacemos? ¿Qué ponemos aquí? Igual, in, like, eso es. Igual, ¿vale? Es decir, si es solo un dato, acostumbraros a utilizar igual. ¿Vale? Ahora, imagínate que nos dicen, oye, yo lo que quiero, los empleados del nivel organizativo uno o cuatro. ¿Qué hacéis? Uno o cuatro. ¿Or o el N? No sé. No, no, no. Ambos son válidos. Pero ante la duda, los ideales sí vienen, ¿vale? Como siempre os he dicho, cuidado con el or. El or después es el camino de la amargura muchas veces, ¿vale? Uno y cuatro. Recordad que in or es o 1 o 4, no es de intervalo. Pero si ahora nos dicen, oye, yo quiero aquellos empleados cuyo salario, que es este de aquí, ¿vale? El salario por hora, oscila entre 30 y 70. Es decir, es un intervalo. ¿Qué hacéis? muy bien hay varias maneras de hacerlo uno, como dicen los compañeros es between, ¿cuánto he dicho? bueno, da igual, 30 y 70 pum hay un total de 24 ¿vale? el between es intervalo ¿vale? lo mismo puedo decir que sea mayor o igual y menor o igual ¿vale? ambos serían varios ¿sí? lo mismo si nos dicen, oye, que la fecha de contratación sea entre marzo de 2018 y septiembre de 2009 lo mismo, ¿no? between dos fechas ¿vale? que he dicho marzo de 2008 y septiembre ¿no? de 2009 ¡pum! serían estos de aquí ¿vale? hemos visto igual para un dato in para un conjunto de datos between para intervalo si yo por ejemplo quiero buscar a aquellos empleados cuyo JobTitle contenga la palabra Engineer ¿qué haríais? cuando no tengo claro qué es lo que busco o solo tengo una parte del carácter Like ¿vale? pero no abuséis del Like si sabéis el barrio exacto no hay que utilizar Like ¿vale? ¿vale? si yo hago esto todos estos lo contienen ¿vale? para lo que hemos visto si queremos que sea distinto de distinto de not in, descartar un conjunto de datos, not like que no contenga ¿vale? si ahora mismo pongo aquí por ejemplo not like efectivamente todos los que tienen ingeniería los incluye Jorge los incluye ¿vale? cuando te haces un between es como si fuese mayor que igual y menor que igual ¿vale? bien el web como veis tampoco hay tantos filtros simplemente hay que tener claro cuál utilizar bien ahora imaginaros que nos dicen oye quiero el recuento de empleados por departamento un recuento de empleados por departamento ¿Qué haríais? ¿Qué modificáis aquí? Eso es la primera función De agregación que sería count ¿Vale? ¿Qué más? Porque yo he jugado todo esto, pues 290 Sin más Si yo quiero el número de empleados Group by, ¿vale? ¿Qué pongo en el group by? Pues El departamento, ¿no? Pero, otra vez, ojo lo ejecuto y ahora qué tenemos que poner el departamento también en el select eso es vale bien ok ahora lo quiero ordenar de mayor empleo o sea que el resultado se me ordene de más empleados a menos qué función utilizamos el noterby eso es Orden by Podemos utilizar Podemos poner recuento ¿Vale? O como hemos hecho antes, en vez del campo Como sabemos que aquí hay uno y dos Pues si quiero ordenarlo por el segundo Si simplemente pongo un dos Me funcionaría ¿Vale? ¿Y funciona también si pongo recuento? Depende De la herramienta llegó que si se consigue lo deja lo que no dejaba creo que gané el having en el web pero en el orden by pues parece que sí vale imagina que aparte de esto dicen oye pero no sólo llegó recuento quiero el salario medio qué hacemos eso es abrir a ver pero ojo esta vez de sala ¿vale? bien ¿y qué hago? pues simplemente ejecuto pues ya tengo el group by ¿vale? y acá me dice, vale pues de todos estos, solo quiero los departamentos, o sea el listado de aquellos cuyo salario medio oscila entre 15 y 30 el salario medio oscila entre 15 y 30 ¿cómo lo filtráis? ¿quién ha dicho where? no, Verónica, where no porque el salario medio el salario medio está almacenado en la vista no, tenemos el salario el salario medio lo estamos calculando entonces la función si nosotros estamos utilizando una función de agregación calculada y la queremos filtrar a la vez que la calculamos tiene que ser having ¿vale? y le decimos que sea ¿qué he dicho? 10 y 30 ¿no? between y ahora sí ¿lo veis? lo filtra ¿sí? claro os dais cuenta que realmente entre los join los select y where de que haga el examen sabéis todo acabamos de repasar todo y de hecho para vuestro futuro profesional sabéis los CT y las vistas ¿Sí? ¿Bien? ¿Dudas? ¿Preguntas? Vale Ahora, imaginad Lo que he dicho Para practicar un poco más Fijaros, en Purchasing ¿Vale? Tenemos la contrapartida Es decir, son las compras que hacen los empleados de Adunchur Works a otras empresas para vender sus productos. ¿Vale? Entonces, fijaros, en Puchase Order Header tengo esta información, ¿vale? Que son los diferentes pedidos que hemos realizado. Y fijaros, aquí tengo el empleado, el código del empleado que ha realizado ese pedido fijaros, imaginad vosotros tenemos este pedazo de vista que hemos hecho nos llega un iPhone y me dice yo quiero el listado de los pedidos y quiero saber que empleado lo ha hecho y ustedes dicen, bueno pues fácil, ¿no? los pedidos, lo que viene aquí ¿y qué hago? pues me vengo y digo, vale, ya tengo un pedazo de vista que es el de empleados donde tengo toda la información relevante entonces ¿qué hago? digo vale me voy a esta tabla y le digo employee ID que sea igual al business entity ID y aquí DH tengo todo pero de mi vista pues me hace falta el first name el last name el department y que se yo el salary aquí yo y pum De repente, como ya tenía yo la vista creada, tengo en un momento todos los datos que necesitaría de un empleado. Esto es útil, como veis. Es decir, cuando creamos una vista compleja donde tenemos información bien calculada, después la podemos extrapolar a otras consultas que nos hagan falta. Como por ejemplo en este caso, imaginaos que nos piden algo de compras. todo el mundo le queda claro el CT y la vista, os digo porque de verdad es algo que en el día a día trabajando con un SQL es fundamental ¿sí? ¿bien? ¿dudas? ¿preguntas? Sí, Aurelio, lo vimos la semana pasada, sí Igualmente hoy lo hemos... No, la semana pasada no ¿Fue la semana pasada o la otra? No me acuerdo ahora muy bien O es la otra o la pasada o la otra, ¿vale? Pero básicamente es lo que hoy hemos vuelto a repetir ¿Ok? Igualmente la semana que viene cuando corrijamos la actividad 3 Podemos volver a repasarlo, ¿vale? Porque sobre todo en la 1 y en la 3 se pueden utilizar ¿De acuerdo? Vale, profe, está bien pues nada, perfecto un placer, como siempre tenéis una buena semana y espero que las notas las tengáis esta semana de verdad, os pido disculpas si, ya es practicar Jorge y nada, nos vemos ya la semana que viene, que será la última sesión igualmente eso, la semana que viene si queréis también charlamos, si tenéis cualquier duda me preguntáis y ya nos despediremos así que nada, pues un saludo a todos, cuidaos mucho y nos vemos la próxima semana hasta luego gracias profe gracias profe
