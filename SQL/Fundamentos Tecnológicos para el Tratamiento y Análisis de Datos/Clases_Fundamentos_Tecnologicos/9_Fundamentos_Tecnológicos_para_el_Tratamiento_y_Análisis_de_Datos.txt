Bien, buenas tardes a todos. Bienvenidos a la novena sesión de Fundamentos Tecnológicos para el Tratamiento de Datos. Bueno, es la sesión última ya de antes de las vacaciones. Y básicamente lo que vamos a hacer es corregir la actividad opcional que os mandé la semana pasada, que es esta de aquí, que es la de tienda de zapatos. ¿de acuerdo? pero antes de eso en los primeros compases de la clase quiero que volvemos a hablar de la actividad 2 ¿vale? bueno, también preguntaros lo primero ¿habéis podido ver vuestra nota perfectamente? sí ¿os aparece a todos? es que hemos tenido ciertos problemas con la plataforma que es nueva y si a alguno no le aparece la nota vale, una de dos, comentádmelo por aquí o escribidle a los tutores ¿vale? Le pedimos caso que no os aparezca. Como veis, en términos generales la nota está muy bien, es decir, con el tema de las claves hemos avanzado bastante, por lo tanto, pues, por lo general, pues bastante bien. Bien, volviendo a la actividad 2, ¿vale? Os vuelvo a recordar que la fecha de entrega la posponemos, ¿vale? No va a ser el 5 de enero, sino que va a ser el 12, ¿vale? Porque, a ver, esto es un cambio que yo he propuesto porque realmente me parece un poco injusto que se tenga que entregar al día siguiente de terminar las vacaciones, ¿vale? Por lo tanto, vais a tener una semana más, ¿vale? Igualmente, en los foros lo pondré, ¿vale? De hecho, lo voy a poner seguramente hoy. Me iba a poner la semana pasada porque eso me pasó. Por lo tanto, la fecha de entrega es el día 12. Es verdad que aquí, en la plataforma, va a seguir siendo el día 5, ¿vale? Porque no lo puedo cambiar. No lo podemos cambiar, pero no os preocupéis. Tenéis hasta el día 2, ¿vale? Para terminar la actividad. Ahora bien, de cada entrada en la actividad, igual que en la primera, lo importante es que venga el nombre de todos los integrantes del grupo, pero aquí en vez de un Excel, lo que os suelo pedir es que vosotros escribáis el código, porque yo lo que necesito es el código, no necesito el resultado. entonces me ponéis los códigos de cada consulta vale en un word ponéis los nombres de todos los integrantes del grupo lo convertirse un pdf y lo subís vale la manera más sencilla de acuerdo porque porque realmente como ya hemos hablado de la actividad la actividad 2 es similar a la que vimos la semana pasada voluntaria y la que vamos a ver hoy que básicamente yo os pido una serie de consultas 9 en este caso y vosotros pues tenéis que escribir el código vale vuelvo a asistir que no me hace falta el resultado vale yo lo que voy a evaluar es el propio código vale por lo tanto copiando el código suficiente no hace falta que me incluyáis en el word o en el pdf el resultado no es necesario únicamente el código vale por lo tanto consulta 1 el código consulta 2 código consulta 3 código y así etcétera etcétera y después al final vale tenéis que crear cuatro propuestas de consultas como éstas vale dificultad baja media baja media alta y alta es decir considerando que baja en la consulta 1 y alta es la consulta nueva vale pues la 4 es decir las del medio pueden ser pues alguna de estas la cuarta por lo tanto vosotros pensáis un requerimiento de consulta como este y lo resolvéis vale es decir que en total pues serían 13 consultas todas ellas en un word con el nombre de todos los integrantes del grupo compartirse a pdf y todos los integrantes del grupo tienen que subir el pdf vale porque tengo porque lo demás en la plataforma que si no subís nada no puedo calificar vale así que por favor tener eso en cuenta ahora bien la base de datos donde está en scripts vale aquí escribe actividad 2 consultas sql es una base de datos de ecommerce hay una para maya sql y otra para sql server de acuerdo clara la actividad 2 sí perfecto genial pues vamos entonces con la corrección de la actividad opcional que os mandé la semana pasada, ¿vale? Que es esta de aquí. Es una empresa de distribución de calzado. ¿Dónde tenéis los scripts? Como os comenté, aquí también. ¿Vale? Consulta tienda zapatos. Tenéis el Word que os acabo de mostrar. Y tenemos aquí también los dos archivos SQL. ¿De acuerdo? ¿Qué hacemos? Pues básicamente descargamos el archivo SQL y listo. ¿Vale? Es decir, lo descargamos y lo ejecutamos una vez. Si lo ejecutamos más de una vez, Aparece esto, ¿vale? Quiere decir que ya lo hemos ejecutado y recordad que las tablas y los datos se guardan, ¿vale? No se guardan. Dicho esto, lo primero que siempre os digo, tanto de cara a las actividades como de cara al examen, es que reviséis bien, ¿vale? Cuáles son las tablas que tenemos a nuestra disposición, ¿vale? En este caso son 5. Tenemos la tabla de pedidos, ¿vale? Que tiene las transacciones, factura como clave ajena, artículo y cantidad de artículo. Tenemos clientes, tenemos artículos, tenemos almacenes y tenemos facturas. ¿De acuerdo? Teniendo esto en cuenta, pues ya empezamos a escribir el código que nos solicita, ¿vale? Que en este caso, vale, esta es la de e-commerce, es esta de aquí, vale. En este caso, vamos con la primera. Bien. Nos piden proporcionar los nombres y las fechas de alta de los clientes de tipo empresa ordenados de forma ascendente. Obviamente no por el nombre, que no tiene sentido, sino por la fecha de alta. ¿Vale? Por lo tanto, lo primero siempre es identificar la tabla. En este caso, en la tabla de clientes, nuestra tabla principal. Dos, ¿necesitamos alguna otra tabla? En este caso, no. ¿Vale? Tres, filtros a nivel de fila, es decir, el web. ¿Cuántos filtros tenemos aquí? ¿Cuántos filtros a nivel de web tenemos aquí? Uno, el tipo de empresa. Eso es, únicamente uno, que es el tipo. Por lo tanto, especificamos tipo y que sea igual a qué? A empresa. Ojo, cuidado aquí. Tipo, aquí hay dos. Persona o empresa. Yo estoy pidiendo que el tipo sea igual a empresa. Pero si vosotros me ponéis que el tipo sea distinto de persona, aunque nos dé el mismo resultado, esto y esto no es lo mismo. Aunque en este caso sí que devolvería exactamente el mismo resultado. Así que, por favor, centraros tanto de cara a la actividad, a las actividades, como de cara al examen en especificar exactamente lo que os pidan los requerimientos. Así que, efectivamente, tipo igual a empresa. Después, en el select, que son los filtros de atributos, en este caso solo necesitamos dos, el nombre y la fecha de alta. Y finalmente nos pide ordenar, recordemos que para ello está la función orderBy y ordenar por nombre no tiene mayor importancia, pero la fecha de alta sí es interesante. Por lo tanto, especificamos fecha de alta de forma ascendente, ASC, ¿vale? Ejecutamos y efectivamente obtenemos el resultado. Bien, os he comentado muchas veces que a nivel de SQL podemos llegar al mismo punto de diferentes formas, ¿vale? Es decir, aquí, si nos fijamos, voy a ejecutar la tabla de clientes de nuevo, ¿vale? nosotros en clientes, el tipo empresa, tenemos un campo. Pero, mirad, si nosotros miramos los datos, ¿tenemos alguna otra forma de filtrar por empresa que no sea utilizando el tipo? ¿El campo de tipo? Eso es. El NIF. Eso es. Muy bien. Es decir, el NIF, si nos fijamos, hace referencia a qué? A las personas. porque cuando toma valor nulo es empresa porque cuando tiene un valor es persona y con el cif ocurre lo contrario si tiene un valor es empresa si es nulo es persona vale por lo tanto imaginar que en vez de poner tipo empresa especifica es que el nif vale sea que nulo o no nulo para que sea empresa, tenía que ser que nulo. ¿Vale? Por lo tanto, valdría también o especificar que el CIF no sea nulo. ¿Vale? Lo cual también devolvería el mismo resultado. ¿De acuerdo? Cualquiera de las tres opciones es válida, ¿vale? Porque se cumple con que sean empresa. ¿De acuerdo? Porque comentó esto, porque en esencia, como ya os digo, se puede llegar al mismo destino de diferentes formas. Lo digo también porque si después empezáis a comparar vuestras consultas, podéis darse el caso de que tengáis consultas bastante diferentes, pero llegáis al mismo punto. Sí, dime, Verónica, que has levantado la mano, perdona, que no lo había visto. Sí, profe, quería hacer una consulta. En el orden by, como está detallado en requerimiento, ¿deberíamos o sería correcto también si ordeno tanto por la fecha como por el nombre? Realmente sí que es verdad que yo aquí no he especificado el campo como tal, lo he dado un poco por sentado, que sea la fecha de alta, pero imaginad que esto es el entregable, ¿vale? La actividad que entregáis, y en LogDevBy aparte de la fecha de alta, pues también pones el nombre, ¿no? Yo realmente no pasa nada, ¿vale? No os quitaría puntos ni mucho menos, ¿vale? lo que te va con que esté puesto me valdría vale sí que es cierto que pero perdón porque no ha especificado como tal cuál es el campo por el que quiero ordenar vale pero estaría incorrecto si lo dejamos por ejemplo digamos que lo necesito en orden alfabético por algunas circunstancias y pongo sólo orden por nombre también no pasa nada no pasa nada vale yo realmente no quitaría puntos por ello vale con que utilice el orden que es lo que busco si después ponéis otro campo porque yo he dejado aquí un poco subjetivo esto no pasaría absolutamente nada sin problema bien seguimos vale aquí nos pide proporcionar el CIP y la sede social de las empresas que contengan la denominación SL en sus nombres y cuya fecha de alta sea entre el año 2005 y 2017. Por lo tanto, lo primero, como hacemos siempre, es que identificar la tabla. En este caso es la tabla de clientes. Por lo tanto, una vez identificada la tabla, vemos si necesitamos en esencia alguna otra tabla, que en este caso no. Por lo tanto, pasamos al punto 3, que son los filtros a nivel de fila. En este caso, ¿cuántos filtros tenemos? Dos. Tenemos dos. En principio dos, pero realmente si lo pensamos bien son tres. Pero vamos a dejarlo en dos y el otro, de comillas, no cambia el resultado, pero lo ideal sería incluirlo. Pero bueno, vamos por partes. Lo primero, nos piden que busquemos las siglas SL en el nombre. Como veis, hay algunos. Para ello, ¿qué función utilizamos? Cuando no sabemos el valor exacto de lo que estamos buscando y queremos buscar dentro de una cadena de texto, utilizamos la función, eso es, light. ¿Vale? Y aquí dentro, entre porcentajes, especificamos que SL. ¿Vale? Bien. Después tenemos la fecha de alta. Y especificamos aquí que la fecha de alta sea en un intervalo entre el año 2005 y 2017. Aquí tenemos varias opciones de hacerlo. Tenemos el clásico between. vale y decimos 2005 0 1 0 1 y 2017 12 31 esta sería una posibilidad otra posibilidad y jose enrique dice in green estaría correcto sería correcto utilizar y vamos a comprobarlo yo ejecuto fechas de alta en between 2005 2017 presión ahora pongo fecha de alta y aquí que pongo 2005 2005 2005 2005 no ponemos el año de la fecha de alta si eso es sólo podemos hacer lo lo podemos hacer ahora vale pero con el tema de in in between es lo mismo between imagínate que tenemos por ejemplo de del 1 al 5 1 2 3 4 5 si ponemos between entre 1 y 5 nos devolverá todo el 1 el 2 el 3 el 4 el 5 pero si ponemos y 1 y 5 sólo nos devolverá los valores del 1 y del 5 vale por lo tanto jose no es lo mismo ok bien hoy ahora como dice alejandro en el caso de que la fecha no sea tipo date, están como string. Las fechas nunca van a estar como string, Alejandro. Es decir, las fechas, aunque parezca que esto es una string, no lo es. ¿Vale? Es decir, es una fecha, pero tenemos que incluirla como si lo fuese. ¿Vale? Como si fuese una string. ¿Por qué? Porque imagínate, si nosotros hacemos esto y ejecutamos me dice que date porque está almacenado como date es compatible con int, vale, lo mismo si hacemos esto de aquí vale, no funciona ahora bien si hay un campo hay un campo, que esto es más típico del data warehouse que una fecha se convierte en valor entero tomando una clave ahí sí, pero para eso tenemos que saber si realmente el campo por el que vamos a filtrar es número entero o es una fecha si es una fecha y casi vale o incluso así o incluso con los slaps vale cualquier caso lo entiende porque sabe que es una fecha vale pero profe no le lee así le ponga slash y en la fecha tenga rayitos es decir en el fondo entiende vale que como fecha de alta es un tema está definido como un day vale si tú por ejemplo ponemos slash o ponemos los guiones o no ponemos nada, que yo suelo recomendar esta opción, ¿vale? Lo entiende, porque el formato con el que está guardada la tabla, mejor dicho, este campo, es de fecha. Entonces operaría así. Y lo que dice Alejandro, ¿vale? Son casos específicos, ¿vale? En los que, bueno, cada empresa puede pasar miles de cosas y, aparte de tener la fecha de alta, como tal, lo mismo tienen números enteros, que es lo que he comentado, ¿vale? De hecho, en el taller de que impartiremos en el siguiente cuatrimestre lo hacemos porque de hecho lo ideal es almacenar fecha como número entero pero hay que hacer distintas transformaciones vale tengan esencia por norma general las fechas nosotros aquí la vemos como si pareciese una string pero por detrás sikuel entiende que es fecha ok vale de esta manera alejando yo creo que lo que tú dices es lo de los de xqui esto está relacionado más con los almacenes de datos y tiene su sentido vale de hecho voy a aprovechar para comentarlo normalmente cuando hacemos los joy vale ahora a veces que los yo no podemos hacer incluso por fechas por días entonces claro es mucho más rápido convertir este 2005 0101 a un número entero que mantiene su lógica vale y combinar los que hacerlo por fecha que la computación da nada más ok bien volviendo también lo que preguntó la compañera hay varias maneras de realizar esto vale otra sería fecha de alta que sea mayor o igual vale y fecha de alta que sea menor o igual vale esto sería también vale y finalmente, que es algo que no he explicado pero creo que una compañera lo ha comentado que sería muy interesante, es decir, SQL tiene muchas funciones, ¿vale? Nosotros es imposible que las veamos todas algunas las sigue comentando como por ejemplo esta de aquí es decir, cuando nosotros trabajamos con fecha hay funciones que nos permite extraer partes de esa fecha, por ejemplo aquí que podemos extraer el año el mes o el día ¿verdad? Entonces, para eso hay funciones que nos permiten hacerlo. Por ejemplo, si queremos extraer el año, tenemos la función year, ¿vale? Especificamos year, fecha de alta, lo que hace es que nos saca el 2013 y el 2017 y le digo que sea entre 2005 y 2017. Y fijaros, aquí sí que ya lo pongo como un número entero. ¿Por qué? Porque de la fecha estoy extrayendo un número, estoy extrayendo el año. ¿Vale? Y funcionaría igual. De hecho, para que veáis cómo funciona, ¿vale? Este tipo de funciones o incluso cualquier función que apliquemos en el web, para comprobar, lo ideal es incluirlo en el set. ¿Vale? Porque así vais a estar seguros de lo que estáis aplicando en el web es lo correcto. ¿Vale? Y de hecho, si lo pongo aquí, como veis, ¿qué hace? Me extrae el año. Lo mismo puedo hacer con mes, ¿vale? Month, claro, lo mismo, ¿vale? Hay muchas funciones, algunas las digué, pero algunas no. Os obligáis que las busquéis, ¿vale? Como por ejemplo, en este caso, mi compañera ha comentado, oye, ¿puedo extraer el año y filtrar? Por supuesto, sigue siendo igual. Y ahí en ese caso, ¿si podríamos utilizar el INC? Si es que utilizo el YEAR. ¿Podríamos o no? ¿Qué pensáis? Porque si extraigo el año, tengo solo los datos. Claro, pero yo estoy diciendo... 2005-2017. Pero yo estoy diciendo... Ah, es entre. Es entre. Entonces, si es entre, el INC no lo puedo utilizar, porque no es año 2005-2017, es entre el 2005-2017. 2017 es decir por ejemplo 2010 lo incluiría bien perdón jorge te contesto debe tener el mismo formato que la tabla en este caso es año mes y día pero si cambiar de envía mensaje lo busca la tengo que hacerlo en ese orden normalmente la definición de fecha ni siquiera viene por la tabla y viene también por la configuración regional de tu SQL me explico, sabéis que en Estados Unidos tienen puesto año, día, mes lo sabéis, ¿verdad? lo hacen de esa manera, entonces ¿qué pasa? dependiendo de cómo esté la configuración regional de nuestro SQL lo entenderá de una manera u otra, en otras palabras yo he cargado los datos así si yo ahora voy y lo cambio a Estados Unidos automáticamente cuando yo haga una consulta me lo devolverá en el modo americano ¿vale? ¿qué quiero decir con esto? que normalmente lo suele entender ¿vale? y suele entender al usuario por su configuración regional ¿vale? es decir rara vez te va a mezclar fechas de Europa que sería la clásica que tenemos aquí ¿vale? o la fecha general, no de Europa perdón, frente a la de Estados Unidos que lo hacen al revés ¿ok? Bien, y bueno, en esta consulta para determinar nos queda el CIF y la sede social. ¿Vale? Ejecutamos y listo. ¿Sí? ¿Claro? Perfecto. Pues seguimos. Bien, nos piden aquí. proporcionar el código de artículo, subtipo, precio unitario y precio con el impuesto aplicado de artículos de color verde, gris y negro. Lo primero, identificamos la tabla. En este caso, ¿cuál? La tabla de artículos. ¿Cierto? Punto 2. ¿Nos hace falta alguna otra tabla? En este caso, no. punto 3 filtros a nivel de web tenemos algún filtro cuántos filtros tenemos aquí 1 el color y qué ocurre aquí el color si nos fijamos que hay varios colores nos dicen que sea de color verde gris o negro es decir que tenemos aquí un valor o varios valores? Tenemos varios, ¿no? Es decir, es un conjunto de valores. Cuando nosotros queremos filtrar por un conjunto de valores, ¿qué función utilizamos? Que de hecho, lo que comentó antes Verónica, ahora sí, utilizamos el IN. Eso es. Y aquí, entre paréntesis, especifico los tres conjuntos, ¿vale? Que en este caso es verde, gris y negro está la opción de utilizar OR si, pero como ya os he comentado intentad no usarlo a menos que sea estrictamente necesario, ¿vale? porque al fin y al cabo si mezclamos con muchos condicionales y no ponemos bien los paréntesis podríamos pues obtener un resultado error ¿vale? bien, ahora nos queda el select, que nos pide el código de artículo, que en este caso es id de artículo, si yo lo quiero renombrar, ¿vale? a código de artículo, recordad que también puedo utilizar los alias para cambiarle el nombre, pero solo a la hora de ejecutar, ¿vale? es decir, no estoy modificando nada dentro de la tabla, solo modifico, en el momento que se ejecuta la consulta, el alias que le pongo a esa columna, ¿vale? Como por ejemplo, pues código Artic, ¿vale? Después tenemos subtipo, tenemos el precio unitario y fijaros, nos dice el precio unitario con el impuesto aplicado. ¿Qué quiere decir esto? Nosotros tenemos el precio y el impuesto. Entonces yo quiero este 112, ¿vale? Más el 21% de 112. ¿Cómo lo hago? Pues efectivamente yo puedo hacer interacciones entre los diferentes campos, siempre que tenga sentido. Es decir, yo puedo decir precio unitario multiplicarlo por el impuesto. Si yo ejecuto esto, fijaros, es el 21% de 112, de 45, etc. Pero si quiero el precio más el impuesto, ¿qué es lo que hago? Básicamente multiplico por 1 más el impuesto. ¿Vale? Y así creo el precio total. ¿De acuerdo? ¿Cómo renombro una columna calculada? ¿Te refieres esto a lo que acabamos de hacer? Esto, igual, le ponemos un alias al final. ¿Vale? Como ves, aparece precio total. ¿Sí? ¿Sí? Bien, lo mismo. Es decir, podemos hacer cualquier operación aritmética. aritmética, siempre que sea con números ¿vale? es decir, no puedo dividir un color por el subtipo, ni fecha tampoco, ¿vale? siempre que sean números yo puedo hacer operaciones aritméticas y crear estas columnas calculadas en base a lo que necesito ¡ay! es verdad, no lo he dicho, no lo he dicho ¿alguien se ha dado cuenta cuál es el tercer filtro? gracias, verano que patricio no me acordaba, ¿cuál es el tercer filtro? no lo digo específicamente que tenéis que filtrar esto por esto, pero ¿cuál sería aquí el tercer filtro? ¿El de la sede social? No, sede social simplemente es el campo. ¿Cuál sería? Que sea empresa. Eso es, muy bien, ¿vale? Es decir, el resultado no cambia en este caso, porque si contiene SEL es empresa, pero lo ideal efectivamente es verificar de, oye, por si acaso que sea empresa, porque imaginad que alguien, una persona en su nombre que tenga ese L no se aparecería ¿vale? entonces lo ideal sería ponerlo, ojo, imaginad que esto es el examen o o la actividad 2 ¿vale? yo aquí no os lo estoy poniendo como una manera específica estoy haciendo, os buscando que penséis, ¿vale? porque igualmente si no me lo ponéis, sé que es algo rebuscado, ¿vale? obviamente no os voy a quitar muchos puntos por ello poquitos, muy pocos porque si lo interpretáis mejor que mejor ¿vale? ¿por qué? porque rara vez en la vida real nos van a pedir algo y nos van a dar todos los detalles, muchas veces tenemos que pensar que es lo correcto ¿vale? bajo nuestro punto de vista que después a lo mejor no está bien, pero igualmente habrá veces que hay que darle una vuelta de tuerca ¿vale? bien bien hemos terminado seguimos solo una consulta acá donde hicimos la operación que nos decía que podemos hacer operaciones con números pero si son cadenas de string también podría concatenar verdad concatenar si realmente esto es algo que suelo decir más adelante pero mira si os interesa podemos hacer un ejemplo vale imaginar yo quiero concatenar el subtipo y el tipo vale imaginar si yo pongo tipo más subtipo ocurre lo siguiente. SQL entiende que estos son cadenas de texto y te las concatena. Que es lo ideal, dejar aquí un espacio. Entonces, ¿qué haríamos? Esto. ¿Vale? Aunque también hay una función. ¿Vale? Es la función concat. ¿Vale? Que nos permite concatenar, ya sea número o ya sea cadena de texto. Por ejemplo, yo puedo concatenar lo que hemos dicho, tipo y subtipo, ¿vale? Pero también puedo concatenar número, por ejemplo, precio unitario e impuesto. perdón vale, ¿qué ocurre? cuando concatenamos automáticamente este campo pasa a ser de texto hay que tenerlo en cuenta ¿vale? pero así se puede ¿vale? de hecho, fijaos os lo voy a pegar si queréis aquí para que lo tengáis y listo ¿sí? ¿dudas? ¿preguntas hasta el momento? Sí, profe, yo tengo una pregunta. Qué pena, ¿me puedes volver a explicar ese que dice precio unitario uno más impuesto? Esa línea del código. Sí, lo vemos sin problema. Fíjate, ¿vale? Voy a separar los campos y lo hacemos. Fijaros, en la vida real, nosotros que tenemos el precio, técnicamente, después está el impuesto asociado, ya sea, por ejemplo, en España es el IVA, que suele ser el 21. Entonces, si nosotros queremos el precio total del artículo, es decir, el precio de venta, tenemos que tener el precio unitario más ese porcentaje del impuesto, ¿vale? Es decir, el 112 más el 21% de 112, en otras palabras, precio unitario por impuesto, ¿vale? entonces sería este 112 ¿vale? más el 21% de 112 que es que 23, entonces sería 23 más 112 y este sería el precio final, porque se ha decidido ¿vale? esto se hace médica básicamente no sé si me explico ¿queda claro? sí, pero es más bien concepto de vida real, ¿vale? es decir simplemente lo uso como ejemplo de explicar que podemos multiplicar, etcétera, etcétera. ¿Ok? Bien, seguimos. Proporcional, precio medio, unitario, precio máximo y precio mínimo de los artículos del tipo zapatilla. Bien, como siempre, lo primero, la tabla, artículos, ¿verdad? Ahora, nos piden, a nivel de web, bueno, ¿Otra tabla nos hace falta? No, ¿vale? Entonces pasamos al tercer. Sí, dime, José Enrique, dime. Vamos a seguir avanzando. En la parte anterior dijo que cuando concatenábamos, digamos, dos columnas de numéricas, se volvían string, ya no se quedaba como... Se volvían como texto, exacto. Y esta nos daría algún problema en un posterior, si digamos esta columna recalculada como string, ¿utilizamos en alguna operación otra? ¿O sí lo entendería el SQL? Claro, fíjate. ¿Vale? Voy a volver a hacer, ¿vale? Esta concatenación de precio unitario impuesto, ¿vale? Vamos a llamarlo como, no sé, prueba. ¿Vale? Ahora imagínate que yo aprueba, ¿vale? Yo presuntamente pienso que yo aquí tengo un número entero, ¿no? Entonces, si yo ahora hago prueba menos 100, ¿vale? Como si fuese una operación aritmética. Bueno, no me lo va a coger, vamos a ponerlo tal cual. Lo hago así, ¿y ves? Y te lo dice. oye, no puedo convertir esto a número entero, porque le estoy pidiendo una resta. ¿Por qué? Porque esto en esencia, fijaros ya, por su propio formato que es canela de texto. Entonces, si nosotros combinamos números mediante concatenar, lo que nos convierte automáticamente es canela de texto. Es decir, ya no podemos hacer un sumatorio, un adres, ni nada, en base a esto. Hay que tener cuidado con ello. ¿A qué te refieres? Dime, José Enrique, y ahora seguimos con lo que ha preguntado Alejandro Sí, yo he entendido, profesor, gracias Alejandro, dime no te entiendo, porque se puede hacer operaciones de columnas calculadas ¿A qué te refieres? Sí, me refiero a que has calculado prueba prueba no existía Claro, prueba no existía Eso es Bueno, calculado la he concatenado, pero sí, sí, vale has hecho una operación para sacar prueba ¿puedo ahora coger prueba y hacer otra columna en base a prueba? claro, por ejemplo, imagínate o sea, lo que es poniendo prueba aquí tal cual, no, porque sé que eres un poco anticuillo en esto pero imagínate, tú tienes aquí el concat, que esto realmente es prueba ¿verdad? y tú que dices, vale aparte de esto, ¿le quiero concatenar? ¿o cómo? Ahora tienes que coger prueba otra vez, la línea Abajo, coge prueba O sea, ponerlo aquí Y ahora decir prueba O lo que sea Comprar prueba Con lo que sea Sí, qué sé yo, por ejemplo, con subtítulos ¿No? ¿Qué ocurre? SQL es antiguo En esta parte, por lo menos el mío, lo mismo En las versiones nuevas ya no, el momento Que nosotros definimos aquí Por ejemplo, este alias para volver a reutilizarlo en el select no funciona en el web, en SQL Server creo que tampoco, lo único que podría llegar a funcionar creo que es en el order by, ¿vale? fíjate si yo pongo aquí creo que el order by precio total ¿vale? que es lo que hemos calculado y lo pongo como descendiente sí que lo entiende, ¿vale? ¿qué ocurre? esto depende realmente porque aquí básicamente lo que tú me estás diciendo es un poco como si fuese una variable, ¿no? que podemos reutilizar a lo mejor en otra parte de la consulta esto por ejemplo, en otras herramientas como es Snowflake, con la que yo trabajo sí que deja, ¿vale? porque realmente pues lo han configurado así y sí se puede, este tipo de limitaciones normalmente viene por la herramienta en sí, ¿vale? más que porque se pueda o que se pueda hacer o no se pueda hacer ¿vale? la tienes que guardar como tabla materializada, sí y no, ¿vale? es decir si incluso si no la quiere guardar y quieres tener esa opción vale puedes incluirla él una subconsulta que ocurre con la subconsulta cuidado no puede haber orden by y hay que siempre que darle un ala vale decir devolvería lo mismo pero de qué ha pasado aquí espérate un segundo se lo voy a llamar T a ver si así me deja ah, vale no me deja porque claro precio unitario impuesto no tiene un valor con impuesto entonces claro, yo le incluí esta consulta dentro de otra tiene que estar niquelada y tener todos los nombres en todos los atributos, ¿vale? ahora sí, y aquí por ejemplo sí que yo ya podría decir, ¿vale? prueba y utilizarlo para algo o poner aquí prueba concatenarlo con otra cosa, ¿vale? con cap prueba con, qué sé yo código de artículo, ¿vale? y ahora sí que te dejaría ¿vale? esto realmente depende un poco de lo que vayas buscando pero te digo, depende de la herramienta, ¿vale? hay veces, por ejemplo, en Snowflake sí que deja aquí en SQL Server, si quiero hacer lo que tú comentas, pues lo mismo, o lo haría así o crearía una vista, ¿vale? es un concepto que todavía no hemos visto, que básicamente es almacenar una consulta como una tabla virtual, ¿vale? cuando te van a hacer las consultas, la vida está así complicada, pero la complico yo o en general porque lo mismo es que voy demasiado rápido Alejandro, no os preocupéis, ¿vale? Más adelante Sí, no sé si puedo Sí, dime, dime Lo que me parece, porque hemos visto algo de subconsultas, pero a mí personalmente me lía mucho si yo la subconsulta la debo o la tengo que hacer en el select o en el where o ¿sabes? Confunde un poco de para qué sirve y es que es como que cada vez sirve para una cosa y es un poco lioso y no sé si podía ver en algún momento una especie de bueno, no monográfico pero sección explicativa de cuando haces consultas, en qué parte de repetir, o sea, de poner más ejemplos de cuando utilizamos una u otra, ¿no? ¿te refieres? Eso es. Sí, eso lo podemos hacer de hecho, en las de aquí, de las que vamos a hacer de aquí no, pero pero mira Alejandro, si quieres la próxima clase cuando vengamos de las vacaciones vale, si no recuerdo mal ya vamos a empezar con Android Flukeworks, vale entonces que pasa, yo ahí tengo bastante más juegos de tablas, vale, y ahí de hecho con datos reales porque realmente Android Flukeworks es una simulación de datos reales, podemos explicarlo con un ejemplo creo que bastante más claro vale, que con estos pequeños ejemplos que estamos trabajando ahora que simplemente pues para entender el código con tablas pequeñitas y con un sentido pues un poco genérico vale así que si os parece recuérdamelo vale una vez que empecemos con un toolbox a la vuelta vale decir oye seguir ahora que estamos con esto vamos a poner más ejemplos de cuando utilizó su consulta para una cosa o para otra vale te parece bien es que el donado hecho un box va a ser más sencillo porque vais a ver más claro porque realmente es una base de datos real por así decirlo la estructura todo hay muchos datos y va a ser bastante más fácil porque aquí tenemos muy pocos datos pero precisamente por lo que he comentado para explicar e ir aprendiendo una vez que tengamos esto ya sentado nos tiramos a la piscina por así decirlo te parece bien igualmente también te digo por ejemplo como tú habías dicho no cargar una subconsulta en un from etcétera totalmente después en la vida real no lo vamos a hacer así tal cual vale lo vas a hacer con otros conceptos como por ejemplo os he dicho antes que no quiera tampoco dilatarme mucho hablando de ello que son las vistas eso sí que es algo que se utiliza a diario muchísimo y también el tema de la cte vale que es como yo por partes voy haciendo consultas que voy encadenando no es que tenga relación pero la voy como lo hace dando un caché y después en una última consulta la utiliza y es mucho más fácil que las consultas pero que igualmente no os preocupéis esto lo iremos debemos viendo un ejemplo vale poder sin ir más lejos os voy a poner el ejemplo el ejemplo mío de hoy vale, yo trabajo con datos de con datos muchos de Salesforce vale, que se cruzan con los datos realmente financieros ya de venta y de invoices o sea, de facturas, ¿no? y aparte, de ahí va por regiones, pero hay regiones de plantas, ¿vale? porque trabajo en una empresa industrial y regiones de los clientes ¿vale? imagínate, ¿no? me llega una petición normalmente me dice, vale, Sergi hemos migrado, que de hecho pasó hace dos meses mirar con las herramientas, antes teníamos unas tablas de la herramienta anterior y ahora tenemos las tablas de esta nueva herramienta, es decir, nuestras plantas son las mismas pero ya aparecen en dos entornos hasta finales de noviembre están en una y después en otra, entonces ¿qué pasa? el business me viene y me dice Sergio, me hace falta ¿vale? comparar los datos de septiembre a día de hoy de lo que tenemos este año frente al año pasado y me dicen básicamente eso el volumen de ventas que ocurre no me dicen explícitamente no tienes que desde noviembre hasta ahora en las normas tablas de la migración y todo lo que sea anterior de las antiguas, ¿vale? No sé si me explico, es un poco difícil de explicar, ¿vale? Pero que en esencia me piden, oye, me hace falta el volumen a lo mejor de estas regiones, comparar el acumulado de este año desde septiembre hasta hoy, frente de septiembre hasta hoy del año pasado, ¿vale? ¿Y qué ocurre? Es lo que me dicen. Yo a partir de ahí, esto, tengo dos opciones. Una, que esté en Power BI, que suele estar, pero ¿qué ocurre? Hay ciertas cuestiones que si no es solo el volumen, sino por ejemplo los costes que están en otro Power BI en otras tablas y las tengo que combinar por plantas y hacer un ponderado entonces claro, no hay nada de eso, y muchas veces estos ad hoc me piden, quiero esto, esto y esto, ¿vale? no me dan tampoco gran detalle, es decir, yo hago como una primera versión ¿vale? a la consulta les doy los datos de este año acumulado frente al año pasado dividido por plantas, y se lo mando, me dice no, no, me hace falta que me modifique esto yo que sé, quitando algún filtro específico de algún tipo de producto o de alguna planta. Y así, pues poco a poco se va desarrollando el código. Y una vez que me dicen, a lo mejor, oye, esto está bien, nos gusta, ya nos dicen, vale, pues ahora queremos esto ampliado. Y yo ahí, de esa consulta, básicamente lo que voy creando es una tabla de hechos. Un concepto que ya hablaremos más adelante, en la que yo migro un poco los dos sistemas, ¿vale? Y creo las claves necesarias para precisamente de planta y de cliente, ¿vale? Que es el mismo proyecto, pues me llevo dos semanas para hacer una tabla, la que esté toda la información con muchas claves y después hacer las dimensiones y si todo va bien, todo cuadra pues se crea al final un informe y lo empiezan a utilizar para que hagáis una idea, pero lo que suelen pedir es suele ir por etapas, es decir nadie de ningún business te va a decir quiero esto, esto y esto porque muchas veces el propio business no lo tiene claro porque hay tantos recovecos, tantos filtros tantas cuestiones a tener en cuenta en las combinaciones que ellos mismos se pierden pero que es normal, es decir es lógico, no se puede saber todo y tampoco como es lógico no se puede meter toda la información de la empresa en el mismo Excel por así decir eso es la eterna pelea Alejandro te digo, se me ha pasado en todas mis empresas y muchos me estaréis de acuerdo porque lo veréis en la vuestra o incluso vosotros mismos lo hacéis, nosotros todos tenemos una gran dependencia de Excel ¿cierto? es decir, siempre que vemos los datos en Excel después nos hacemos una tabla pivot o lo que sea y listo ¿qué ocurre? Excel es el Excel, ¿vale? esto, lo que vemos aquí, es lo que alimenta después eso es Excel, pero que muchas veces el problema es que técnicamente es muy difícil explicar lo que es el data flow es decir, si empezamos de un punto y vamos a otro, dentro de una base de datos es el propio business, el business muchas veces hace suposiciones que son erróneas suele pasar más de lo común ¿qué ocurre? ahí está muchas veces nuestra determinación de explicarles por así decirlo, como niños pequeños, de que, a ver nosotros empezamos con una tabla y vamos a esta o vamos a otra lo que no podemos ir a las dos a la vez es decir, hay que elegir un camino, no podemos tener todos los mismos caminos en un mismo Excel es imposible, entonces ahí está un poco nuestra pericia también, es decir, el business no le importa cómo están los datos ni cómo están almacenadas. Ellos quieren el numerito, quieren el Excel y demás, o el informe Power BI, que menos mal, que por lo menos ya estamos evolucionando allí. Pero que la mayor parte del tiempo, aparte de escribir el código, es rehacer el código. Es decir, lo mismo la primera versión de una consulta que os hagan, irá evolucionando hasta convertirse en un modelo de datos. Y lo que pregunta Alejandro es la gente del negocio no va a saber la técnica. Ahí entramos nosotros. ¿Vale? Nosotros tenemos que explicárselo. Habrá gente que sí. ¿Vale? Pero yo hasta el momento me he cruzado muy poca gente que sea buena en la parte técnica y que sea después buena en el business. ¿Por qué? Yo creo que eso depende de las personas, de las soft skills y de, os dejo esta frase, de saber jugar a la política corporativa. entonces, ¿qué pasa? por experiencia propia, ¿vale? la gente que más juega política es la que suele saber después menos ¿vale? y lo suele maquillar pero la vida es así en todas las empresas nosotros lo que podemos hacer es simplemente si el usuario no nos da la información, chincharlo para que nos lo dé y explicarle de la manera más fácil que podamos cómo funciona todo esto de ahí también que muchas veces, ¿veis? lo que estamos haciendo aquí que parece una absurdez o incluso para algunos es fácil lo estamos haciendo poco a poco para que veamos todo cómo va funcionando hasta que lleguemos a la parte compleja pero una vez que estemos en la parte compleja al saber todo lo que habéis visto antes la parte más básica, por así decirlo os va a resultar menos doloroso en términos de pensar de explicárselo al business ¿vale? y no sé si te he contestado la pregunta Alejandro, pero vamos, que realmente siempre hay que pelearse con el business y pelearse con IT, porque también habrá veces que el business te pide una cosa que va con 3T y te pide unas buenas prácticas que el business te quiere pues aguantar porque el business lo quiere ya y te quiere que vayas poco a poco y es al final el la vida ¿vale? pero eso perfecto, sin problemas bueno aprovecho igualmente que Alejandro ha hecho una pregunta, si alguien quiere hacer una pregunta similar pues sin problema ¿vale? bueno son las 8 pero bueno si nos importa, seguimos un poco más ¿vale? y si porque todavía nos quedan unas pocas ¿vale? pero que igualmente si alguien se tiene que ir y demás que se quedó libre ¿vale? no pasa nada como se que la reunión está grabada pues la podéis ver más adelante ¿vale? pero yo igualmente pues ya el tiempo que nos lleve si quiero terminarlo terminarlo todo ¿vale? eso si dame un segundo porque yo tengo ahora después un TFM y voy a escribirle a las compañeras de que voy a ir un poco tarde ¿Vale? Y ahora seguimos, ¿vale? Dame un segundo Perfecto, perdón Le he escrito y seguimos Bien, la consulta, proporcionar el precio medio unitario, precio máximo y precio mínimo de los artículos del tipo zapatilla, ¿vale? Es decir, aquí nos quedamos donde, en el filtro, ¿tenemos filtro a nivel de web? Efectivamente, sí, ¿no? Es decir, tenemos que el tipo sea que zapatilla. De hecho, si nosotros ejecutamos, vemos aquí que hay dos tipos. No hay más, pero en esencia, como os digo, siempre que os pida que el filtro sea exactamente como es, es como tenéis que delimitarlo. Tipo igual a zapatilla. Ahora, precio medio unitario. Si recordáis, nosotros podemos hacer cálculos. ¿Con qué? Con funciones de agregación. Por lo tanto, tenemos Average de precio unitario, es decir, el promedio, tenemos el precio máximo y el precio mínimo. Ahora bien, esto lo tenemos. Nos hace falta aquí el Group By, nos dice que agrupemos por algún campo. no, ¿vale? Por lo tanto, solo nos hace falta un tipo y de ahí, la media, el máximo y el mínimo. Es decir, aquí, como no nos pide agrupar, no nos hace falta groupby, ni nos hace falta poner nada en el select. ¿Vale? Ahora bien, imaginad que vosotros aún así lo queréis poner. No pasa nada. Especificamos aquí el tipo y lo especificamos aquí. ¿Vale? Y obtendremos lo mismo, solo que, pues, con la parte de tipo zapatilla. ¿De acuerdo? ¿Sí? Sencillo, ¿no? Sí. Sí, perfecto. Seguimos. Vale. Lo he dicho, ¿vale? Si alguno necesita marcharse y demás, que nos tomamos mal de tiempo, lo que decía, hay veces que terminamos antes, Entonces, a veces que después se te conlibre, ¿vale? No pasa nada, esto se queda grabado y lo podéis terminar. Si os podéis quedar, pues, mejor que mejor. Bien, proporcionar el número de facturas, perdón, aquí cometí un error, es número de facturas realizadas por cada cliente, ¿vale? Incluso de aquellos clientes que no han realizado ningún pedido, ¿vale? Además de ordenarlos de forma ascendente. Vale, lo primero, las tablas. ¿Cuáles son las que tenemos? Tenemos la tabla de facturas. ¿Vale? Y ahora, ¿nos hace falta alguna tabla más? O solo con esta nos vale. Cliente. Cliente, ¿por qué? A ver, porque realmente podemos utilizar la idea de cliente, pero si vamos a agrupar el número de facturas por una idea, tampoco dice mucho. ¿Vale? Entonces, tenemos que combinar con clientes. ¿Vale? ¿Cuál es la clave? En este caso sencillo, idClient que sea igual a idClient. ¿Vale? Listo. Tenemos la combinación. Ahora, ¿qué nos pide? Que por cada cliente proporcionemos el número de facturas que ha realizado. ¿Vale? Si nosotros queremos hacer un recuento de facturas, ¿qué función utilizamos? La función de count, ¿verdad? Por lo tanto, f factura, que sería recuento facturas, ¿vale? si yo ejecuto esto tal cual, pues obviamente tengo recuento, pero no lo tengo por cliente, ¿vale? Si lo quiero por cliente, tengo que seguir dos pasos. Uno, especificarlo en el group by, ¿vale? Por ejemplo, por el nombre de cliente y especificarlo también en el self, ¿ok? Bien, y ahora nos dice, ordenarlo de forma descendente. Obviamente, ¿descendente en qué? con el recuento de las facturas, ¿vale? Con el nombre tampoco tiene mucho sentido. Entonces, especifico order by y fijaros, por ejemplo, aquí en SQL sí que puedo reutilizar este nuevo campo que acabo de crear, ¿vale? De forma descendente. ¿De acuerdo? Y ahora os pregunto, en base a la información que tenemos, ¿estaría bien esta consulta o algo me falla aquí? De hecho, hay técnicamente dos fallos. ¿Vale? Uno es el importante. ¿Qué nos dice aquí? Según esto, yo debería mostrar clientes que no tengan ningún pedido. ¿Cierto? Con factura cero. Con factura cero. ¿Eso cómo lo hago realmente? Es decir, pensemos, si tengo clientes que no tienen factura y los quiero ver, ¿qué tendría que cambiar aquí? os doy la pista tiene que estar el cambio aquí pensemos, tenemos facturas y clientes con el INEJOIN nos devuelve solo los casos en los que debería ser el cliente el otro lado del INE no, el INEJ da igual por donde empecemos pero si que es cierto si parte de la base de clientes y a eso le pongo el número de facturas. Muy bien. Muy bien, efectivamente. Es decir, yo tengo que darle prioridad a qué? A la tabla de clientes, ¿verdad? Aquí, ¿qué es lo que puedo cambiar para darle prioridad a la tabla de clientes? Sí, puede join. O sea, el write join. Eso es. Muy bien, le doy la prioridad mediante write join. Write join con que me devuelva todos los clientes, tengan su correspondencia o factura o no y fijaros si yo que ejecutó esto ya veré tener ocho registros tengo que 10 y de hecho cuántos clientes son los que no tienen factura 2 2 verdad bien pues fijaros que me habéis preguntado creo oye cuando tengo que utilizar y me joy o rayo y no les joy porque términos generales en los exámenes y en las actividades para no sobrecomplicar, por defecto utilizad inner, ¿vale? A menos que yo específicamente os dé algún punto que os haga elegir o left o right, que bueno, left o right también depende de qué tabla empecéis ¿no? Justo, me estoy a preguntar yo eso, ahí se pone factura porque es la de mayor rango por la buena práctica de poner from factura Si pongo from clientes es left join correcto, es decir, yo como ya os he comentado normalmente empezamos con la tabla más grande pero imaginad que empezamos por clientes entonces, y después le combinamos factura es decir, ahí la prioridad sería clientes, y como bien ha dicho la compañera sería que darle prioridad a clientes es decir, left join ¿vale? pero lo dicho en el momento que yo quiera que utilicéis alguno específico, os lo dejaré caer ¿vale? en el propio enunciado si no digo nada, sentidos libres de utilizar el left join, ¿vale? no os preocupéis Ahora, prefiero que comprobéis, ¿vale? Que penséis, pero, por ejemplo, si es el examen o similar, por defecto, utilizaría el editor. ¿Vale? ¿Sí? Bien. Seguimos. vale, nos piden aquí proporcionar el nombre de factura fecha de pedido, nombre de almacén tipo de cliente y sede social para todos los pedidos cancelados entonces, lo primero, empezamos viendo las tablas la tabla de facturas nos hace falta efectivamente, aquí tenemos factura, fecha de pedido y los pedidos cancelados ¿Qué más tablas me hacen falta? Me hace falta almacén ¿Vale? Y me hace falta ¿Qué? Tipo de cliente O sea, la tabla de clientes Eso es, por lo tanto vamos a combinar almacenes Donde idea almacén de factura sea igual a Idea almacén de almacenes Y después InnerJoy cliente vale donde el id cliente sea igual a id cliente pero ojo de facturas si ponemos aquí a que es almacenes nos va a dar error porque almacenes no hay un campo de cliente vale bien ok ahora a nivel de web tenemos algún filtro que vayamos a aplicar cancelado pedidos cancelados pedidos cancelados el estado tiene que ser igual a cancelado ¿vale? bien, y ahora lo último que nos queda simplemente en el web especificar pues, ¿cuáles son los campos que necesito? de factura, me hace falta la factura, la fecha de pedido el nombre de almacén, eso viene de almacenes nombre, tipo de cliente que viene de cliente y la serie social que también viene de cliente ok bien seguimos vale, nos pide proporcionar el número de factura el número de días entre la recepción y la entrega del pedido la ciudad de almacén de procedencia y la sede social del cliente ¿vale? y se deberá dar en cuenta que el estado de envío debe ser enviado si os fijáis bien y esto es algo también que os quiero hacer que entendáis que muchas veces tanto en la asignatura tanto en las actividades como en el examen como en la vida real habrá veces que unas consultas se parezcan a otras como por ejemplo, aquí si nos fijamos nos hace falta un número de factura la fecha de pedido y entrega eso es de facturas almacén ¿vale? y cliente y si miramos bien en la consulta anterior son precisamente las tablas que hemos utilizado. Es decir, nosotros, ¿qué podemos hacer? Reusar. Y ahora, aquí, fijaros, hasta el web se parece, solo que en vez de que sea cancelado, nos piden que sea igual a qué? Enviado. Y finalmente, como veis, como ya teníamos la parte de la otra consulta hecha, Pues aquí también podemos reutilizar lo que nos interesa y cambiamos lo poco que necesitamos, que en este caso es factura, y ahora los números de días entre recepción y entrega, es decir, tenemos la fecha de pedido y la fecha de entrega, ¿vale? pero tenemos que hacer la diferencia ahora veremos cómo, ¿vale? pues tenemos la ciudad de almacén y la sede social vale ahora tenemos que calcular la diferencia de días entre el pedido y la entrega yo esto no lo he explicado obviamente, ¿por qué? porque como ya os he dicho habrá veces que nosotros queramos hacer algo específico pero no habrá nadie que nos lo diga entonces, ¿qué nos queda? investigar. Y si ahora nos vamos a Google, por ejemplo, y decimos, oye, señor Google, o Charles Hepet, lo que queráis, quiero calcular la diferencia de días entre dos fechas. Y el señor Google te dirá, vale, para SQL Server hay una función que se llama DateDiff, ¿vale? Que permite calcular diferencias entre fechas, ¿vale? Es decir, ya sean días, ya sean horas, ya sean minutos, ya sean meses, años, etc. ¿Vale? Y en esta función hay tres parámetros. Primero, es el intervalo, que en este caso nosotros queremos días. ¿Vale? Y después, especificamos primero la primera fecha y después la segunda. ¿Vale? Y si ahora ejecutamos, fijaros, nos calcula, ¿no? Fila por fila, ¿vale? Esto no es una función de agregación. tenemos fecha de pedido fecha de entrega 9 de abril, 20 de abril es decir, un total de 11 días y así para cada campo ¿sí? ¿claro? bien seguimos vale, aquí nos piden proporcionar el montante total sin impuestos y la cantidad de artículos vendidos en 2019, agrupados por subtipo de artículos. Entonces, aquí tenemos varias tablas, tenemos facturas, ¿vale? Que nos hace falta primero para la fecha y después la otra que es obvia es la de... Artículos, ¿verdad? ¿Qué ocurre? ¿Puedo combinar estas dos tablas directamente? ¿Puedo o no? Sí. ¿Sí? ¿Cuál es la clave? A ver, tenemos artículos. es decir, aquí no hay de artículo, y de hecho si miráis, hay una tabla más que hemos pasado por alto, que es la tabla de pedidos ¿vale? en la tabla de pedidos es realmente donde tenemos las transacciones recordad, esto lo hemos hablado, esto sí que es pura vida real, tenemos los headings y los details headings serían facturas y pedidos serían details, bien, entonces aquí tenemos la transacción, el número de facturas que pertenece, por ejemplo, veis En esta factura hay tres artículos, tres tipos de artículos y la cantidad de cada artículo. Entonces tenemos que empezar por esta tabla que es la más grande. Entonces combinamos facturas usando la clave de qué? De factura. Que sea igual a factura de factura. Después combinamos artículos. ¿vale? donde tenemos el id artículo que sea igual ojo, al id artículo de la tabla de pedidos ¿vale? bien, con ello lo tenemos todo combinado ahora, a nivel de web ¿qué nos hace falta? tenemos un único filtro realmente, ¿no? tenemos la fecha de pedido. Y fijaros, nos dice que la fecha de pedido o que se hayan vendido en el año 2019. Lo más cómodo sería, ya que hemos aprendido a utilizar year, pues lo usamos. Extraemos el año y le decimos que sea igual a 2019. Pero ojo, aquí hay trampa. ¿Qué pasa? ¿Todos los pedidos han sido vendidos o hay pedidos que no? No lo especifico como tal, pero lo correcto sería que deshacernos de los que son cancelados, ¿verdad? Es decir, que el estado sea igual a enviado. ¿Vale? Y ahora nos dice, oye, yo quiero la cantidad de artículos. Para la cantidad, ¿qué es lo que puedo hacer? Si quiero agrupar después por subtipo. ¿Qué hizo qué? Sub. Eso es, sumamos, ¿verdad? Y tenemos cantidad de pedidos. Después, el montante total, es decir, aquí básicamente, sin impuesto lo que queremos es la cantidad de artículo por su precio unitario. ¿vale? entonces ¿qué vamos a hacer? cantidad multiplicado por precio unitario, pero ¿qué pasa? aquí ya tenemos un sumatorio y aquí si nosotros simplemente dejamos esto, tendríamos otra columna con el precio total ¿pero qué ocurre? yo quiero sumar aquello por lo tanto hago multiplicación y aparte la sumo ¿Vale? Bien. Si yo ejecuto esto, funciona o no funciona, pero que me dice, oye, quiero desglosar por cada subtipo. Entonces aquí especifico, by, subtipo y subtipo. ejecuto y efectivamente por cada subtipo tengo la cantidad y el montante que se ha vendido. ¿Sí? ¿Claro? Bien. Y por último, tenemos la siguiente. nos pide proporcionar el número de artículos enviados, el montante total y la cantidad. Aquí me equivoqué, esto y esto es lo mismo, ¿vale? Pero esta vez agrupados por ciudad de almacén, ¿vale? Se deben ordenar en función del montante de forma descendiente, pero solo queremos mostrar aquellos almacenes que hayan enviado más de 200 artículos. ¿De acuerdo? Si somos listos, al igual que antes, si nos fijamos, la consulta es muy similar, varían pocas cosas, ¿vale? Lo primero, el año ya no nos sirve, pero el estado enviado sí, ¿vale? Ahora, no agrupamos por subtipo, agrupamos por almacén, tabla que aquí nos falta. Entonces vamos a combinar almacenes donde id almacén sea igual a id almacén de facturas. ¿vale? y aquí sustituyo y pongo AL ciudad y en el groupby ciudad bien, aparte me hace falta el montante total pero esta vez con impuestos no como anteriormente para ello ¿qué hacemos? pues multiplicamos ¿Qué es unitario? Pongo más impuesto por la cantidad ¿Vale? Bien, con eso tendría Cada almacén Con su cantidad y montante Y por último ¿Qué nos dice? Oye, solo queremos ver aquellos que han vendido más de 200 artículos. ¿Cómo filtramos esto? ¿Con el web? ¿O con Havik? Recordemos que esta cantidad que estamos calculando es una función de agregación. Por lo tanto, yo no puedo utilizar una función de agregación en web, entonces tengo que hacer lo que es el Havik, y especifico que sea mayor que 200, que en este caso solo aparecerán 2. Ejecuto y listo. ¿De acuerdo? ¿Dudas? ¿Preguntas? ¿Bien? Vale. Igualmente, dos minutos más, os robo, perdonadme. Ya no tenemos clase hasta la vuelta. ¿vale? tenemos clases creo que es el día 7 de enero ¿de acuerdo? sí creo que sí, porque el 6 es festivo aquí en España nos vemos el día 7 ¿vale? y recordad la fecha de entrega de la actividad 2 es el 12, no el 5 ¿vale? pero que igualmente mañana pondré, mañana o pasado pondré el comentario en el foro haciendo referencia a ello ¿vale? para que después tengáis una semana más y no os mando ninguna actividad porque bueno ya tenéis la actividad 2 ¿de acuerdo? así que nada poco más por mi parte os deseo a todos unas felices fiestas disfrutad, pasadlo bien con los amigos y la familia y nada, nos vemos a la vuelta ¿vale? cuidaos mucho a todos gracias, felices fiestas
